<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Định hướng tháng - Upload PDF & Soạn thảo</title>
  <meta name="viewport" content="width=1200">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"/>
  <!-- QuillJS Editor CSS -->
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <style>
    .custom-shadow { box-shadow: 0 4px 24px 0 rgba(59, 130, 246, 0.25); }
    .scrollbar { scrollbar-width: thin; scrollbar-color: #cbd5e1 #fff; }
    .scrollbar::-webkit-scrollbar { width: 8px; }
    .scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px;}
    #mainIcon_dhv { position: fixed; top: 61px; left: 200px; z-index: 1000; cursor: pointer; transition: all 0.3s ease; }
    #mainIcon_dhv:hover { transform: scale(1.05); box-shadow: 0 6px 28px 0 rgba(59, 130, 246, 0.3); }
    .icon-rectangle { width: 250px; height: 55px; border-radius: 16px; background-color: #3b82f6; border: 4px solid white; box-shadow: 0 4px 24px 0 rgba(59, 130, 246, 0.25); display: flex; align-items: center; justify-content: center; padding: 0 15px; }
    .icon-text { color: white; font-size: 1.325rem; font-weight: bold; text-align: center; width: 100%; }
    #wowup_dhv { z-index: 9999; }
    .pdf-viewer-container { width: 100%; padding: 0; margin: 0; position: relative; background: none; }
    .pdf-page-container { margin: 0; box-shadow: none; display: block; width: 100%; padding: 0; }
    .pdf-page { max-width: 100% !important; width: 100% !important; height: auto !important; display: block; margin: 0; padding: 0; }
    .file-title { margin-bottom: 6px; font-size: 1.1rem; color: #333; align-self: flex-start; padding-left: 12px; }
    .delete-modal_dhv { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 100; justify-content: center; align-items: center; }
    .delete-modal-content_dhv { background-color: white; padding: 20px; border-radius: 8px; width: 400px; max-width: 90%; }
    .delete-checkbox_dhv { margin-right: 10px; }
    .delete-file-item_dhv { display: flex; align-items: center; padding: 8px 0; border-bottom: 1px solid #eee; }
    #popup_dhv_resizable { min-width: 500px; min-height: 400px; max-width: 98vw; max-height: 95vh; resize: none; box-sizing: border-box; }
    .resize-handle { position: absolute; width: 20px; height: 20px; right: 0; bottom: 0; cursor: nwse-resize; z-index: 1000; background: transparent; }
    .resize-handle::after { content: ""; display: block; width: 20px; height: 20px; background: url('data:image/svg+xml;utf8,<svg width="20" height="20" xmlns="http://www.w3.org/2000/svg"><path d="M0,20 L20,0 M8,20 L20,8" stroke="rgb(59,130,246)" stroke-width="2"/></svg>'); opacity: 0.6; }
    .loading-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 200; justify-content: center; align-items: center; color: white; font-size: 1.5rem; flex-direction: column; }
    .spinner { border: 5px solid #f3f3f3; border-top: 5px solid #3b82f6; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin-bottom: 15px; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .footer-buttons { padding: 8px 4px; height: 60px; }
    .footer-buttons .flex-wrap { gap: 6px; }
    .footer-buttons button, .footer-buttons input { padding: 4px 8px; font-size: 0.875rem; }
    /* Style for editor */
    #editorArea_dhv { box-shadow: 0 8px 30px 0 rgba(0,0,0,0.15); border-radius: 10px; }
    #editorArea_dhv .ql-toolbar { border-radius: 10px 10px 0 0; }
    #editorArea_dhv .ql-container { border-radius: 0 0 10px 10px; }
    /* --- HỖ TRỢ ĐẦU DÒNG DANH SÁCH --- */
    .quill-content ol { list-style-type: decimal; margin-left: 2rem; padding-left: 1rem;}
    .quill-content ul { list-style-type: disc; margin-left: 2rem; padding-left: 1rem;}
    /* --- FONT BỔ SUNG --- */
    .ql-font-arial { font-family: Arial, Helvetica, sans-serif; }
    .ql-font-times-new-roman { font-family: "Times New Roman", Times, serif; }
    .ql-font-sans-serif { font-family: sans-serif; }
    .ql-font-serif { font-family: serif; }
    .ql-font-monospace { font-family: monospace; }
    /* Thêm style cho trình soạn thảo để đảm bảo hiển thị rõ ràng */
    #quillEditor { 
      background-color: white; 
      min-height: 300px; 
      font-size: 16px; 
      line-height: 1.5;
    }
    #quillEditor .ql-editor {
      min-height: 300px;
    }
  </style>
</head>
<body class="bg-gray-50">
  <div id="mainIcon_dhv">
    <div class="icon-rectangle">
      <span class="icon-text"> ĐỊNH HƯỚNG THÁNG</span>
    </div>
  </div>
  <!-- Popup chính -->
  <div id="wowup_dhv" class="hidden fixed z-50 top-0 left-0 w-full h-full flex items-center justify-center bg-black bg-opacity-40">
    <div id="popup_dhv_resizable" class="relative bg-white custom-shadow border-4 border-blue-500 flex flex-col" style="width: 85vw; height: 80vh;">
      <div id="contentArea_dhv" class="flex-1 overflow-y-scroll p-0 scrollbar border-b border-blue-200" style="max-height: calc(80vh - 100px);"></div>
      <div class="footer-buttons flex gap-3 items-center justify-center flex-wrap">
        <input type="file" id="pdfInput_dhv" accept="application/pdf" multiple class="rounded-full border-0 bg-blue-600 text-white py-1 px-3" />
        <input type="password" id="passwordInput_dhv" placeholder="Password upload" class="border px-2 py-1 rounded" />
        <button onclick="handleUpload_dhv()" id="uploadBtn_dhv" class="bg-blue-500 text-white px-3 py-1 rounded shadow hover:bg-blue-700">
          Upload
        </button>
        <button onclick="showEditor_dhv()" id="editorBtn_dhv" class="bg-purple-600 text-white px-3 py-1 rounded shadow hover:bg-purple-800">
          Nhập nội dung
        </button>
        <button onclick="handleSave_dhv()" id="saveBtn_dhv" class="bg-green-600 text-white px-3 py-1 rounded shadow hover:bg-green-800">
          Lưu
        </button>
        <button onclick="showDeleteModal_dhv()" id="deleteBtn_dhv" class="bg-red-600 text-white px-3 py-1 rounded shadow hover:bg-red-800" disabled>
          Xóa file
        </button>
        <button onclick="closeWowup_dhv()" title="Đóng popup"
          class="bg-gray-200 text-blue-500 px-3 py-1 rounded-full text-xl font-bold shadow hover:bg-gray-400 flex items-center justify-center"
        >×</button>
      </div>
      <div class="resize-handle"></div>
      <!-- Editor (ẩn) -->
      <div id="editorArea_dhv" class="hidden absolute top-0 left-0 w-full h-full bg-white z-20 flex flex-col rounded-lg border border-blue-400 shadow-lg">
        <!-- Ô nhập tên văn bản -->
        <input type="text" id="editorFileName_dhv" class="border rounded px-3 py-2 m-2 text-lg font-semibold" placeholder="Nhập tên nội dung (ví dụ: ĐỊNH HƯỚNG TUẦN)"/>
        <div id="quillToolbar"></div>
        <div id="quillEditor" style="flex:1; min-height:320px;"></div>
        <div class="flex gap-2 justify-end p-2">
          <button onclick="saveEditorContent_dhv()" class="bg-green-600 text-white px-3 py-1 rounded shadow hover:bg-green-800">Lưu nội dung</button>
          <button onclick="closeEditor_dhv()" class="bg-gray-400 text-white px-3 py-1 rounded shadow hover:bg-gray-600">Đóng</button>
        </div>
      </div>
    </div>
  </div>
  <!-- Modal xác nhận xóa -->
  <div id="deleteModal_dhv" class="delete-modal_dhv">
    <div class="delete-modal-content_dhv">
      <h2 class="text-xl font-bold mb-4">Chọn file để xóa</h2>
      <input type="password" id="deletePasswordInput_dhv" placeholder="Nhập mật khẩu để xóa" class="border px-3 py-2 rounded w-full mb-4" />
      <div id="fileListToDelete_dhv" class="mb-4 max-h-60 overflow-y-auto"></div>
      <div class="flex justify-end gap-2">
        <button onclick="hideDeleteModal_dhv()" class="bg-gray-500 text-white px-4 py-2 rounded shadow hover:bg-gray-700">Hủy</button>
        <button onclick="handleDeleteFiles_dhv()" class="bg-red-600 text-white px-4 py-2 rounded shadow hover:bg-red-800">Xóa</button>
      </div>
    </div>
  </div>
  <!-- Loading overlay -->
  <div id="loadingOverlay" class="loading-overlay">
    <div class="spinner"></div>
    <span id="loadingText">Đang xử lý...</span>
  </div>
  <!-- Firebase & PDF.js & QuillJS -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
  <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
  <script>
    // Firebase config
    const firebaseConfig_dhv = { 
      apiKey: "AIzaSyCaEzd8OMJ553ETba-M_pxWSe2bDX9fh_I", 
      authDomain: "ideco-f82d4.firebaseapp.com", 
      databaseURL: "https://ideco-f82d4-default-rtdb.firebaseio.com", 
      projectId: "ideco-f82d4", 
      storageBucket: "ideco-f82d4.appspot.com",
      messagingSenderId: "614324382815", 
      appId: "1:614324382815:web:234ed4873b7156d80fffea", 
      measurementId: "G-DJK5Q813JL"
    };
    firebase.initializeApp(firebaseConfig_dhv);
    const db_dhv = firebase.database();
    document.getElementById('mainIcon_dhv').onclick = function() {
      document.getElementById('wowup_dhv').classList.remove('hidden');
      loadFromFirebase_dhv();
    };
    function closeWowup_dhv() {
      document.getElementById('wowup_dhv').classList.add('hidden');
    }
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.worker.min.js';
    let allPdfs_dhv = [];
    let quillInstance = null;
    let editingIndex = null;

    function showLoading(message) {
      document.getElementById('loadingText').textContent = message || 'Đang xử lý...';
      document.getElementById('loadingOverlay').style.display = 'flex';
    }
    function hideLoading() { document.getElementById('loadingOverlay').style.display = 'none'; }

    function loadFromFirebase_dhv() {
      showLoading('Đang tải dữ liệu từ Firebase...');
      db_dhv.ref('pdfData').once('value').then((snapshot) => {
        const data = snapshot.val();
        if (!data) allPdfs_dhv = [];
        else if (Array.isArray(data)) allPdfs_dhv = data;
        else allPdfs_dhv = Object.values(data);
        showPdfContent_dhv(allPdfs_dhv);
        document.getElementById('deleteBtn_dhv').disabled = allPdfs_dhv.length === 0;
        document.getElementById('saveBtn_dhv').disabled = allPdfs_dhv.length === 0;
        hideLoading();
      }).catch((error) => {
        alert('Lỗi khi tải dữ liệu từ Firebase! ' + error.message);
        hideLoading();
      });
    }

    async function showPdfContent_dhv(pdfDataArr) {
      const el = document.getElementById('contentArea_dhv');
      el.innerHTML = '';
      if (!pdfDataArr || pdfDataArr.length === 0) {
        el.innerHTML = '<div class="p-4 text-gray-500 text-center">Không có dữ liệu nào được tải lên.</div>';
        return;
      }
      for (let i = 0; i < pdfDataArr.length; i++) {
        const info = pdfDataArr[i];
        const container = document.createElement('div');
        container.className = "pdf-viewer-container";
        const title = document.createElement('div');
        title.className = "file-title";
        title.textContent = `#${i + 1}: ${info.name || 'Không có tên'}`;
        container.appendChild(title);

        if (info.type === 'text') {
          const contentDiv = document.createElement('div');
          contentDiv.innerHTML = info.html;
          contentDiv.className = "p-3 border rounded bg-yellow-50 mb-3 quill-content";
          // Nút sửa
          const editBtn = document.createElement('button');
          editBtn.textContent = "Sửa";
          editBtn.className = "ml-2 bg-blue-500 text-white px-2 py-1 rounded shadow hover:bg-blue-700";
          editBtn.onclick = function() { editEditorContent_dhv(i); };
          title.appendChild(editBtn);
          container.appendChild(contentDiv);
        } else {
          const pdfContainer = document.createElement('div');
          pdfContainer.className = "pdf-container";
          container.appendChild(pdfContainer);
          await renderPdf_dhv(info.data, pdfContainer);
        }
        el.appendChild(container);
      }
    }

    async function renderPdf_dhv(pdfData, container) {
      try {
        const binaryString = atob(pdfData);
        const bytes = new Uint8Array(binaryString.length);
        for (let i = 0; i < binaryString.length; i++) bytes[i] = binaryString.charCodeAt(i);
        const pdf = await pdfjsLib.getDocument({data: bytes}).promise;
        for (let j = 1; j <= pdf.numPages; j++) {
          const page = await pdf.getPage(j);
          const parentWidth = container.clientWidth || container.offsetWidth || 0;
          const pdfOriginalWidth = page.getViewport({ scale: 1.0 }).width;
          let scale = 1;
          if (parentWidth > 0 && pdfOriginalWidth > 0) scale = parentWidth / pdfOriginalWidth;
          const viewport = page.getViewport({ scale: scale });
          const pageContainer = document.createElement('div');
          pageContainer.className = "pdf-page-container";
          pageContainer.style.width = "100%";
          const canvas = document.createElement('canvas');
          const context = canvas.getContext('2d');
          canvas.width = viewport.width;
          canvas.height = viewport.height;
          canvas.className = "pdf-page";
          canvas.style.width = "100%";
          canvas.style.height = "auto";
          pageContainer.appendChild(canvas);
          container.appendChild(pageContainer);
          await page.render({
            canvasContext: context,
            viewport: viewport
          }).promise;
        }
      } catch (error) {
        container.innerHTML = `<div class="text-red-500 p-4">Lỗi khi hiển thị PDF: ${error.message}</div>`;
      }
    }

    async function handleUpload_dhv() {
      const password = document.getElementById('passwordInput_dhv').value;
      if (password !== "123456") {
        alert("Sai mật khẩu!");
        return;
      }
      const files = document.getElementById('pdfInput_dhv').files;
      if (!files.length) {
        alert("Vui lòng chọn ít nhất một file PDF!");
        return;
      }
      const uploadBtn = document.getElementById('uploadBtn_dhv');
      const originalText = uploadBtn.innerText;
      uploadBtn.innerText = "Đang xử lý...";
      uploadBtn.disabled = true;
      showLoading('Đang xử lý file PDF...');
      try {
        for (let i = 0; i < files.length; i++) {
          const file = files[i];
          const pdfData = await readFileAsBase64_dhv(file);
          allPdfs_dhv.push({
            name: file.name,
            data: pdfData
          });
        }
        showPdfContent_dhv(allPdfs_dhv);
        document.getElementById('deleteBtn_dhv').disabled = false;
        document.getElementById('saveBtn_dhv').disabled = false;
        document.getElementById('passwordInput_dhv').value = "";
        document.getElementById('pdfInput_dhv').value = "";
      } catch (error) {
        alert('Lỗi khi tải lên PDF: ' + error.message);
      } finally {
        uploadBtn.innerText = originalText;
        uploadBtn.disabled = false;
        hideLoading();
      }
    }

    function readFileAsBase64_dhv(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = function() {
          const base64String = reader.result.split(',')[1];
          resolve(base64String);
        };
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    async function handleSave_dhv() {
      try {
        if (!allPdfs_dhv || allPdfs_dhv.length === 0) {
          alert('Không có dữ liệu nào để lưu!');
          return;
        }
        const saveBtn = document.getElementById('saveBtn_dhv');
        const originalText = saveBtn.innerText;
        saveBtn.innerText = "Đang lưu...";
        saveBtn.disabled = true;
        showLoading('Đang lưu dữ liệu vào Firebase...');
        await db_dhv.ref('pdfData').set(allPdfs_dhv);
        alert('Dữ liệu đã được lưu thành công vào Firebase!');
        document.getElementById('deleteBtn_dhv').disabled = allPdfs_dhv.length === 0;
      } catch (error) {
        alert(`Lỗi khi lưu dữ liệu: ${error.message}`);
      } finally {
        const saveBtn = document.getElementById('saveBtn_dhv');
        saveBtn.innerText = "Lưu";
        saveBtn.disabled = false;
        hideLoading();
      }
    }

    function showDeleteModal_dhv() {
      const fileList = document.getElementById('fileListToDelete_dhv');
      fileList.innerHTML = '';
      allPdfs_dhv.forEach((item, index) => {
        const itemDiv = document.createElement('div');
        itemDiv.className = 'delete-file-item_dhv';
        itemDiv.innerHTML = `
          <input type="checkbox" id="delete_${index}_dhv" class="delete-checkbox_dhv" checked>
          <label for="delete_${index}_dhv">${item.name || `File ${index + 1}`}</label>
        `;
        fileList.appendChild(itemDiv);
      });
      document.getElementById('deleteModal_dhv').style.display = 'flex';
      document.getElementById('deletePasswordInput_dhv').focus();
    }

    function hideDeleteModal_dhv() {
      document.getElementById('deleteModal_dhv').style.display = 'none';
      document.getElementById('deletePasswordInput_dhv').value = '';
    }

    function handleDeleteFiles_dhv() {
      const password = document.getElementById('deletePasswordInput_dhv').value;
      if (password !== "minhtriet1973") {
        alert("Sai mật khẩu!");
        return;
      }
      const checkboxes = document.querySelectorAll('.delete-checkbox_dhv');
      const filesToKeep = [];
      checkboxes.forEach((checkbox, index) => {
        if (!checkbox.checked) {
          filesToKeep.push(allPdfs_dhv[index]);
        }
      });
      if (filesToKeep.length === allPdfs_dhv.length) {
        alert("Bạn chưa chọn file nào để xóa!");
        return;
      }
      if (!confirm(`Bạn chắc chắn muốn xóa ${allPdfs_dhv.length - filesToKeep.length} mục đã chọn không?`)) return;
      showLoading('Đang xóa...');
      db_dhv.ref('pdfData').set(filesToKeep)
        .then(() => {
          loadFromFirebase_dhv();
          hideDeleteModal_dhv();
        })
        .catch((error) => {
          alert('Lỗi khi xóa: ' + error.message);
          hideLoading();
        });
    }

    // --- Editor QuillJS ---
    function showEditor_dhv() {
      document.getElementById('editorArea_dhv').classList.remove('hidden');
      
      if (!quillInstance) {
        // Khai báo font mới
        var Font = Quill.import('formats/font');
        Font.whitelist = ['arial', 'times-new-roman', 'sans-serif', 'serif', 'monospace'];
        Quill.register(Font, true);

        quillInstance = new Quill('#quillEditor', {
          modules: {
            toolbar: [
              [{ 'font': ['arial', 'times-new-roman', 'sans-serif', 'serif', 'monospace'] }, { 'size': [] }],
              ['bold', 'italic', 'underline', 'strike'],
              [{ 'color': [] }, { 'background': [] }],
              [{ 'header': [1, 2, 3, false] }],
              [{ 'align': [] }],
              [{ 'list': 'ordered'}, { 'list': 'bullet' }],
              [{ 'indent': '-1'}, { 'indent': '+1' }],
              ['clean']
            ]
          },
          placeholder: 'Nhập nội dung tại đây...',
          theme: 'snow'
        });
        
        // Thêm focus tự động khi mở trình soạn thảo
        setTimeout(() => {
          quillInstance.focus();
        }, 100);
      }
      
      // Đảm bảo làm trống trình soạn thảo khi tạo mới
      if (editingIndex === null) {
        quillInstance.setContents([]);
        document.getElementById('editorFileName_dhv').value = '';
      }
    }

    function closeEditor_dhv() {
      document.getElementById('editorArea_dhv').classList.add('hidden');
      editingIndex = null;
    }

    function saveEditorContent_dhv() {
      // Kiểm tra xem trình soạn thảo đã được khởi tạo chưa
      if (!quillInstance) {
        alert("Trình soạn thảo chưa sẵn sàng. Vui lòng thử lại!");
        return;
      }

      const htmlContent = quillInstance.root.innerHTML;
      const customName = document.getElementById('editorFileName_dhv').value.trim() || 'Không tiêu đề';

      // Kiểm tra nội dung có thực sự có văn bản không
      const textContent = quillInstance.getText().trim();
      if (!textContent) {
        alert("Vui lòng nhập nội dung trước khi lưu!");
        return;
      }

      // Thêm loading để người dùng biết hệ thống đang xử lý
      showLoading('Đang lưu nội dung...');

      try {
        if (editingIndex !== null) {
          allPdfs_dhv[editingIndex].html = htmlContent;
          allPdfs_dhv[editingIndex].name = customName;
          editingIndex = null;
        } else {
          allPdfs_dhv.push({
            type: 'text',
            name: customName,
            html: htmlContent
          });
        }
        
        // Hiển thị lại nội dung và thông báo thành công
        showPdfContent_dhv(allPdfs_dhv);
        closeEditor_dhv();
        document.getElementById('saveBtn_dhv').disabled = false;
        document.getElementById('deleteBtn_dhv').disabled = false;
        
        alert('Nội dung đã được lưu thành công!');
      } catch (error) {
        alert('Lỗi khi lưu nội dung: ' + error.message);
      } finally {
        hideLoading();
      }
    }

    // Hàm này cho phép sửa lại nội dung
    function editEditorContent_dhv(index) {
      editingIndex = index;
      document.getElementById('editorArea_dhv').classList.remove('hidden');
      if (!quillInstance) {
        showEditor_dhv();
      }
      quillInstance.root.innerHTML = allPdfs_dhv[index].html || "";
      document.getElementById('editorFileName_dhv').value = allPdfs_dhv[index].name || '';
      
      // Focus vào trình soạn thảo sau khi load nội dung
      setTimeout(() => {
        quillInstance.focus();
      }, 100);
    }

    // Drag-resize popup code + tự động fill lại PDF khi resize xong
    (function () {
      const popup = document.getElementById('popup_dhv_resizable');
      const handle = popup.querySelector('.resize-handle');
      let isResizing = false;
      let startX, startY, startW, startH;
      handle.addEventListener('mousedown', function (e) {
        e.preventDefault();
        isResizing = true;
        startX = e.clientX;
        startY = e.clientY;
        startW = popup.offsetWidth;
        startH = popup.offsetHeight;
        document.body.style.userSelect = 'none';
      });
      document.addEventListener('mousemove', function (e) {
        if (!isResizing) return;
        let newW = startW + (e.clientX - startX);
        let newH = startH + (e.clientY - startY);
        newW = Math.max(500, Math.min(window.innerWidth * 0.98, newW));
        newH = Math.max(400, Math.min(window.innerHeight * 0.95, newH));
        popup.style.width = newW + "px";
        popup.style.height = newH + "px";
        document.getElementById('contentArea_dhv').style.maxHeight = (newH - 170) + "px";
      });
      document.addEventListener('mouseup', function () {
        if (isResizing) {
          isResizing = false;
          document.body.style.userSelect = '';
          if(window.allPdfs_dhv) showPdfContent_dhv(allPdfs_dhv);
        }
      });
    })();
  </script>
  <script>
    // Firebase config và các hàm khác giữ nguyên như file gốc

    // ======= PHẦN THÊM MỚI - XỬ LÝ ĐA NỀN TẢNG =======
    // Thiết lập lịch tự động mở popup (dùng Date object thay vì string)
    const autoPopupConfig = {
      // Các ngày trong tháng cần mở (1-31)
      daysOfMonth: [5, 15, 28],
      
      // Giờ mở popup (3 lần/ngày)
      openTimes: [
        {hour: 10, minute: 30},  // 8:30
        {hour: 14, minute: 30}, // 13:30
        {hour: 17, minute: 00}  // 16:30
      ],
      
      // Thời lượng hiển thị (ms)
      displayDuration: 70000, // 70 giây
      
      // Các tháng áp dụng (1-12, empty = all)
      targetMonths: [], 
      
      // Các ngày trong tuần áp dụng (0-6, 0=CN, empty = all)
      targetWeekdays: [1, 2, 3, 4, 5], // Thứ 2-6
      
      // Lưu trữ các lần đã mở (dùng timestamp)
      openedTimestamps: cleanOldTimestamps(JSON.parse(localStorage.getItem('popupOpenedTimestamps') || '[]'))
    };

    // Xóa các bản ghi cũ (>30 ngày) - dùng timestamp để độc lập định dạng
    function cleanOldTimestamps(timestamps) {
      const now = Date.now();
      const thirtyDaysInMs = 30 * 24 * 60 * 60 * 1000;
      return timestamps.filter(ts => now - ts < thirtyDaysInMs);
    }

    // Kiểm tra điều kiện mở popup (dùng Date object)
    function shouldOpenPopup(now) {
      // Kiểm tra ngày trong tháng
      if (!autoPopupConfig.daysOfMonth.includes(now.getDate())) return false;
      
      // Kiểm tra tháng (nếu có thiết lập)
      if (autoPopupConfig.targetMonths.length > 0 && 
          !autoPopupConfig.targetMonths.includes(now.getMonth() + 1)) {
        return false;
      }
      
      // Kiểm tra thứ trong tuần (nếu có thiết lập)
      if (autoPopupConfig.targetWeekdays.length > 0 && 
          !autoPopupConfig.targetWeekdays.includes(now.getDay())) {
        return false;
      }
      
      // Kiểm tra khung giờ
      const currentTimeMatch = autoPopupConfig.openTimes.some(t => 
        t.hour === now.getHours() && 
        t.minute === now.getMinutes()
      );
      if (!currentTimeMatch) return false;
      
      // Kiểm tra đã mở trong khung giờ này chưa
      const oneHourInMs = 60 * 60 * 1000;
      const currentTimeSlotStart = new Date(now);
      currentTimeSlotStart.setMinutes(0, 0, 0);
      
      return !autoPopupConfig.openedTimestamps.some(ts => {
        const openedDate = new Date(ts);
        return openedDate >= currentTimeSlotStart && 
               openedDate < currentTimeSlotStart + oneHourInMs;
      });
    }

    // Kiểm tra và mở popup tự động
    function checkAutoPopup() {
      const now = new Date();
      
      if (shouldOpenPopup(now)) {
        openPopupAutomatically();
        // Lưu lại timestamp hiện tại
        autoPopupConfig.openedTimestamps.push(now.getTime());
        localStorage.setItem('popupOpenedTimestamps', JSON.stringify(autoPopupConfig.openedTimestamps));
      }
    }

    // Mở popup tự động
    function openPopupAutomatically() {
      if (document.getElementById('wowup_dhv').classList.contains('hidden')) {
        document.getElementById('wowup_dhv').classList.remove('hidden');
        loadFromFirebase_dhv();
        
        setTimeout(() => {
          if (!document.getElementById('editorArea_dhv').classList.contains('hidden')) return;
          closeWowup_dhv();
        }, autoPopupConfig.displayDuration);
      }
    }

    // Kiểm tra mỗi phút
    setInterval(checkAutoPopup, 60000);
    
    // Khởi động khi tải trang
    document.addEventListener('DOMContentLoaded', function() {
      // Dọn dẹp dữ liệu cũ
      autoPopupConfig.openedTimestamps = cleanOldTimestamps(autoPopupConfig.openedTimestamps);
      localStorage.setItem('popupOpenedTimestamps', JSON.stringify(autoPopupConfig.openedTimestamps));
      
      checkAutoPopup();
      
      // Vẫn giữ tính năng click icon
      document.getElementById('mainIcon_dhv').onclick = function() {
        document.getElementById('wowup_dhv').classList.remove('hidden');
        loadFromFirebase_dhv();
      };
    });

    // ======= PHẦN CÒN LẠI GIỮ NGUYÊN NHƯ FILE GỐC =======
    // ... (giữ nguyên tất cả các hàm khác)
  </script>
</body>
</html>


<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Thông Báo Tự Động</title>
  <style>
    .totup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      border: 5px solid red;
      box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
      padding: 30px;
      font-size: 35px;
      font-weight: bold;
      color: green;
      text-align: center;
      z-index: 9999;
      display: none;
      border-radius: 15px;
    }

    .okBtn {
      margin-top: 20px;
      font-size: 20px;
      padding: 10px 30px;
      background-color: #007BFF;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <!-- Popup 1 -->
  <div id="totup1" class="totup">
    BẢNG CHECKLIST CÔNG VIỆC ĐỂ GIÚP CÁC EM LÀM TỐT HƠN- QUẢN LÝ VIỆC TỐT HƠN <br>
	LẬP KẾ HOẠCH ĐÚNG MỤC TIÊU GIÚP CÁC EM TRIỂN KHAI VIỆC CHỦ ĐỘNG VÀ ĐẠT KẾT QUÀ TỐT HƠN.<br>
   	
    <div><button class="okBtn" onclick="hideTotup('totup1')">Vâng ạ</button></div>
  </div>

  <!-- Popup 2 -->
  <div id="totup2" class="totup">
   CÁC EM KINH DOANH: QUẢN LÝ KẾ HOẠCH PHẢI THEO MỤC TIÊU CỤ THỂ VÀ CÓ TÍNH THÚC ĐẦY CHỐT DOANH THU - KHÁCH HÀNG <br>
   Nên tự nhủ: nếu mình không gọi tìm ít nhất 3 khách hảng mới khai báo cáo giao dịch có khả thì hôm này xem như chưa xong<br>
   Nên kiểm tra lại khai báo cáo giao dịch - quản lý khách hàng đặt hàng để bấm chọn - theo sát đơn hàng xử lý cho nhanh  <br>
   
    <br> 
	Quản lý kế hoạch - bám sát định hướng - điều chỉnh kế hoạch - kiểm soát giờ làm việc hiệu quả<br>
    <div><button class="okBtn" onclick="hideTotup('totup2')">Vâng ạ</button></div>
  </div>

  <!-- Popup 3 (Mới thêm) -->
  <div id="totup3" class="totup">
  Quản lý kho - giao nhận  phải tuân thủ đảm bao mọi thủ tục khai báo ứng dụng- đề xuất- phiếu nhập - xuất <br>
  Hàng đổi trả- hàng kiểm soát đặc biệt phải được để khu riêng có bảng tên ghi nhận <br>
  Phối hợp giao hàng nhanh- ưu tiên khách hàng Chuỗi NT lớn- khai báo đầy đủ giao nhận - đóng hàng - xuất kho <br>
  Chủ động kiểm hàng: phối hợp phân công xử lý nhanh để giao hàng trong ngày- ưu tiên giao hàng xa buổi sáng trong ngày<br>
  Tất cả tài liệu liên quan đến kho phải lưu in và đóng cuốn định kỳ - đảm bảo truy suất nhanh<br>
    <div><button class="okBtn" onclick="hideTotup('totup3')">Vâng ạ</button></div>
  </div>

  <!-- Popup 4 (Mới thêm) -->
  <div id="totup4" class="totup">
 - Kế toán : tuân thủ khai báo phát sinh chứng từ trên MISA -ERP khợp và hạch toán ngay phát sinh<br>
 - Việc checklist công việc là tiêu chuẩn đánh giá nghiệp vụ hoàn thành của mọi nhân viên kế toán trong kỳ<br>
 - Báo cáo cuối kỳ kế toán: sẽ chỉ báo cáo hoạt động nghiệp vụ khai- báo cáo trên MISA - xuất file gởi BGD<br>

    <div><button class="okBtn" onclick="hideTotup('totup4')">Vâng ạ</button></div>
  </div>

 <script>
  const schedules = [
    {
      hour: 14,
      minute: 00,
      totupId: 'totup3',
      shown: false
    },
    {
      hour: 11,
      minute: 30,
      totupId: 'totup2',
      shown: false
    },
    {
      hour: 16,
      minute: 45,
      totupId: 'totup4',
      shown: false
    },
    {
      hour: 10,
      minute: 00,
      totupId: 'totup1',
      shown: false
    }
  ];

  function checkTotups() {
    const now = new Date();
    schedules.forEach(schedule => {
      if (now.getHours() === schedule.hour && now.getMinutes() === schedule.minute) {
        if (!schedule.shown) {
          document.getElementById(schedule.totupId).style.display = 'block';
          schedule.shown = true;
        }
      } else {
        schedule.shown = false;
      }
    });
  }

  function hideTotup(id) {
    document.getElementById(id).style.display = 'none';
  }

  setInterval(checkTotups, 30000); // Kiểm tra mỗi 30 giây
</script>
   
</body>
</html>
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APP QUAN LÝ </title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* CSS Variables - có thể tùy chỉnh màu sắc tại đây */
        :root {
            --lm-primary: #2c6fd1; /* lm = link manager */
            --lm-primary-dark: #1a56b4;
            --lm-light: #f8fafc;
            --lm-dark: #1e293b;
            --lm-gray: #64748b;
            --lm-light-gray: #e2e8f0;
            --lm-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --lm-radius: 8px;
        }
        
        /* Reset cơ bản */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f1f5f9;
            color: var(--lm-dark);
            line-height: 1.6;
            min-height: 100vh;
        }
        
        /* Container chính cho nút bấm, đã đổi tên và vị trí */
        .lm-container {
            position: fixed;
            top: 65px; /* Đổi từ bottom sang top */
            right: 450px;
            z-index: 10000; /* Tăng z-index để tránh bị che khuất */
        }
        
        /* Nút bấm chính, đã đổi tên class */
        .lm-button {
            display: inline-block;
            background: linear-gradient(135deg, var(--lm-primary), var(--lm-primary-dark));
            color: white;
            padding: 12px 18px;
            border: 2px solid white;
            border-radius: var(--lm-radius);
            cursor: pointer;
            font-weight: bold;
            box-shadow: var(--lm-shadow);
            transition: all 0.3s ease;
            font-size: 15px;
        }
        
        .lm-button:hover {
            background: linear-gradient(135deg, var(--lm-primary-dark), #0047ab);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        /* Khung danh sách xổ xuống, đã đổi tên class và chỉnh vị trí */
        .lm-dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            top: 100%; /* Danh sách sẽ bắt đầu ngay dưới nút bấm */
            background-color: white;
            min-width: 320px;
            max-height: 400px;
            overflow-y: auto;
            box-shadow: var(--lm-shadow);
            z-index: 1;
            border-radius: var(--lm-radius);
            margin-top: 15px; /* Tạo khoảng cách với nút bấm */
        }
        
        .lm-dropdown-content a {
            display: flex;
            align-items: center;
            color: #333;
            padding: 14px 18px;
            text-decoration: none;
            border-bottom: 1px solid var(--lm-light-gray);
            transition: all 0.3s;
        }
        
        .lm-dropdown-content a:hover {
            background-color: #f0f7ff;
            padding-left: 22px;
        }
        
        .lm-dropdown-content a i {
            margin-right: 12px;
            color: var(--lm-primary);
            font-size: 16px;
            width: 20px;
            text-align: center;
        }
        
        .lm-dropdown-content a:last-child {
            border-bottom: none;
        }
        
        /* Class để hiển thị danh sách, đã đổi tên */
        .lm-show {
            display: block;
            animation: lm-fadeIn 0.3s;
        }
        
        @keyframes lm-fadeIn {
            from { opacity: 0; transform: translateY(-10px); } /* Điều chỉnh animation */
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* CSS cho màn hình nhỏ (mobile) */
        @media (max-width: 600px) {
            .lm-container {
                top: 15px;
                right: 15px;
            }
            
            .lm-dropdown-content {
                min-width: 280px;
            }
            
            .lm-button {
                padding: 10px 15px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="lm-container">
        <div class="lm-button" onclick="toggleLinkManagerDropdown()">
            <i class="fas fa-link"></i> ỨNG DỤNG QL 1
        </div>
        <div id="linkManagerDropdown" class="lm-dropdown-content">
            <a href="https://congtyideco.github.io/quanlydathang/" target="_blank">
                <i class="fas fa-newspaper"></i>
                <span>QUẢN LÝ KHÁCH HÀNG ĐẶT HÀNG</span>
            </a>
            <a href="https://congtyideco.github.io/quanlyCNTdathang/" target="_blank">
                <i class="fas fa-newspaper"></i>
                <span>QUẢN LÝ CHUỖI NT ĐẶT HÀNG </span>
            </a>
            <a href="https://congtyideco.github.io/kiemtragiaCNT/" target="_blank">
                <i class="fas fa-comments"></i>
                <span>KIỂM TRA GIÁ CNT LC-PMC</span>
            </a>
            <a href="https://congtyideco.github.io/truhangmuaCNT-KH" target="_blank">
                <i class="fas fa-truck-loading"></i>
                <span>DỰ TRÙ ĐƠN MUA THUỐC TRỮ CNT-KH</span>
            </a>
            <a href="https://congtyideco.github.io/phantichDSKHkynaykytruoc/" target="_blank">
                <i class="fas fa-desktop"></i>
                <span>XEM PHÂN TÍCH DS KH KỲ NÀY vs KỲ TRƯỚC</span>
            </a>
            <a href="https://congtyideco.github.io/dubaophantichAI/" target="_blank">
                <i class="fas fa-desktop"></i>
                <span>DỰ BÁO SẢN LƯỢNG  BỞI AI </span>
            </a>
            <a href="https://congtyideco.github.io/speech2text/"target="_blank">
                <i class="fas fa-desktop"></i>
                <span>CHUYỂN GIỌNG NÓI THÀNH VĂN BẢN  </span>
            </a>
			<a href="https://congtyideco.github.io/tachanhchupsanpham" target="_blank">
                <i class="fas fa-desktop"></i>
                <span>TÁCH ẢNH SP THEO KHUÔN KHỔ CHỌN CHUYÊN NGHIỆP</span>
            </a>
			<a href="https://congtyideco.github.io/baogiaanhchuyennghiep/" target="_blank">
                <i class="fas fa-desktop"></i>
                <span>LÀM BÁO GIÁ BẰNG ẢNH CHUYÊN NGHIỆP -IDECO</span>
            </a>
			
        </div>
    </div>

    <script>
        // Đổi tên hàm để tránh trùng lặp
        function toggleLinkManagerDropdown() {
            // Sử dụng id mới
            document.getElementById("linkManagerDropdown").classList.toggle("lm-show");
        }
        
        // Đóng dropdown khi click bên ngoài
        window.onclick = function(event) {
            // Sử dụng class mới của nút bấm
            if (!event.target.matches('.lm-button') && !event.target.matches('.lm-button *')) {
                var dropdown = document.getElementById("linkManagerDropdown"); // Sử dụng id mới
                // Sử dụng class hiển thị mới
                if (dropdown.classList.contains('lm-show')) {
                    dropdown.classList.remove('lm-show');
                }
            }
        }
    </script>
</body>
</html>





<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Group</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            position: relative;
        }
        
        #chatIcon {
            position: fixed;
            bottom: 183px;
            right: 20px;
            width: 120px;
            height: 48px;
            background-color: red;
            color: white;
            border: 2px solid white;
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-weight: bold;
            z-index: 1000;
        }
        
        #chatIcon:hover {
            opacity: 0.9;
        }
        
        .popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 800px;
            max-width: 90%;
            max-height: 80vh;
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
            z-index: 999;
            padding: 20px;
            box-sizing: border-box;
            flex-direction: column;
        }
        
        #editorPopup {
            height: auto;
            min-height: 200px;
        }
        
        #messagePopup {
            height: auto;
            min-height: 200px;
        }
        
        #textEditor {
            width: 100%;
            height: 350px;
            margin-bottom: 15px;
            padding: 15px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 8px;
            resize: none;
            font-size: 16px;
            line-height: 1.6;
            overflow-y: auto; /* Thêm thanh cuộn khi cần */
        }
        
        .button-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        button {
            padding: 10px 18px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            font-size: 15px;
            transition: all 0.2s;
        }
        
        button:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        #startBtn {
            background-color: #4CAF50;
            color: white;
        }
        
        #stopBtn {
            background-color: #f44336;
            color: white;
        }
        
        #clearBtn {
            background-color: #ff9800;
            color: white;
        }
        
        #clearAllBtn {
            background-color: #9c27b0;
            color: white;
        }
        
        #sendBtn {
            background-color: #2196F3;
            color: white;
        }
        
        #replyBtn {
            background-color: #2196F3;
            color: white;
        }
        
        #resendBtn {
            background-color: #4CAF50;
            color: white;
        }
        
        #messageContent {
            font-size: 18px;
            line-height: 1.8;
            white-space: pre-wrap;
            padding: 15px;
            border: 1px solid #eee;
            border-radius: 8px;
            background-color: #f9f9f9;
            max-height: 60vh; /* Giới hạn chiều cao tối đa */
            overflow-y: auto; /* Thêm thanh cuộn khi cần */
            word-wrap: break-word; /* Tự động xuống dòng cho từ dài */
        }
        
        .status {
            margin-top: 15px;
            font-style: italic;
            color: #666;
            font-size: 14px;
        }
        
        .interim {
            color: #999;
            font-style: italic;
            margin-top: 5px;
        }
        
        .message-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        
        @media (max-width: 850px) {
            .popup {
                width: 95%;
                padding: 15px;
            }
            
            #textEditor {
                height: 300px;
            }
            
            #messageContent {
                max-height: 50vh; /* Giảm chiều cao trên mobile */
            }
        }
    
@media (max-width: 600px) {
    .popup {
        width: 100%;
        height: 100vh;
        border-radius: 0;
        top: 0;
        left: 0;
        transform: none;
        padding: 20px 10px;
        overflow-y: auto;
    }

    #textEditor {
        height: 250px;
    }

    .button-group {
        flex-direction: column;
        gap: 8px;
    }

    button {
        width: 100%;
        font-size: 16px;
    }

    #messageContent {
        font-size: 16px;
        padding: 10px;
    }

    #chatIcon {
        bottom: 20px;
        right: 20px;
        width: auto;
        height: auto;
        padding: 12px 20px;
        font-size: 16px;
    }
}

<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Group (SAFE)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            position: relative;
        }
        #chatgroup_chatIcon {
            position: fixed;
            bottom: 183px;
            right: 20px;
            width: 120px;
            height: 48px;
            background-color: red;
            color: white;
            border: 2px solid white;
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-weight: bold;
            z-index: 1000;
        }
        #chatgroup_chatIcon:hover { opacity: 0.9; }
        .chatgroup_xupup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 800px;
            max-width: 90%;
            max-height: 80vh;
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
            z-index: 999;
            padding: 20px;
            box-sizing: border-box;
            flex-direction: column;
        }
        #chatgroup_editorXupup { height: auto; min-height: 200px; }
        #chatgroup_messageXupup { height: auto; min-height: 200px; }
        #chatgroup_textEditor {
            width: 100%;
            height: 350px;
            margin-bottom: 15px;
            padding: 15px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 8px;
            resize: none;
            font-size: 16px;
            line-height: 1.6;
            overflow-y: auto;
        }
        .chatgroup_button-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        .chatgroup_btn {
            padding: 10px 18px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            font-size: 15px;
            transition: all 0.2s;
        }
        .chatgroup_btn:hover { opacity: 0.9; transform: translateY(-2px);}
        #chatgroup_startBtn { background-color: #4CAF50; color: white;}
        #chatgroup_stopBtn { background-color: #f44336; color: white;}
        #chatgroup_clearBtn { background-color: #ff9800; color: white;}
        #chatgroup_clearAllBtn { background-color: #9c27b0; color: white;}
        #chatgroup_sendBtn { background-color: #2196F3; color: white;}
        #chatgroup_replyBtn { background-color: #2196F3; color: white;}
        #chatgroup_resendBtn { background-color: #4CAF50; color: white;}
        #chatgroup_messageContent {
            font-size: 18px;
            line-height: 1.8;
            white-space: pre-wrap;
            padding: 15px;
            border: 1px solid #eee;
            border-radius: 8px;
            background-color: #f9f9f9;
            max-height: 60vh;
            overflow-y: auto;
            word-wrap: break-word;
        }
        .chatgroup_status {
            margin-top: 15px;
            font-style: italic;
            color: #666;
            font-size: 14px;
        }
        .chatgroup_interim {
            color: #999;
            font-style: italic;
            margin-top: 5px;
        }
        .chatgroup_message-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        #chatgroup_messageContent b, #chatgroup_messageContent strong { font-weight: bold; }
        #chatgroup_messageContent i, #chatgroup_messageContent em { font-style: italic; }
        #chatgroup_messageContent u { text-decoration: underline; }
        #chatgroup_messageContent s { text-decoration: line-through; }
        #chatgroup_messageContent span[style] { display: inline !important; }
        @media (max-width: 850px) {
            .chatgroup_xupup { width: 95%; padding: 15px;}
            #chatgroup_textEditor { height: 300px;}
            #chatgroup_messageContent { max-height: 50vh;}
        }
        @media (max-width: 600px) {
            .chatgroup_xupup { width: 100%; height: 100vh; border-radius: 0; top: 0; left: 0; transform: none; padding: 20px 10px; overflow-y: auto;}
            #chatgroup_textEditor { height: 250px;}
            .chatgroup_button-group { flex-direction: column; gap: 8px;}
            .chatgroup_btn { width: 100%; font-size: 16px;}
            #chatgroup_messageContent { font-size: 16px; padding: 10px;}
            #chatgroup_chatIcon { bottom: 20px; right: 20px; width: auto; height: auto; padding: 12px 20px; font-size: 16px;}
        }
    </style>
</head>
<body>
    <div id="chatgroup_chatIcon">Chat Group</div>
    <div id="chatgroup_editorXupup" class="chatgroup_xupup">
        <input id="chatgroup_usernameInput" placeholder="Tên bạn" style="width: 60%; padding: 10px; font-size: 16px; margin-bottom: 12px; border-radius: 8px; border: 1px solid #2196f3; background-color: #e3f2fd;" />
        <div id="chatgroup_toolbar" style="margin-bottom: 10px;">
            <button class="chatgroup_btn" onclick="chatgroup_formatText('bold')"><b>B</b></button>
            <button class="chatgroup_btn" onclick="chatgroup_formatText('italic')"><i>I</i></button>
            <button class="chatgroup_btn" onclick="chatgroup_formatText('underline')"><u>U</u></button>
            <button class="chatgroup_btn" onclick="chatgroup_formatText('strikeThrough')"><s>S</s></button>
            <input type="color" onchange="chatgroup_formatText('foreColor', this.value)" title="Đổi màu chữ" />
        </div>
        <div contenteditable="true" id="chatgroup_textEditor" placeholder="Nhập tin nhắn hoặc sử dụng nút 'Bắt đầu nói'..."></div>
        <div class="chatgroup_button-group">
            <button id="chatgroup_startBtn" class="chatgroup_btn">🎤 Bắt đầu nói</button>
            <button id="chatgroup_stopBtn" class="chatgroup_btn" disabled>⏹️ Dừng</button>
            <button id="chatgroup_clearBtn" class="chatgroup_btn">🗑️ Xóa</button>
            <button id="chatgroup_clearAllBtn" class="chatgroup_btn">💣 Xóa Tất Cả</button>
            <button id="chatgroup_sendBtn" class="chatgroup_btn">✉️ Gửi</button>
        </div>
        <div id="chatgroup_recordingStatus" class="chatgroup_status"></div>
        <div id="chatgroup_interimResult" class="chatgroup_interim"></div>
    </div>
    <div id="chatgroup_messageXupup" class="chatgroup_xupup">
        <div id="chatgroup_messageHistory" style="margin-bottom: 20px;"></div>
        <div id="chatgroup_messageContent"></div>
        <div class="chatgroup_message-buttons">
            <button id="chatgroup_resendBtn" class="chatgroup_btn">🔄 Nhắc lại</button>
            <button id="chatgroup_clearXupupHistoryBtn" class="chatgroup_btn">🧹 Xóa Lịch Sử</button>
            <button id="chatgroup_replyBtn" class="chatgroup_btn">↩️ Trả lời</button>
        </div>
    </div>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script>
    // Bọc toàn bộ code vào 1 function riêng
    (function() {
        // Khởi tạo Firebase riêng biệt cho app ChatGroup
        const firebaseConfig_chatgroup = {
            apiKey: "AIzaSyBIp68MT7Sh72-ZibE6iYr3hZCzTfCcY_k",
            authDomain: "podcastideco1.firebaseapp.com",
            projectId: "podcastideco1",
            storageBucket: "podcastideco1.firebasestorage.app",
            messagingSenderId: "219029042374",
            appId: "1:219029042374:web:f6ddb9f7abe755aa7953c7",
            measurementId: "G-0WH57T6Q58"
        };
        const appChatgroup = firebase.initializeApp(firebaseConfig_chatgroup, "chatgroup_app");
        const dbChatgroup = appChatgroup.database();

        // DOM elements (prefix all)
        const chatgroup_chatIcon = document.getElementById('chatgroup_chatIcon');
        const chatgroup_editorXupup = document.getElementById('chatgroup_editorXupup');
        const chatgroup_messageXupup = document.getElementById('chatgroup_messageXupup');
        const chatgroup_textEditor = document.getElementById('chatgroup_textEditor');
        const chatgroup_startBtn = document.getElementById('chatgroup_startBtn');
        const chatgroup_stopBtn = document.getElementById('chatgroup_stopBtn');
        const chatgroup_clearBtn = document.getElementById('chatgroup_clearBtn');
        const chatgroup_clearAllBtn = document.getElementById('chatgroup_clearAllBtn');
        const chatgroup_sendBtn = document.getElementById('chatgroup_sendBtn');
        const chatgroup_replyBtn = document.getElementById('chatgroup_replyBtn');
        const chatgroup_resendBtn = document.getElementById('chatgroup_resendBtn');
        const chatgroup_messageContent = document.getElementById('chatgroup_messageContent');
        const chatgroup_recordingStatus = document.getElementById('chatgroup_recordingStatus');
        const chatgroup_interimResult = document.getElementById('chatgroup_interimResult');
        const chatgroup_clearXupupHistoryBtn = document.getElementById('chatgroup_clearXupupHistoryBtn');
        const chatgroup_usernameInput = document.getElementById('chatgroup_usernameInput');

        // Speech recognition
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition;
        let isListening = false;
        let finalTranscript = '';
        let ignoreOnend = false;
        let silenceTimer;
        const SILENCE_DELAY = 1500;
        let lastMessageTimestamp = 0;
        let currentMessage = '';

        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.continuous = true;
            recognition.interimResults = true;
            recognition.lang = 'vi-VN';
            recognition.onstart = () => {
                isListening = true;
                chatgroup_startBtn.disabled = true;
                chatgroup_stopBtn.disabled = false;
                chatgroup_recordingStatus.textContent = "Đang nghe... Hãy nói gì đó";
                ignoreOnend = false;
                finalTranscript = '';
                chatgroup_textEditor.blur();
                chatgroup_textEditor.innerHTML = '';
                chatgroup_interimResult.textContent = '';
            };
            recognition.onend = () => {
                isListening = false;
                chatgroup_startBtn.disabled = false;
                chatgroup_stopBtn.disabled = true;
                if (ignoreOnend) return;
                if (chatgroup_recordingStatus.textContent === "Đang nghe... Hãy nói gì đó") {
                    chatgroup_recordingStatus.textContent = "Đã dừng";
                }
                clearTimeout(silenceTimer);
            };
            recognition.onresult = (event) => {
                clearTimeout(silenceTimer);
                let interimTranscript = '';
                let finalTranscriptTemp = '';
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const transcript = event.results[i][0].transcript;
                    if (event.results[i].isFinal) {
                        finalTranscriptTemp += transcript + '. ';
                    } else {
                        interimTranscript += transcript;
                    }
                }
                finalTranscript += finalTranscriptTemp;
                chatgroup_textEditor.innerHTML = finalTranscript + interimTranscript;
                chatgroup_interimResult.textContent = interimTranscript;
                if (interimTranscript) {
                    silenceTimer = setTimeout(() => { chatgroup_interimResult.textContent = ''; }, 1500);
                }
            };
            recognition.onerror = (event) => {
                console.error('Speech recognition error', event.error);
                if (event.error === 'no-speech') {
                    chatgroup_recordingStatus.textContent = 'Không phát hiện giọng nói. Hãy thử lại';
                    ignoreOnend = true;
                } else if (event.error === 'audio-capture') {
                    chatgroup_recordingStatus.textContent = 'Không tìm thấy microphone';
                    ignoreOnend = true;
                } else if (event.error === 'not-allowed') {
                    chatgroup_recordingStatus.textContent = 'Truy cập microphone bị chặn. Vui lòng cho phép truy cập';
                    ignoreOnend = true;
                } else {
                    chatgroup_recordingStatus.textContent = `Lỗi: ${event.error}`;
                }
                clearTimeout(silenceTimer);
            };
        } else {
            chatgroup_recordingStatus.textContent = "Trình duyệt không hỗ trợ nhận dạng giọng nói";
            chatgroup_startBtn.disabled = true;
        }

        // Event listeners
        chatgroup_chatIcon.addEventListener('click', toggleXupupChatgroup);
        chatgroup_startBtn.addEventListener('click', startXupupRecordingChatgroup);
        chatgroup_stopBtn.addEventListener('click', stopXupupRecordingChatgroup);
        chatgroup_clearBtn.addEventListener('click', clearXupupTextChatgroup);
        chatgroup_clearAllBtn.addEventListener('click', clearAllXupupMessagesChatgroup);
        chatgroup_sendBtn.addEventListener('click', sendXupupMessageChatgroup);
        chatgroup_replyBtn.addEventListener('click', replyXupupMessageChatgroup);
        chatgroup_resendBtn.addEventListener('click', resendXupupMessageChatgroup);
        chatgroup_clearXupupHistoryBtn.addEventListener('click', clearXupupHistoryChatgroup);

        // Lưu và tải tên người dùng
        chatgroup_usernameInput.value = localStorage.getItem('chatgroup_username') || '';
        chatgroup_usernameInput.addEventListener('change', () => {
            localStorage.setItem('chatgroup_username', chatgroup_usernameInput.value);
        });

        // Firebase listener for new messages
        dbChatgroup.ref('messages').limitToLast(1).on('child_added', (snapshot) => {
            const message = snapshot.val();
            if (message.timestamp > lastMessageTimestamp) {
                lastMessageTimestamp = message.timestamp;
                currentMessage = message.text;
                showXupupMessageChatgroup(message.text);
            }
        });
        loadXupupChatHistoryChatgroup();

        // Functions (prefix tất cả)
        function toggleXupupChatgroup() {
            if (chatgroup_editorXupup.style.display === 'flex' || chatgroup_messageXupup.style.display === 'flex') {
                chatgroup_editorXupup.style.display = 'none';
                chatgroup_messageXupup.style.display = 'none';
                if (isListening && recognition) recognition.stop();
            } else {
                if (currentMessage) {
                    chatgroup_messageXupup.style.display = 'flex';
                    chatgroup_editorXupup.style.display = 'none';
                } else {
                    chatgroup_editorXupup.style.display = 'flex';
                    chatgroup_messageXupup.style.display = 'none';
                    chatgroup_textEditor.focus();
                }
            }
        }
        function startXupupRecordingChatgroup() {
            if (recognition) {
                finalTranscript = '';
                chatgroup_textEditor.blur();
                chatgroup_textEditor.innerHTML = '';
                chatgroup_interimResult.textContent = '';
                recognition.start();
            }
        }
        function stopXupupRecordingChatgroup() {
            if (isListening && recognition) {
                ignoreOnend = true;
                recognition.stop();
                chatgroup_recordingStatus.textContent = "Đã dừng";
                chatgroup_interimResult.textContent = '';
                clearTimeout(silenceTimer);
            }
        }
        function clearXupupTextChatgroup() {
            chatgroup_textEditor.blur();
            chatgroup_textEditor.innerHTML = '';
            finalTranscript = '';
            chatgroup_interimResult.textContent = '';
            chatgroup_recordingStatus.textContent = '';
        }
        function clearAllXupupMessagesChatgroup() {
            if (confirm("Bạn có chắc chắn muốn xóa TẤT CẢ tin nhắn? Hành động này không thể hoàn tác!")) {
                dbChatgroup.ref('messages').remove()
                    .then(() => {
                        alert("Đã xóa tất cả tin nhắn thành công!");
                        clearXupupTextChatgroup();
                        chatgroup_messageContent.innerHTML = '';
                        chatgroup_interimResult.textContent = '';
                        chatgroup_recordingStatus.textContent = '';
                        lastMessageTimestamp = 0;
                        currentMessage = '';
                        chatgroup_messageXupup.style.display = 'none';
                        chatgroup_editorXupup.style.display = 'flex';
                    })
                    .catch((error) => {
                        console.error("Lỗi khi xóa tin nhắn:", error);
                        alert("Có lỗi xảy ra khi xóa tin nhắn. Vui lòng thử lại!");
                    });
            }
        }
        function sendXupupMessageChatgroup() {
            let messageText = chatgroup_textEditor.innerHTML.trim();
            messageText = chatgroup_cleanHTML(messageText);
            if (messageText) {
                currentMessage = messageText;
                const timestamp = Date.now();
                const sender = chatgroup_usernameInput.value.trim() || 'Ẩn danh';
                localStorage.setItem('chatgroup_username', sender);
                dbChatgroup.ref('messages').push({
                    text: messageText,
                    sender: sender,
                    timestamp: timestamp
                });
                lastMessageTimestamp = timestamp;
                showXupupMessageChatgroup(messageText);
                chatgroup_editorXupup.style.display = 'none';
                clearXupupTextChatgroup();
                if (isListening && recognition) recognition.stop();
            }
        }
        function resendXupupMessageChatgroup() {
            if (currentMessage) {
                const timestamp = Date.now();
                dbChatgroup.ref('messages').push({
                    text: currentMessage,
                    timestamp: timestamp
                });
                lastMessageTimestamp = timestamp;
                chatgroup_recordingStatus.textContent = "Đã gửi lại tin nhắn";
                setTimeout(() => { chatgroup_recordingStatus.textContent = ""; }, 2000);
            }
        }
        function showXupupMessageChatgroup(text) {
            chatgroup_messageContent.innerHTML = chatgroup_cleanHTML(text);
            chatgroup_editorXupup.style.display = 'none';
            chatgroup_messageXupup.style.display = 'flex';
            chatgroup_messageContent.scrollTop = chatgroup_messageContent.scrollHeight;
        }
        function replyXupupMessageChatgroup() {
            chatgroup_messageXupup.style.display = 'none';
            chatgroup_editorXupup.style.display = 'flex';
            chatgroup_textEditor.focus();
        }
        function loadXupupChatHistoryChatgroup() {
            dbChatgroup.ref('messages').limitToLast(8).on('value', (snapshot) => {
                const historyDiv = document.getElementById('chatgroup_messageHistory');
                historyDiv.innerHTML = '';
                snapshot.forEach((childSnapshot) => {
                    const message = childSnapshot.val();
                    const msgEl = document.createElement('div');
                    msgEl.innerHTML = `• <strong>${message.sender || 'Ẩn danh'}:</strong> ${chatgroup_cleanHTML(message.text)}`;
                    msgEl.style.padding = '6px 0';
                    msgEl.style.borderBottom = '1px dashed #ccc';
                    msgEl.style.fontSize = '16px';
                    historyDiv.appendChild(msgEl);
                });
            });
        }
        function clearXupupHistoryChatgroup() {
            if (confirm("Bạn có chắc muốn xóa tất cả lịch sử chat?")) {
                dbChatgroup.ref('messages').remove();
            }
        }
        // Hàm format text phải gắn window để gọi được từ html
        window.chatgroup_formatText = function(command, value = null) {
            document.execCommand(command, false, value);
        }
        // Clean HTML giữ lại format cơ bản
        function chatgroup_cleanHTML(html) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = html;
            const allowedTags = ['b', 'i', 'u', 's', 'strong', 'em', 'span', 'br'];
            const elements = tempDiv.querySelectorAll('*');
            elements.forEach(el => {
                if (!allowedTags.includes(el.tagName.toLowerCase())) {
                    const parent = el.parentNode;
                    while (el.firstChild) {
                        parent.insertBefore(el.firstChild, el);
                    }
                    parent.removeChild(el);
                    return;
                }
                Array.from(el.attributes).forEach(attr => {
                    if (attr.name !== 'style' && attr.name !== 'color') {
                        el.removeAttribute(attr.name);
                    }
                });
            });
            return tempDiv.innerHTML;
        }
    })();
    </script>
</body>
</html>


<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DỮ LIỆU KHÁCH HÀNG</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
        }
        
        .customer-data-btn {
            position: fixed;
            top: 62px;
            right: 240px;
            width: 160px;
            height: 45px;
            background-color: white;
            border: 2px solid red;
            border-radius: 6px;
            box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.15);
            text-align: center;
            line-height: 45px;
            font-weight: bold;
            font-size: 14px;
            color: #333;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .customer-data-btn:hover {
            background-color: #f8f8f8;
            box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);
            transform: translateY(-2px);
        }
        
        .jopup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .jopup-content {
            width: 1300px;
            height: 800px;
            background-color: white;
            border: 3px solid red;
            border-radius: 10px;
            box-shadow: 0 0 25px rgba(0, 0, 0, 0.4);
            padding: 15px;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .jopup-close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 24px;
            cursor: pointer;
            color: #555;
            z-index: 1001;
            background: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #ddd;
        }
        
        .jopup-close-btn:hover {
            background: #f0f0f0;
        }
        
        .drive-container {
            width: 100%;
            flex-grow: 1;
            border: none;
            margin-top: 10px;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .jopup-title {
            text-align: center;
            color: red;
            margin: 5px 0 15px 0;
            font-size: 18px;
        }
        
        .search-container {
            padding: 10px;
            background: #f5f5f5;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        
        .search-box {
            width: 100%;
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 14px;
            outline: none;
        }
        
        .search-box:focus {
            border-color: red;
            box-shadow: 0 0 5px rgba(255, 0, 0, 0.3);
        }
        
        .view-options {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .view-btn {
            padding: 5px 10px;
            background: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
        }
        
        .view-btn.active {
            background: red;
            color: white;
            border-color: red;
        }
    </style>
</head>
<body>
    <div class="customer-data-btn" id="customerDataBtn">Dữ liệu khách hàng</div>
    
    <div class="jopup-overlay" id="jopupOverlay">
        <div class="jopup-content">
            <span class="jopup-close-btn" id="jopupCloseBtn">&times;</span>
            <h2 class="jopup-title"> NÊN ĐẶT MỤC TIÊU MỖI NGÀY PHẢI TIẾP CẬN ÍT NHẤT 3 KH MỚI - ÁP DỤNG ỨNG DỤNG PHÁT TRIỂN KHÁCH HÀNG MỚI</h2>
            
            <div class="search-container">
                <input type="text" class="search-box" id="searchBox" placeholder="Tìm kiếm tên file...">
                <div class="view-options">
                    <button class="view-btn active" data-view="list">Danh sách</button>
                    <button class="view-btn" data-view="grid">Lưới</button>
                </div>
            </div>
            
            <div class="drive-container">
                <iframe src="https://drive.google.com/embeddedfolderview?id=1DB7wxD1fVSaCbVBRTY4sptZwqEwp7bjU#list" 
                        frameborder="0" 
                        width="100%" 
                        height="100%"
                        allowfullscreen
                        id="driveIframe">
                </iframe>
            </div>
        </div>
    </div>
    
    <script>
        const customerDataBtn = document.getElementById('customerDataBtn');
        const jopupOverlay = document.getElementById('jopupOverlay');
        const jopupCloseBtn = document.getElementById('jopupCloseBtn');
        const searchBox = document.getElementById('searchBox');
        const driveIframe = document.getElementById('driveIframe');
        const viewBtns = document.querySelectorAll('.view-btn');
        
        // Mở jopup khi click icon
        customerDataBtn.addEventListener('click', function() {
            jopupOverlay.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        });
        
        // Đóng jopup
        function closeJopup() {
            jopupOverlay.style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        
        jopupCloseBtn.addEventListener('click', closeJopup);
        
        jopupOverlay.addEventListener('click', function(e) {
            if (e.target === jopupOverlay) {
                closeJopup();
            }
        });
        
        // Đóng bằng phím ESC
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && jopupOverlay.style.display === 'flex') {
                closeJopup();
            }
        });
        
        // Chuyển đổi chế độ xem
        viewBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                viewBtns.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                const viewType = this.getAttribute('data-view');
                const currentSrc = driveIframe.src;
                const newSrc = viewType === 'list' 
                    ? currentSrc.replace(/#grid|#list/, '#list')
                    : currentSrc.replace(/#grid|#list/, '#grid');
                
                driveIframe.src = newSrc;
            });
        });
        
        // Tìm kiếm (chức năng này yêu cầu quyền truy cập API Google Drive để hoạt động đầy đủ)
        searchBox.addEventListener('input', function() {
            // Trong thực tế, cần tích hợp API Google Drive để tìm kiếm chính xác
            // Đây chỉ là demo UI
            console.log('Tìm kiếm:', this.value);
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BÁO LINK WEBSITE</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2c6fd1;
            --primary-dark: #1a56b4;
            --light: #f8fafc;
            --dark: #1e293b;
            --gray: #64748b;
            --light-gray: #e2e8f0;
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --radius: 8px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f1f5f9;
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .icon-container {
            position: fixed;
            bottom: 130px;
            right: 20px;
            z-index: 1000;
        }
        
        .icon {
            display: inline-block;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 12px 18px;
            border: 2px solid white;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: bold;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            font-size: 15px;
        }
        
        .icon:hover {
            background: linear-gradient(135deg, var(--primary-dark), #0047ab);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            bottom: 100%;
            background-color: white;
            min-width: 320px;
            max-height: 400px;
            overflow-y: auto;
            box-shadow: var(--shadow);
            z-index: 1;
            border-radius: var(--radius);
            margin-bottom: 15px;
        }
        
        .dropdown-content a {
            display: flex;
            align-items: center;
            color: #333;
            padding: 14px 18px;
            text-decoration: none;
            border-bottom: 1px solid var(--light-gray);
            transition: all 0.3s;
        }
        
        .dropdown-content a:hover {
            background-color: #f0f7ff;
            padding-left: 22px;
        }
        
        .dropdown-content a i {
            margin-right: 12px;
            color: var(--primary);
            font-size: 16px;
            width: 20px;
            text-align: center;
        }
        
        .dropdown-content a:last-child {
            border-bottom: none;
        }
        
        .show {
            display: block;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Ẩn thông báo */
        .notification {
            display: none;
        }
        
        @media (max-width: 600px) {
            .icon-container {
                bottom: 100px;
                right: 15px;
            }
            
            .dropdown-content {
                min-width: 280px;
                right: -10px;
            }
            
            .icon {
                padding: 10px 15px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="icon-container">
        <div class="icon" onclick="toggleDropdown()">
            <i class="fas fa-link"></i> ỨNG DỤNG QL2 
        </div>
        <div id="dropdown" class="dropdown-content">
            <a href="https://congtyideco.github.io/ketoanchecklist" target="_blank">
                <i class="fas fa-newspaper"></i>
                <span>CHECKLIST CÔNG VIỆC KẾ TOÁN TRONG KỲ</span>
            </a>
			 <a href="https://congtyideco.github.io/kdchecklist" target="_blank">
                <i class="fas fa-newspaper"></i>
                <span>CHECKLIST CÔNG VIỆC KINH DOANH TRONG KỲ</span>
            </a>
			 <a href="https://congtyideco.github.io/khovanchecklist" target="_blank">
                <i class="fas fa-newspaper"></i>
                <span>CHECKLIST CÔNG VIỆC KHO - GIAO NHẬN -SOP</span>
            </a>
			  <a href="https://congtyideco.github.io/xemthuoc/" target="_blank">
                <i class="fas fa-desktop"></i>
                <span>TRA CỨU THUỐC NỘI BỘ DESKTOP</span>
            </a>
            <a href="https://congtyideco.github.io/xemdmp/" target="_blank">
                <i class="fas fa-desktop"></i>
                <span>TRA CỨU UVS - MỸ PHẨM NỘI BỘ DESKTOP</span>
            </a>
			<a href="https://congtyideco.github.io/checkdate" target="_blank">
                <i class="fas fa-newspaper"></i>
                <span>TRA CỨU ẢNH THUỐC LÔ DATE -HẠN DÙNG</span>
            </a>
           
            <a href="https://congtyideco.github.io/giaonhan" target="_blank">
                <i class="fas fa-truck-loading"></i>
                <span>QUẢN LÝ ĐÓNG HÀNG- GIAO HÀNG TRONG KỲ</span>
            </a>
          
            <a href="https://congtyideco.github.io/khuyenmai" target="_blank">
                <i class="fas fa-desktop"></i>
                <span>TRA CỨU CHƯƠNG TRÌNH KHUYẾN MẠI </span>
            </a>
			<a href="https://congtyideco.github.io/chuoiNT" target="_blank">
                <i class="fas fa-desktop"></i>
                <span>QUẢN LÝ DANH MỤC SP TẠI CHUỖI NT </span>
            </a>
			<a href="https://congtyideco.github.io/giavonthuoc" target="_blank">
                <i class="fas fa-desktop"></i>
                <span>TRA CỨU GIÁ VÔN THUỐC -BGD- KẾ TOÁN </span>
            </a>
        </div>
    </div>

    <script>
        function toggleDropdown() {
            document.getElementById("dropdown").classList.toggle("show");
        }
        
        // Đóng dropdown khi click bên ngoài
        window.onclick = function(event) {
            if (!event.target.matches('.icon') && !event.target.matches('.icon *')) {
                var dropdown = document.getElementById("dropdown");
                if (dropdown.classList.contains('show')) {
                    dropdown.classList.remove('show');
                }
            }
        }
    </script>
</body>
</html>


<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>THÔNG BÁO NHẮC – IDECO</title>
  <style>
    /* ===== Namespace: ideco- (tránh xung đột CSS ngoài) ===== */
    #idecoPopupRoot { all: initial; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; }
    #idecoPopupRoot, #idecoPopupRoot * { box-sizing: border-box; }

    #idecoPopupRoot{ 
      --ideco-red:#e02424; 
      --ideco-blue:#248ae0; 
      --ideco-yellow:#e0a424; 
      --ideco-white:#ffffff;
      --ideco-overlay:rgba(0,0,0,.35); 
      --ideco-radius:18px; 
      --ideco-shadow:0 20px 60px rgba(0,0,0,.35), 0 6px 20px rgba(0,0,0,.22); 
    }

    /* CỤM NÚT ICON (góc trái dưới) */
    #idecoPopupRoot .ideco-notify-container {
      position: fixed;
      bottom: 20px;
      left: 20px;
      display: flex;
      flex-direction: column-reverse;
      gap: 10px;
      z-index: 100000;
    }
    #idecoPopupRoot .ideco-notify-btn{
      width:10px; height:10px;
      border-radius:50%;
      box-shadow:0 2px 8px rgba(0,0,0,.3);
      cursor:pointer;
      border:2px solid #fff;
      outline:none;
      display:inline-block;
    }
    #idecoPopupRoot .ideco-notify-btn.red { background:var(--ideco-red); }
    #idecoPopupRoot .ideco-notify-btn.blue { background:var(--ideco-blue); }
    #idecoPopupRoot .ideco-notify-btn.yellow { background:var(--ideco-yellow); }
    #idecoPopupRoot .ideco-notify-btn.white { background:var(--ideco-white); border-color:#ddd; }

    /* LỚP PHỦ (không cho đóng bằng click) */
    #idecoPopupRoot .ideco-overlay{
      position:fixed; inset:0;
      background:var(--ideco-overlay);
      display:none; z-index:99999;
      pointer-events:none;
    }
    #idecoPopupRoot .ideco-overlay.ideco-open{ display:block; }

    /* POPUP: kích thước mới 1000×750 (max) + responsive */
    #idecoPopupRoot .ideco-popup{
      position:fixed; top:50%; left:50%;
      transform:translate(-50%,-50%) scale(.97);
      width:min(1000px,96vw); 
      height:min(750px,90vh);
      background:#fff;
      border:3px solid;
      border-radius:var(--ideco-radius);
      box-shadow:var(--ideco-shadow);
      display:none; z-index:100001; opacity:0;
      transition:opacity .2s ease, transform .2s ease;
    }
    #idecoPopupRoot .ideco-popup.red { border-color: var(--ideco-red); animation: ideco-blink-red 1s infinite; }
    #idecoPopupRoot .ideco-popup.blue { border-color: var(--ideco-blue); animation: ideco-blink-blue 1s infinite; }
    #idecoPopupRoot .ideco-popup.yellow { border-color: var(--ideco-yellow); animation: ideco-blink-yellow 1s infinite; }
    #idecoPopupRoot .ideco-popup.white { border-color: var(--ideco-white); animation: ideco-blink-white 1s infinite; }
    #idecoPopupRoot .ideco-popup.ideco-open{ display:block; opacity:1; transform:translate(-50%,-50%) scale(1); }

    @keyframes ideco-blink-red { 0%,50%,100%{border-color:var(--ideco-red);} 25%,75%{border-color:transparent;} }
    @keyframes ideco-blink-blue { 0%,50%,100%{border-color:var(--ideco-blue);} 25%,75%{border-color:transparent;} }
    @keyframes ideco-blink-yellow { 0%,50%,100%{border-color:var(--ideco-yellow);} 25%,75%{border-color:transparent;} }
    @keyframes ideco-blink-white { 0%,50%,100%{border-color:var(--ideco-white);} 25%,75%{border-color:transparent;} }

    #idecoPopupRoot .ideco-popup__content{ padding:20px 22px; height:100%; overflow:auto; font-size:18px; line-height:1.6; }
    @media (max-width:480px){ #idecoPopupRoot .ideco-popup__content{ font-size:16px; } }

    /* TIÊU ĐỀ ĐỎ & CHỮ HOA (dòng đầu tiên, chữ đậm) */
    #idecoPopupRoot .ideco-popup__content p:first-child strong{
      color: var(--ideco-red);
      text-transform: uppercase;
      letter-spacing: .5px;
    }

    /* ====== TOOLTIP ĐẸP CHO ICON ====== */
    #idecoPopupRoot .ideco-tooltip {
      position: relative;
      display: inline-block;
    }
    #idecoPopupRoot .ideco-tooltip::after {
      content: attr(data-tooltip);
      visibility: hidden;
      opacity: 0;
      background-color: rgba(0,0,0,0.85);
      color: #fff;
      text-align: center;
      padding: 6px 10px;
      border-radius: 6px;
      position: absolute;
      bottom: 120%;
      left: 50%;
      transform: translateX(-50%);
      white-space: nowrap;
      font-size: 14px;
      z-index: 100002;
      transition: opacity 0.25s;
      pointer-events: none;
    }
    #idecoPopupRoot .ideco-tooltip::before {
      content: "";
      position: absolute;
      bottom: 110%;
      left: 50%;
      transform: translateX(-50%);
      border-width: 6px;
      border-style: solid;
      border-color: rgba(0,0,0,0.85) transparent transparent transparent;
      visibility: hidden;
      opacity: 0;
      transition: opacity 0.25s;
    }
    #idecoPopupRoot .ideco-tooltip:hover::after,
    #idecoPopupRoot .ideco-tooltip:hover::before {
      visibility: visible;
      opacity: 1;
    }
  </style>
</head>
<body>
  <div id="idecoPopupRoot" aria-live="polite">
    <!-- ICON + TOOLTIP -->
    <div class="ideco-notify-container">
      <div class="ideco-tooltip" data-tooltip="Thông báo sản phẩm mới - Chương trình mới">
        <button class="ideco-notify-btn white" id="idecoNotifyBtnWhite" aria-label="Mở thông báo chung"></button>
      </div>
      <div class="ideco-tooltip" data-tooltip="Thông báo quan trọng - Lời khuyên">
        <button class="ideco-notify-btn red" id="idecoNotifyBtnRed" aria-label="Mở thông báo quan trọng"></button>
      </div>
      <div class="ideco-tooltip" data-tooltip="Thông tin nhắc việc">
        <button class="ideco-notify-btn blue" id="idecoNotifyBtnBlue" aria-label="Mở thông báo thông tin"></button>
      </div>
      <div class="ideco-tooltip" data-tooltip="Lời khuyên cho các em">
        <button class="ideco-notify-btn yellow" id="idecoNotifyBtnYellow" aria-label="Mở thông báo nhắc nhở"></button>
      </div>
    </div>

    <div class="ideco-overlay" id="idecoOverlay" hidden></div>

    <!-- POPUP: ĐỎ -->
    <section class="ideco-popup red" id="idecoPopupRed" role="dialog" aria-modal="true" aria-describedby="idecoPopupDescRed">
      <div class="ideco-popup__content" id="idecoPopupDescRed">
        <p><strong>🔴  CHIA SẼ LẠI NỘI DUNG CÔNG VIỆC CHUNG </strong></p>
        <p><strong>1️⃣ NÊN THƯỜNG XEM LẠI PODCAST ĐÀO TẠO HƯỚNG DẪN CÓ CẬP NHẬT MỚI</strong></p>
        Các em rảnh nhớ nghe lại để nắm rõ và làm thật tốt nhé.</br>
		
        <p><strong>2️⃣ XỬ LÝ CÔNG VIỆC TRONG TUẦN </strong><br>
        Em nhớ kiểm tra lại kế hoạch - Checklist công việc - nếu có phát sinh hãy điều chỉnh bổ sung.</br>
		Các chứng từ mua hàng- bán hàng: nhập liệu khai báo đúng cả 2 phầm mềm Misa- ERP cùng lúc nhé!</br>
		Xem lại các nội dung khai báo trên ERP dể chọn: Hóa đơn đã xuất VAT - Xác nhận -duyệt các phiều đơn hàng- xuất nhập</br>
		Xem lại ỨNG DỤNG KHAI BÁO: cái nào chưa xử lý - tranh thủ nhập lại khai lại- tránh bị sót trôi việc!</br>
		</p>
        <p><strong>3️⃣ NGHIỆP PHỤ CHUYÊN MÔN CHUNG </strong><br>
        Các đơn hàng trong ngày  cố gắng tranh thủ đóng - giao trong buổi sáng càng tốt- nhất là hàng gởi tỉnh xa</br>
        Sản phẩm bị lỗi do nhà cung cấp nên tiến hành bổ sung văn bản- ghi chú xử lý hạch toán hàng trả về đúng nghiệp vụ kế toán- nghiệp vụ kho</br>
		Các khai báo phát sinh chi - thu nên nhập khai đúng ngay Misa- ERP tránh để dồn cuối tháng , phát sinh sai - nhầm </br>
		Luôn cùng team: KẾ TOÁN- KHO VẬN- kiểm định kỳ kho 1 tháng/ lần và Qúy 1 lần ( kiểm toàn diện hết kỹ hơn)</br>
		Kế toán khi phát sinh mã sản phẩm mới: khai đúng đồng bộ Misa-ERP và nhớ luôn khai liên thông công y kế - luôn kiểm tra đồng bộ dữ liệu định kỳ</br>
		 </p>
	  </div>
    </section>

    <!-- POPUP: XANH -->
    <section class="ideco-popup blue" id="idecoPopupBlue" role="dialog" aria-modal="true" aria-describedby="idecoPopupDescBlue">
      <div class="ideco-popup__content" id="idecoPopupDescBlue">
        <p><strong>🔵 CHIA SẼ LỜI KHUYÊN CHO CÁC EM KINH DOANH- KHO VẬN - TRỢ LÝ</strong></p>
        <p><strong>1️⃣  THỰC HIỆN TỐT TRONG NHIỆM VỤ MỞ VÀ PHÁT TRIỂN KHÁCH HÀNG</strong><br>
        DO KHẢ NĂNG TỪ CHỐI NHIỀU- KHẢ NĂNG TRÌ HOÃN GIAO DỊCH LUÔN PHÁT SINH- NGƯỜI THÔNG MINH VÀ CHỦ ĐỘNG THÌ PHẢI:</br>
		- Mỗi ngày, mỗi cá nhân kinh doanh luôn tự đặt ra mục tiêu tìm mới khách hàng ít nhất 3 khách hàng mới, đặc biệt cho nhóm UVS </br>
		- Khi có bất cứ phát sinh giao dịch mới phải khai báo ngay trên báo cáo giao dịch ERP và làm đúng nội dung khai báo có tính cập nhật REAL TIME</br>
		- Khi phát triển khách hàng muốn chốt đơn, chốt hợp tác: nên chuẩn bị trước kịch bản sản phẩm chào - kịch bản bị từ chối - đề ra cách xử lý nó</br>
        - Nhóm UVS: UVS Silicone gel, UVS Raskee; UVS Bionee, UVS Nailcare muốn có đơn phải tìm mọi đối tượng đa dạn: mỹ phẩm, nhà thuốc, chuỗi NT...</br>
		- Muốn có thể chốt hợp tác tốt phải vận dụng mọi kỹ năng xử lý: poster, tin nhắn, zalo, file thông tin sản phẩm để chia sẽ mọi cách tiếp cận.</br>
		- Đừng chát thay vì chịu khó phải tìm cách gọi điện khách hàng để giải thích bất cứ nhu cầu khách hàng hỏi, tạo cảm xúc, chủ động lắng nghe thì tốt hơn.</br>
		</p>
		<p><strong>2️⃣ HƯỚNG DẪN  - QUY TRÌNH - ĐỊNH HƯỚNG VIỆC</strong><br>
        - ĐỂ KHÔNG BỎ SÓT KHÁCH HÀNG LÊN ĐƠN TRONG KỲ, các em kinh doanh phải quản lý ứng dụng khách hàng đặt hàng thành thạo từ danh sách khách hàng được giao.</br>
        - Luôn mở ứng dụng kiểm tra - tìm cách gọi, tiếp xúc có chủ ý muốn bán hàng với khách hàng, đừng hỏi thăm chung chung và tìm cách mời sản phẩm khác.</br>
		- Việc nào ban giám đốc giao, cấp quản lý giao phải chủ động khai báo trong kế hoạch hay thêm vào checklist và xử lý đến cùng - báo cáo .</br>
		- Chủ động nhắc nhở Bộ phận kho- kế toán hỗ trợ xử lý đơn hàng trong tuần hoàn thành cho nhanh thông qua định kỳ xem lại ERP</br>
		</p>		
		
		<p><strong>3️⃣ KHO VẬN- SOP </strong><br>
        - Luôn kiểm tra thủ tục nhập xuất kho theo lô hạn dùng cẩn thận trên mọi chứng từ để đảm bảo truy tìm nhanh-  phải tranh thủ khai bổ sung </br>
        - Khai báo chặt chẽ ứng dụng ĐÓNG HÀNG- GIAO NHẬN- ỨNG DỤNG QUÀN LÝ KHO HÀNG LÔ DATE kỷ- có cùng nhau kiểm tra lại mỗi tuần </br>
		- Ưu tiên xử lý giao đơn hàng Chuỗi Nhà Thuốc lớn khi đóng xong- luôn chia se nhau trong team tình huống cùng xử lý nhanh đơn hàng tránh trôi việc</br>
		- Khai báo form giao nhận- form quản lý điều kiện kho nhiệt đô SOP chặt chẽ mỗi ngày - cùng lưu dữ liệu từ thiết bị định kỳ sau mỗi tháng.</br>
		- Kiểm soát kho: thông qua đinh kỳ tháng cùng kiểm kho- vệ sinh kho- dọn dẹp kho định kỳ tháng- quý / lần</br>
		- Phối hợp xử lý đổi trả hàng đúng thủ tục: biên bản- chứng từ cho nghiệp vụ này phải in lưu rỏ ràng trong bộ phận</br>
	  	- SOP cần kiểm tra kỷ DANH MỤC THUỐC  không kinh doanh thuốc KSĐB và ký mọi thủ tục quy định định kỳ với DS Chuyên môn</br>
		</p>
	  </div>
    </section>

    <!-- POPUP: VÀNG -->
    <section class="ideco-popup yellow" id="idecoPopupYellow" role="dialog" aria-modal="true" aria-describedby="idecoPopupDescYellow">
      <div class="ideco-popup__content" id="idecoPopupDescYellow">
        <p><strong>🟡 LỜI KHYÊN KẾ TOÁN - QUẢN LÝ TÀI CHÍNH KẾ TOÁN</strong></p>
        <p><strong>1️⃣  NGHIỆP VỤ PHÁT SINH TRONG KỲ</strong><br>
        - Bảng checklist nên xem lại phần việc ghi chú để giúp em theo dõi kỹ hơn nghiệp vụ.</p>
        - Phần phát sinh thường xuyên: chứng từ mua- bán cần xử lý ngay khi phát sinh để kịp cho mọi giao dịch kinh doanh.</p>
		- Khi khai báo phát sinh luôn kiểm lại trên cả MISA-ERP: trong đó Misa khai giá vốn thuốc cẩn thận cùng đồng bộ giá vốn trên ERP.</p>
		- Chi phí nhận hàng mua nếu do công ty chịu thì phải hạch toán trong lô hàng đó giá vốn bình quân khai trên Misa</p>
		- Chủ động phối hợp bộ phận kho- giao nhận kiểm soát viết xuất nhập hàng- có thể giao gia hỗ trợ đóng, kiểm kê hàng khi cần.</p>
		- Định kỳ theo dõi công nợ Thu -Trả cùng kinh doanh: nhất là chuỗi NT, lập phiếu chi trả nhà NCC định kỳ thứ 4 gởi chị Khánh BGĐ xem ( nên in ra) duyệt để chi </p>
		- Kế toán luôn kiểm tra lại đơn hàng kinh doanh xem chiết khấu - chính sách- chương trình có đúng công ty ban hàng, mới xuất hóa đơn.</p>
		- Kế toán xem phần đề xuất trên ERP của bộ phận kinh doanh , đánh giá, phù hợp ngân sách, lợi nhuận  thì xác nhận, Ban giám đốc chỉ duyệt khi đủ các phần xác nhận</P>
		
		<p><strong>2️⃣  QUẢN LÝ DỮ LIỆU KẾ TOÁN- XỬ LÝ DỮ LIỆU KẾ TOÁN</strong><br>
       - Báo cáo kết quả kinh doanh trên ERP  : để đúng phải khai báo phát sinh và luôn kiểm tra lại các số cùng kỳ trước đối chiếu cẩn thận.</p>
	   - Luôn kiểm tra lại khai liên thông cổng dược- có thể chưa đồng bộ thời điển này do lỗi thì phải quay lại thử lần sau- tránh bỏ trôi luôn.</p>
       - Sổ sách , đặc biệt form khai xuất nhập tồn kho theo SOP : lô hạn dùng- nên xuất in ra định kỳ đóng cuốn vì khả năng thanh tra- kiểm tra có thể yêu cầu xem.</p>
	   - Công việc xem lại lại sổ sách các báo cáo Cân đối kế toán- báo cáo lưu chuyển tiền tệ- báo cáo kết quả kinh doanh trên Misa nên kiểm tra bút toán và gởi PDF cho BGD định lỳ.</p>
	   - Các phần hệ kế toán: phải theo dõi thực hiện trong checklist đã nêu và cập nhật</p>
	   
	   <p><strong>3️⃣ MUA HÀNG - BÁN HÀNG </strong><br>
        - Hạch toán hàng trả về phải đúng nghiệp trên Misa ( xem thêm hướng dẫn) - khai nhập kho khách hàng xong trên ERP. </p>
        - Kiểm tra phát sinh trả thu hộ nếu chuyển vào tài khoản công ty cẩn thận để khai báo nghiệp vụ phải thu trên Misa - kiểm tra bấm DUYỆT đơn trên ERP.</p>
		- Kế toán luôn yêu cầu mọi văn bản- biên bản đổi trả hàng phải lập từ kinh doanh- kho vận mới hoàn thành đống sổ nghiệp vụ đó.</p>
		- Khi mua hàng từ nhà cung cấp: yêu cầu có bảng kê gởi trước qua zalo cùng kế toán- kinh doanh xem trước khi nhận hàng. <p>
		- Kiểm tra kỹ đơn hàng Pharmacity trên ERP có khoản chiết khấu báo cáo ( từ khoản hỗ trợ khác ngoài ck cơ bản ) đúng mới hạch toán ERP, còn Misa sẽ hạch toán trên hóa đơn.<p>
		BAN GIÁM ĐỐC CÁM ƠN CÁC EM NHE!</p>

	   
	 </div>
    </section>

    <!-- POPUP: TRẮNG -->
    <section class="ideco-popup white" id="idecoPopupWhite" role="dialog" aria-modal="true" aria-describedby="idecoPopupDescWhite">
      <div class="ideco-popup__content" id="idecoPopupDescWhite">
        <p><strong>⚪ HƯỚNG DẪN HỘI NHẬP CHO CÁC BẠN MỚI TRONG 2 TUẦN- CẦN NĂM</strong></p>
        <p><strong>1️⃣ CÁCH TÌM HIỂU NỘI DUNG CỦA KINH DOANH  </strong><br>        
		- Không nên xem và nghe video - podcast lung tung thiểu tập trung có kế hoạch rỏ ràng mà nên viết ra nội dung cần tìm hiểu</br>
        - Nghe nội dung podcast-video:  GIỚI THIỆU PHẦN HỘI NHẬP- Hãy xem và nghe trước để hiểu.</br>
	    - Nghe và xem: Cách quản lý khách hàng được giao - cách phát triển khách hàng mới - Menu báo cáo giao dịch khách hàng  ứng dụng quản lý đặt hàng</p>
		- Nghe và xem và hỏi CHAT BOT: Cách tạo mã khách hàng- chính sách bán hàng nhóm thuố - không phải thuốc - quy trình đơn hàng - điều kiện bán hàng thuốc</p>
		- Nghe và xem và hỏi CHAT BOT: tra cứu xem bảng giá thuốc - bảng giá nhóm không phải thuốc ở đâu trên ERP</p>
		- Nghe và xem :Cách xử lý đơn hàng cho khách hàng nhóm không phải thuốc ( dược mỹ phẩm ) thế nào -podcasr</p>
		- Thao tác trên ERP nhưng menu cần: Báo cáo hoạt động giao dịch khách hàng - Đơn bán - báo cáo ( mục báo cáo kinh doanh) - báo cáo XNTKH</p>
		- Thao tác trên ERP nhưng menu cần: Lập kế hoạch - LINK QUAN LÝ ( xem checklist - tra cứu thuốc - không phải thuốc ..); xem giá </p>
		- Thao tác trên ERP nhưng menu cần: Ừng dụng khách hàng đặt hàng - Ứng dụng Chuỗi Đặt hàng - Bảng KPI ( đọc hiểu ) - ICON ĐỊNH HƯỚNG THÁNG- TUẦN </p>
		- Ngoài ra hãy tương tác đồng nghiệp- cấp trên để hỏi và nắm các nội dung tương tác bộ phận </p>
		- CÁCH HỘI NHẬP NHANH- TRỞ NHÀ XEM - NGHE THÊM -VÀO CÔNG TY TRANH THỦ TƯƠNG TÁC THỰC TẾ TÁC VỤ TRÊN PHẦN MỀM VÀ THAM GIA CÔNG TÁC VIỆC QUẢN LÝ KHÁCH HÀNG </p>

				</p>
		<p><strong>2️⃣  KỀ TOÁN </strong><br>
        - Xem- nghe: nội dung chuyên cho nghiệp vụ kế toán  - Tập trung tìm hiểu phần khai kế toán trên ERP .</br>
        - Thao tác ứng dụng chổ nào chưa hiểu phải hỏi- trao đổi rỏ: .</br>
		- Phải cùng lại diễn biến tâm lý tiêu cức mà chẵng giúp gì thay vì cứ làm theo cách tốt nhất rồi sẽ tìm thấy thành công</p>
		- Hãy ứng dụng AI trong xử lý việc tốt hơn- nhanh hơn và dĩ nhiên cho nhiều thời gian hơn trong bán hàng để có doanh thu, có thưởng tốt hơn.<br>
		</p>
		<p><strong>3️⃣  ỨNG DỤNG TRÊN DI ĐỘNG ĐỂ TIỆN XỬ LÝ CÔNG VIỆC </strong><br>
                       HTTPS://CONGTYIDECO.GITHUB.IO/MOBILE </p>
			   CÙNG NHAU XỬ LÝ TIỆN LỢI HƠN - NHANH HƠN - ĐÚNG HƠN </p>	
		
	  
	  
	  </div>
    </section>
  </div>

  <script>
    (function(){
      const overlay = document.getElementById('idecoOverlay');
      let autoCloseTimeout;
      let currentPopup = null;

      // Map nút - popup
      const popups = {
        white: { btn: document.getElementById('idecoNotifyBtnWhite'), popup: document.getElementById('idecoPopupWhite') },
        red:   { btn: document.getElementById('idecoNotifyBtnRed'),   popup: document.getElementById('idecoPopupRed') },
        blue:  { btn: document.getElementById('idecoNotifyBtnBlue'),  popup: document.getElementById('idecoPopupBlue') },
        yellow:{ btn: document.getElementById('idecoNotifyBtnYellow'),popup: document.getElementById('idecoPopupYellow') }
      };

      function openPopup(popup) {
        // Nếu mở lại cùng popup: gia hạn 15s, không cho tự đóng bằng thao tác
        if (currentPopup === popup && popup.classList.contains('ideco-open')) {
          clearTimeout(autoCloseTimeout);
          autoCloseTimeout = setTimeout(closePopup, 40000);
          return;
        }

        // Đóng popup khác (nếu có)
        if (currentPopup && currentPopup !== popup) {
          currentPopup.classList.remove('ideco-open');
        }

        overlay.hidden = false;
        overlay.classList.add('ideco-open');
        popup.classList.add('ideco-open');
        document.documentElement.style.overflow = 'hidden';
        currentPopup = popup;

        // Tự đóng sau 15 giây (chỉ code mới đóng được)
        clearTimeout(autoCloseTimeout);
        autoCloseTimeout = setTimeout(closePopup, 35000);
      }

      function closePopup() {
        overlay.classList.remove('ideco-open');
        if (currentPopup) currentPopup.classList.remove('ideco-open');
        clearTimeout(autoCloseTimeout);
        setTimeout(() => { overlay.hidden = true; }, 200);
        document.documentElement.style.overflow = '';
        currentPopup = null;
      }

      // Gán sự kiện cho nút
      popups.white.btn.addEventListener('click', () => openPopup(popups.white.popup));
      popups.red.btn.addEventListener('click', () => openPopup(popups.red.popup));
      popups.blue.btn.addEventListener('click', () => openPopup(popups.blue.popup));
      popups.yellow.btn.addEventListener('click', () => openPopup(popups.yellow.popup));

      // Không cho overlay click để đóng (cố ý bỏ lắng nghe)
      // overlay.addEventListener('click', closePopup);
      
      // API tùy chọn
      window.IDECO_POPUP = {
        open: (type) => openPopup(popups[type].popup),
        isOpen: () => currentPopup !== null
      };
    })();
  </script>
</body>
</html>




<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>IDECO BOT</title>
  <style>
    :root {
      --green: #16a34a;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, "Helvetica Neue", Helvetica, "Apple Color Emoji", "Segoe UI Emoji";
      background: #fff;
      color: #111;
    }
    .chat-icon {
      position: fixed;
      bottom: 0.25cm;
      left: 250px; /* giữ nguyên vị trí như file cũ */
      color: #fff;
      background: var(--green);
      padding: 10px 20px;
      border-radius: 15px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      z-index: 1100;
      border: 2px solid #fff;
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.5);
      user-select: none;
    }
    .popup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 1200px;
      height: 900px;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      z-index: 1101;
      resize: both;
      overflow: auto;
    }
    .popup iframe {
      width: 100%;
      height: 100%;
      border: 0;
    }
    .overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      z-index: 1100;
    }
    @media (max-width: 768px) {
      .popup { width: 95vw; height: 80vh; }
      .chat-icon { left: 16px; }
    }
  </style>
</head>
<body>
  <!-- Chỉ còn 1 chat bot: IDECO BOT -->
  <div id="chat-icon-2" class="chat-icon" role="button" aria-controls="popup-2" aria-expanded="false" aria-label="Mở IDECO BOT">IDECO BOT</div>
  <div id="popup-2" class="popup" role="dialog" aria-modal="true" aria-label="Cửa sổ IDECO BOT">
    <iframe src="https://bots.easy-peasy.ai/bot/963fe505-9199-43b5-bcb4-a5d2edc6ca52" title="IDECO BOT"></iframe>
  </div>
  <div id="overlay-2" class="overlay" aria-hidden="true"></div>

  <script>
    (function () {
      const chatIcon2 = document.getElementById('chat-icon-2');
      const popup2 = document.getElementById('popup-2');
      const overlay2 = document.getElementById('overlay-2');

      function toggle(open) {
        const isOpen = open ?? popup2.style.display !== 'block';
        popup2.style.display = isOpen ? 'block' : 'none';
        overlay2.style.display = isOpen ? 'block' : 'none';
        chatIcon2.setAttribute('aria-expanded', String(isOpen));
        overlay2.setAttribute('aria-hidden', String(!isOpen));
      }

      chatIcon2.addEventListener('click', () => toggle());
      overlay2.addEventListener('click', () => toggle(false));
      window.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') toggle(false);
      });
    })();
  </script>
</body>
</html>
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ứng dụng Lập kế hoạch Tuần</title>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
    <style>
        /* Reset và style cơ bản */
        body, h1, h2, h3, table, th, td, button, input, textarea {
            margin: 0;
            padding: 0;
            border: 0;
            font-family: Arial, sans-serif;
        }
        /* Icon mở ứng dụng */
        .kh-tuan-plan-icon {
            position: fixed;
            top: 65px;
            left: 500px;
            background-color: red;
            color: white;
            padding: 15px 25px;
            border-radius: 5px;
            border: 2px solid white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            z-index: 1000;
            font-weight: bold;
            font-size: 16px;
        }
        /* Popup chính - FULLSCREEN */
        .kh-tuan-main-popup {
            display: none;
            position: fixed;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            background: #fff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            z-index: 1001;
            border: 2px solid #0073e6;
        }
        .kh-tuan-main-popup.active {
            display: block;
        }
        .kh-tuan-popup-content {
            width: 100%;
            height: 100%;
            overflow: auto;
            padding: 10px;
        }
        /* Header popup */
        .kh-tuan-popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
            margin-bottom: 20px;
        }
        .kh-tuan-popup-title {
            font-size: 24px;
            color: #0073e6;
            font-weight: bold;
        }
        .kh-tuan-close-btn {
            background: #ff5722;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        /* Các popup con */
        .kh-tuan-yopup {
            display: none;
            position: relative;
            width: 100%;
            height: calc(100% - 60px);
            overflow: auto;
        }
        .kh-tuan-yopup.active {
            display: block;
        }
        /* Nút bấm */
        .kh-tuan-btn {
            display: inline-block;
            padding: 10px 15px;
            color: #fff;
            background-color: #0073e6;
            border: none;
            border-radius: 4px;
            text-align: center;
            cursor: pointer;
            margin: 5px;
            font-weight: bold;
            min-width: 100px;
        }
        .kh-tuan-btn:hover {
            background-color: #005bb5;
        }
        .kh-tuan-btn-danger {
            background-color: #ff5722;
        }
        .kh-tuan-btn-success {
            background-color:#4CAF50;
        }
        .kh-tuan-btn-info {
            background-color: #17a2b8;
        }
        /* Form elements */
        .kh-tuan-form-group {
            margin-bottom: 15px;
        }
        .kh-tuan-form-row {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -10px;
        }
        .kh-tuan-form-col {
            flex: 1;
            min-width: 250px;
            padding: 0 10px;
        }
        .kh-tuan-label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }
        .kh-tuan-input, .kh-tuan-textarea, .kh-tuan-select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
            background: #f9f9f9;
        }
        .kh-tuan-textarea {
            min-height: 80px;
            resize: vertical;
        }
        /* Bảng công việc */
        .kh-tuan-day-table {
            margin-top: 30px;
            margin-bottom: 30px;
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .kh-tuan-day-table h3 {
            margin-bottom: 15px;
            color: #0073e6;
            font-size: 18px;
            padding-bottom: 5px;
            border-bottom: 1px solid #ddd;
        }
        .kh-tuan-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        .kh-tuan-th, .kh-tuan-td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
            position: relative;
        }
        .kh-tuan-th {
            background-color: #e6f2ff;
            font-weight: bold;
            color: #003366;
        }
        /* Trạng thái hoàn thành */
        .kh-tuan-completed {
            background-color: #ffe0b2; 
        }
       .kh-tuan-notification {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: red;
            color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            z-index: 1002;
            border: 3px solid white;
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            width: 80%;
            max-width: 600px;
            animation: kh-tuan-blink 2s infinite;
        }
        @keyframes kh-tuan-blink {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        .kh-tuan-notification.active {
            display: block;
        }
        /* Popup nhắc nhở */
        .kh-tuan-reminder-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #fff;
            border: 2px solid red;
            border-radius: 8px;
            padding: 20px;
            width: 80%;
            max-width: 900px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            z-index: 1003;
        }
        .kh-tuan-reminder-popup.active {
            display: block;
        }
        .kh-tuan-reminder-popup p {
            margin-bottom: 15px;
            line-height: 1.6;
        }
        .kh-tuan-reminder-btn {
            margin: 10px 5px;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        .kh-tuan-confirm-btn {
            background-color: #0073e6;
            color: white;
        }
        .kh-tuan-cancel-btn {
            background-color: #ff5722;
            color: white;
        }

        /* Action buttons in table */
        .kh-tuan-action-btn {
            padding: 6px 10px;
            margin: 2px;
            min-width: auto;
        }
        /* Scrollbar styling */
        .kh-tuan-scrollbar::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        .kh-tuan-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .kh-tuan-scrollbar::-webkit-scrollbar-thumb {
            background: #0073e6;
            border-radius: 5px;
        }
        .kh-tuan-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #005bb5;
        }
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .kh-tuan-form-col {
                min-width: 100%;
                margin-bottom: 15px;
            }
            .kh-tuan-main-popup {
                top: 5px;
                left: 5px;
                right: 5px;
                bottom: 5px;
                padding: 10px;
            }
            .kh-tuan-th, .kh-tuan-td {
                padding: 8px;
                font-size: 13px;
            }
            .kh-tuan-btn {
                padding: 8px 12px;
                min-width: 80px;
                font-size: 13px;
            }
        }
        /* Popup xác nhận hoàn thành */
        .kh-tuan-complete-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #fff;
            border: 2px solid #4CAF50;
            border-radius: 8px;
            padding: 20px;
            width: 80%;
            max-width: 500px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            z-index: 1003;
        }
        .kh-tuan-complete-popup.active {
            display: block;
        }
        .kh-tuan-complete-popup p {
            margin-bottom: 15px;
            line-height: 1.6;
            font-size: 16px;
        }
        .kh-tuan-complete-btns {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        /* CSS mới cho trang báo cáo */
        .kh-tuan-report-section {
            margin: 20px 0;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        .kh-tuan-report-header {
            text-align: center;
            margin-bottom: 30px;
            color: #0073e6;
            border-bottom: 2px solid #0073e6;
            padding-bottom: 10px;
        }
        .kh-tuan-additional-content {
            margin-top: 20px;
        }
        .kh-tuan-content-block {
            background: #fff;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border: 1px solid #ddd;
            position: relative;
        }
        .kh-tuan-remove-block {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #ff5722;
            color: white;
            border: none;
            border-radius: 3px;
            padding: 3px 8px;
            cursor: pointer;
        }
        .kh-tuan-report-actions {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        .kh-tuan-report-table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        .kh-tuan-report-table th {
            background-color: #0073e6;
            color: white;
            padding: 10px;
            text-align: left;
        }
        .kh-tuan-report-table td {
            padding: 10px;
            border: 1px solid #ddd;
        }
        .kh-tuan-report-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        /* Popup hướng dẫn */
        .kh-tuan-guide-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #fff;
            border: 2px solid #17a2b8;
            border-radius: 8px;
            padding: 20px;
            width: 80%;
            max-width: 800px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            z-index: 1004;
            max-height: 80vh;
            overflow-y: auto;
        }
        .kh-tuan-guide-popup.active {
            display: block;
        }
        .kh-tuan-guide-popup h2 {
            color: #17a2b8;
            margin-bottom: 15px;
            text-align: center;
        }
        .kh-tuan-guide-popup ul {
            margin: 15px 0;
            padding-left: 20px;
        }
        .kh-tuan-guide-popup li {
            margin-bottom: 10px;
            line-height: 1.5;
        }
        .kh-tuan-guide-close {
            display: block;
            margin: 20px auto 0;
            padding: 8px 20px;
            background-color: #17a2b8;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- Icon mở ứng dụng -->
    <div class="kh-tuan-plan-icon" onclick="khTuanToggleMainPopup()">KẾ HOẠCH</div>
    <!-- Popup chính -->
    <div id="kh-tuan-main-popup" class="kh-tuan-main-popup">
        <div class="kh-tuan-popup-content">
            <!-- Popup danh sách kế hoạch -->
            <div id="kh-tuan-list-popup" class="kh-tuan-yopup active">
                <h2>Danh sách Kế hoạch</h2>
                <button class="kh-tuan-btn" onclick="khTuanOpenForm()">Thêm mới</button>
                <button class="kh-tuan-btn" onclick="khTuanToggleMainPopup()">Đóng</button>
                <table class="kh-tuan-table">
                    <thead>
                        <tr>
                            <th>Tên</th>
                            <th>Bộ phận</th>
                            <th>Ngày lập</th>
                            <th>Tuần</th>
                            <th>Hành động</th>
                        </tr>
                    </thead>
                    <tbody id="kh-tuan-plan-list"></tbody>
                </table>
            </div>
            <!-- Popup tạo/chỉnh sửa kế hoạch -->
            <div id="kh-tuan-plan-popup" class="kh-tuan-yopup">
                <h1>LẬP KẾ HOẠCH TUẦN - CÓ THIẾT LẬP HẸN THỐNG BÁO</h1>
                <div class="kh-tuan-form-group">
                    <input type="hidden" id="kh-tuan-plan-key" class="kh-tuan-input">
                </div>
                <div class="kh-tuan-form-group">
                    <label for="kh-tuan-name" class="kh-tuan-label">Tên:</label>
                    <input type="text" id="kh-tuan-name" class="kh-tuan-input">
                </div>
                <div class="kh-tuan-form-group">
                    <label for="kh-tuan-department" class="kh-tuan-label">Bộ phận:</label>
                    <input type="text" id="kh-tuan-department" class="kh-tuan-input">
                </div>
                <div class="kh-tuan-form-group">
                    <label for="kh-tuan-date" class="kh-tuan-label">Ngày lập:</label>
                    <input type="date" id="kh-tuan-date" class="kh-tuan-input" value="">
                </div>
                <div class="kh-tuan-form-group">
                    <label for="kh-tuan-week" class="kh-tuan-label">Chọn tuần:</label>
                    <select id="kh-tuan-week" class="kh-tuan-select">
                        <option value="Tuần 1">Tuần 1</option>
                        <option value="Tuần 2">Tuần 2</option>
                        <option value="Tuần 3">Tuần 3</option>
                        <option value="Tuần 4">Tuần 4</option>
                    </select>
                </div>
                <div class="kh-tuan-form-group">
                    <label for="kh-tuan-goal" class="kh-tuan-label">Mục tiêu công việc:</label>
                    <textarea id="kh-tuan-goal" class="kh-tuan-textarea">Nên có mục tiêu doanh số tuần- khách hàng cần chốt- công việc chính cần tập trung</textarea>
                </div>
                <h2>Công việc theo ngày</h2>
                <!-- Thứ 2 -->
                <div class="kh-tuan-day-table" id="kh-tuan-monday-table">
                    <h3>Thứ 2</h3>
                    <button class="kh-tuan-btn" onclick="khTuanAddTask('monday')">Thêm công việc</button>
                    <table class="kh-tuan-table">
                        <thead>
                            <tr>
                                <th>Công việc</th>
                                <th>Ngày bắt đầu</th>
                                <th>Ngày kết thúc</th>
                                <th>Lịch hẹn</th>
                                <th>Kết quả việc bạn mong đợi</th>
                                <th>Báo cáo hoàn tất</th>
                                <th>Hoàn Thành</th>
                                <th>Xóa</th>
                            </tr>
                        </thead>
                        <tbody id="kh-tuan-monday-tasks"></tbody>
                    </table>
                </div>
                <!-- Thứ 3 -->
                <div class="kh-tuan-day-table" id="kh-tuan-tuesday-table">
                    <h3>Thứ 3</h3>
                    <button class="kh-tuan-btn" onclick="khTuanAddTask('tuesday')">Thêm công việc</button>
                    <table class="kh-tuan-table">
                        <thead>
                            <tr>
                                <th>Công việc</th>
                                <th>Ngày bắt đầu</th>
                                <th>Ngày kết thúc</th>
                                <th>Lịch hẹn</th>
                                <th>Kết quả việc bạn mong đợi?</th>
                                <th>Báo cáo hoàn tất</th> 
                                <th>Hoàn Thành</th>
                                <th>Xóa</th>
                            </tr>
                        </thead>
                        <tbody id="kh-tuan-tuesday-tasks"></tbody>
                    </table>
                </div>
                <!-- Thứ 4 -->
                <div class="kh-tuan-day-table" id="kh-tuan-wednesday-table">
                    <h3>Thứ 4</h3>
                    <button class="kh-tuan-btn" onclick="khTuanAddTask('wednesday')">Thêm công việc</button>
                    <table class="kh-tuan-table">
                        <thead>
                            <tr>
                                <th>Công việc</th>
                                <th>Ngày bắt đầu</th>
                                <th>Ngày kết thúc</th>
                                <th>Lịch hẹn</th>
                                <th>Kết quả việc bạn mong đợi?</th>
                                <th>Báo cáo hoàn tất</th> 
                                <th>Hoàn Thành</th>
                                <th>Xóa</th>
                            </tr>
                        </thead>
                        <tbody id="kh-tuan-wednesday-tasks"></tbody>
                    </table>
                </div>
                <!-- Thứ 5 -->
                <div class="kh-tuan-day-table" id="kh-tuan-thursday-table">
                    <h3>Thứ 5</h3>
                    <button class="kh-tuan-btn" onclick="khTuanAddTask('thursday')">Thêm công việc</button>
                    <table class="kh-tuan-table">
                        <thead>
                            <tr>
                                <th>Công việc</th>
                                <th>Ngày bắt đầu</th>
                                <th>Ngày kết thúc</th>
                                <th>Lịch hẹn</th>
                                <th>Kết quả mà việc bạn mong đợi</th>
                                <th>Báo cáo hoàn tất</th> 
                                <th>Hoàn Thành</th>
                                <th>Xóa</th>
                            </tr>
                        </thead>
                        <tbody id="kh-tuan-thursday-tasks"></tbody>
                    </table>
                </div>
                <!-- Thứ 6 -->
                <div class="kh-tuan-day-table" id="kh-tuan-friday-table">
                    <h3>Thứ 6</h3>
                    <button class="kh-tuan-btn" onclick="khTuanAddTask('friday')">Thêm công việc</button>
                    <table class="kh-tuan-table">
                        <thead>
                            <tr>
                                <th>Công việc cụ thể :</th>
                                <th>Ngày bắt đầu</th>
                                <th>Ngày kết thúc</th>
                                <th>Lịch hẹn</th>
                                <th>Kết quả việc mà bạn mong đợi?</th>
                                <th>Báo cáo hoàn tất</th> 
                                <th>Hoàn Thành</th>
                                <th>Xóa</th>
                            </tr>
                        </thead>
                        <tbody id="kh-tuan-friday-tasks"></tbody>
                    </table>
                </div>
                <button class="kh-tuan-btn" onclick="khTuanSavePlan()">Lưu ERP</button>
                <button class="kh-tuan-btn" onclick="khTuanGoBack()">Quay lại</button>
                <button class="kh-tuan-btn kh-tuan-btn-success" onclick="khTuanExportPDF()">Xuất PDF</button>
                <button class="kh-tuan-btn" onclick="khTuanOpenReport()">Báo cáo tuần</button>
            </div>
            <!-- Popup báo cáo tuần mới -->
            <div id="kh-tuan-report-popup" class="kh-tuan-yopup">
                <div class="kh-tuan-report-header">
                    <h1>BÁO CÁO KẾT QUẢ LÀM VIỆC TUẦN</h1>
                </div>
                <div class="kh-tuan-form-group">
                    <label for="kh-tuan-report-title" class="kh-tuan-label">Tiêu đề báo cáo:</label>
                    <input type="text" id="kh-tuan-report-title" class="kh-tuan-input" placeholder="Nhập tiêu đề báo cáo">
                </div>
                <!-- Hiển thị thông tin kế hoạch -->
                <div id="kh-tuan-report-content">
                    <!-- Nội dung sẽ được điền bằng JavaScript -->
                </div>
                <!-- Phần nội dung bổ sung -->
                <div class="kh-tuan-additional-content">
                    <h3>Nội dung bổ sung</h3>
                    <div id="kh-tuan-additional-blocks">
                        <!-- Các khối nội dung bổ sung sẽ được thêm ở đây -->
                    </div>
                    <button class="kh-tuan-btn" onclick="khTuanAddContentBlock()">Thêm nội dung</button>
                </div>
                <!-- Nút hành động -->
                <div class="kh-tuan-report-actions">
                    <button class="kh-tuan-btn kh-tuan-btn-info" onclick="khTuanShowGuide()">Hướng dẫn báo cáo</button>
                    <button class="kh-tuan-btn kh-tuan-btn-success" onclick="khTuanSaveReport()">Lưu báo cáo</button>
                    <button class="kh-tuan-btn kh-tuan-btn-success" onclick="khTuanExportReportPDF()">Xuất PDF</button>
                    <button class="kh-tuan-btn" onclick="khTuanEditReport()">Sửa báo cáo</button>
                    <button class="kh-tuan-btn" onclick="khTuanBackToPlan()">Quay lại kế hoạch</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Thông báo hẹn giờ -->
    <div id="kh-tuan-notification" class="kh-tuan-notification">
        BẠN ĐÃ CÓ HẸN CỦA NHIỆM VỤ NÀY - HÃY CHUẨN BỊ
    </div>
    <!-- Popup nhắc nhở -->
    <div id="kh-tuan-reminder-popup" class="kh-tuan-reminder-popup">
        <p>
        <strong>CÁM ƠN BẠN ĐÃ LÀM KẾ HOẠCH- ĐIỀU NÀY TỐT CHO BẠN MÀ NHƯNG LIỆU CHỈ CÓ VÀI VIỆC LÀM TRONG NGÀY THÌ KẾ HOẠCH ?</strong></br>
        Khi viết công việc- bạn nên tự hỏi việc này có phục vụ gì cho mục tiêu tuần này mình đề ra không?</br></br>
        Mục tiêu này khả thi không nếu có phải làm sao đạt? Doanh số? Số khách hàng lên đơn, khách hàng mới, nhiệu vụ phải xong, xử lý chứng từ phải xong?</br></br>
        Bạn tự hỏi mình việc công việc này cụ thể, rỏ ràng không? Nó cần thời gia bao lâu sẽ hoàn thành? kế quả gì nỗ lực mong đợi</br></br>
        Công việc tuần này cần chia ra BUỔI SÁNG- CHIỀU cụ thể chi tiết không? cận chọn hẹn báo không?</br></br>
        Tuần trước, bạn có nội dung nào không hoàn thành vậy tuần này có làm không? khi nào? mất bao lâu? tính kỹ chưa?</br></br>
        Kế hoạch tuần này, bạn có xem lại Định hướng giao việc , KPI của mình chưa? Nó có thúc đẩy việc gì bạn đề ra làm không?</br></br>
        Bạn có xem kế hoạch này có nằm trong KPI phải hoàn thành trong tháng không? Hãy xem lại thời gian hoàn thành có chắc không?</br></br>
        <u> <strong>Ghi chú:</strong></u> : Kết quả mong đợi là kết quả mà chính do công việc đàm mình nêu ra để đặt điều gì cho chung- nên hãy viết cho chuẩn và cân nhắc</br>
        Một lần nữa, bạn xem kỹ nội dung trên - bạn có nghỉ kế hoạch mình sẽ hoàn thiện tốt hơn không? .</br></br>
        Bấm xác nhận hay hủy viết lại do bạn quyết định -mà quyết định rồi bạn phải tự chịu trách nhiệm công việc cam kết do chính mình đề ra nhé!</br></br>
        </p>
        <button class="kh-tuan-reminder-btn kh-tuan-confirm-btn" onclick="khTuanConfirmAddTask()">Xác nhận</button>
        <button class="kh-tuan-reminder-btn kh-tuan-cancel-btn" onclick="khTuanCancelAddTask()">Hủy bỏ</button>
    </div>
    <!-- Popup nhắc việc chưa hoàn thành hôm qua -->
    <div id="kh-tuan-yesterday-popup" class="kh-tuan-reminder-popup">
        <p style="font-size:20px;font-weight:bold;text-align:center; color:blue">
            Em ơi! tên em liệt kê ở đây báo là em không bấm hoàn thành công việc hay em chưa làm xong? đó <br/>
            Hãy cố gắng bám sát mục tiêu - kế hoạch thông qua định kỳ xem lại em nha! <br/><br/>
            Hãy xem lại công việc chưa hoàn thành - ráng theo đuổi cho xong hay nếu xong bấm hoàn thành <br/>
            Chúng ta hãy cùng nhau làm chuyên nghiệp để giúp công ty mình phát triển kinh doanh tốt hơn.  <br/>
            Em nên nhớ ! kế hoạch phải chi tiết , phục vụ cho MỤC TIÊU ĐỀ RA và ĐỊNH HƯỚNG GIAO!<br/>
        </p>
        <ul id="kh-tuan-userlist" style="margin:10px 0;padding-left:20px;text-align:left;"></ul>
        <div style="text-align:center;">
            <button class="kh-tuan-reminder-btn kh-tuan-confirm-btn"
                    onclick="khTuanYesterdayAction('today')">Thiết lập hôm nay</button>
            <button class="kh-tuan-reminder-btn kh-tuan-cancel-btn"
                    onclick="khTuanYesterdayAction('later')">Để sau</button>
        </div>
    </div>
    <!-- Popup xác nhận hoàn thành -->
    <div id="kh-tuan-complete-popup" class="kh-tuan-complete-popup">
        <p>
            <strong>Bạn đã thực sự hoàn thành công việc này? </strong><br><br>
            Nội dung này có góp phần để tặt  mục tiêu trong tuần mà bạn đề ra không ?<br><br>
            Hãy chỉnh công việc làm có giá trị thúc đẩy gia tăng giá trị như chốt bao nhiêu? số khách hàng, số đơn giao, nội dung hoàn thành cụ thể là gì? không nên chung chung<br><br>
            Nếu chưa thực sự hoàn thành hoặc chưa đạt yêu cầu, hãy cân nhắc thêm các công việc bổ trợ hay dời thời điểm khác để hoàn thành- nhưng vẫn bấm hoàn thành hôm này
        </p>
        <div class="kh-tuan-complete-btns">
            <button class="kh-tuan-btn kh-tuan-btn-success" onclick="khTuanConfirmComplete()">Xác nhận hoàn thành</button>
            <button class="kh-tuan-btn kh-tuan-btn-danger" onclick="khTuanCancelComplete()">Quay lại chỉnh sửa</button>
        </div>
    </div>
    <!-- Popup hướng dẫn báo cáo -->
    <div id="kh-tuan-guide-popup" class="kh-tuan-guide-popup">
        <h2>HƯỚNG DẪN VIẾT BÁO CÁO TUẦN</h2>
        <p><strong>Các bạn cần phải thực hiện báo cáo tuần theo các bước sau:</strong></p>
        <ul>
            <li><strong>Bước 1:</strong> Xem lại toàn bộ kế hoạch tuần đã đặt ra, đánh giá mức độ hoàn thành từng công việc</li>
            <li><strong>Bước 2:</strong> Ghi lại kết quả thực tế đạt được cho từng công việc, so sánh với kết quả mong đợi ban đầu</li>
            <li><strong>Bước 3:</strong> Phân tích nguyên nhân đạt/không đạt mục tiêu, ghi nhận những khó khăn gặp phải</li>
            <li><strong>Bước 4:</strong> Đề xuất giải pháp cho những vấn đề còn tồn đọng và kế hoạch cho tuần tiếp theo</li>
            <li><strong>Bước 5:</strong> Thêm các nội dung bổ sung như thành tích nổi bật, bài học kinh nghiệm, ghi nhận từ khách hàng</li>
            <li><strong>Bước 6:</strong> KIỀM TRA LẠI BÁO CÁO NỘI DUNG VIẾT : RỎ RÀNG - ĐẦY ĐỦ - ĐỌC HIỂU VÀ MANG TÍNH CHIA SẼ</li>
            <li><strong>Bước 7:</strong> Lưu báo cáo và xuất file PDF để gửi cho quản lý hoặc lưu trữ</li>
        </ul>
        <p><strong>Lưu ý quan trọng:</strong></p>
        <ul>
            <li>Báo cáo cần trung thực, khách quan, có số liệu cụ thể</li>
            <li>Nêu rõ nguyên nhân và giải pháp cho những công việc chưa hoàn thành</li>
            <li>Đề xuất kế hoạch hành động cụ thể cho tuần tiếp theo</li>
            <li>Báo cáo cần được gửi đúng hạn theo quy định của công ty</li>
        </ul>
        <button class="kh-tuan-guide-close" onclick="khTuanCloseGuide()">Đóng</button>
    </div>

    <!-- ✅ POPUP MỚI: NHẮC THIẾT LẬP MỤC TIÊU TRƯỚC KHI THÊM CÔNG VIỆC -->
    <div id="kh-tuan-goal-reminder-popup" class="kh-tuan-reminder-popup">
        <p style="font-size:18px; color:#d35400; font-weight:bold; text-align:center;">
            ⚠️ Em hãy thiết lập mục tiêu trước trong tuần!<br>
            Mục tiêu phải:<br>
            • Có thể đo lường được<br>
            • Đặt được trong tuần<br>
            • Gắn với KPI hoặc kết quả cụ thể
        </p>
        <div style="text-align:center; margin-top:20px;">
            <button class="kh-tuan-reminder-btn kh-tuan-confirm-btn" onclick="khTuanConfirmGoalReminder()">Xác nhận</button>
            <button class="kh-tuan-reminder-btn kh-tuan-cancel-btn" onclick="khTuanCancelGoalReminder()">Hủy</button>
        </div>
    </div>

    <script>
        // Cấu hình Firebase
        const khTuanFirebaseConfig = {
            apiKey: "AIzaSyCapladi_WtOMtkPnl0BVCtBAoG2wrmTO0",
            authDomain: "chatbox-761ef.firebaseapp.com",
            databaseURL: "https://chatbox-761ef-default-rtdb.firebaseio.com",
            projectId: "chatbox-761ef",
            storageBucket: "chatbox-761ef.firebasestorage.app",
            messagingSenderId: "95066004803",
            appId: "1:95066004803:web:8ee1c49c482d313bf123f6",
            measurementId: "G-7RM89RMLKZ"
        };
        if (!firebase.apps.length) {
            firebase.initializeApp(khTuanFirebaseConfig);
        }
        const khTuanDatabase = firebase.database();

        let khTuanCurrentDayId = '';
        const khTuanTWENTY_MIN = 20 * 60 * 1000;
        let khTuanYesterdayTimer = null;
        let khTuanCurrentDate = new Date().toISOString().split('T')[0];
        let khTuanCurrentCompleteRow = null;
        let khTuanPendingAddDay = null;

        function khTuanCanProceedToDay(day) {
            const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday'];
            const index = days.indexOf(day);
            if (index === -1 || index === 0) return true;
            const previousDay = days[index - 1];
            const prevTasks = document.getElementById(`kh-tuan-${previousDay}-tasks`).querySelectorAll('tr');
            return prevTasks.length >= 5;
        }

        // === HÀM MỚI: KIỂM TRA MỤC TIÊU HỢP LỆ ===
        function khTuanIsGoalValid() {
            const goal = document.getElementById('kh-tuan-goal').value.trim();
            const defaultGoal = 'Nên có mục tiêu doanh số tuần- khách hàng cần chốt- công việc chính cần tập trung';
            return goal !== '' && goal !== defaultGoal;
        }

        // === HÀM MỚI: KHI NHẤN "THÊM CÔNG VIỆC" ===
        function khTuanAddTask(day) {
            if (khTuanIsGoalValid()) {
                // Nếu mục tiêu OK → kiểm tra logic ngày → thêm task
                if (!khTuanCanProceedToDay(day)) {
                    document.getElementById('kh-tuan-reminder-popup').classList.add('active');
                    khTuanCurrentDayId = day;
                    return;
                }
                khTuanAddNewTask(day);
            } else {
                // Mục tiêu chưa hợp lệ → hiện popup nhắc
                document.getElementById('kh-tuan-goal-reminder-popup').classList.add('active');
                khTuanPendingAddDay = day;
            }
        }

        // === HÀM MỚI: KHI BẤM "XÁC NHẬN" TRÊN POPUP MỤC TIÊU ===
        function khTuanConfirmGoalReminder() {
            // Đóng popup NGAY LẬP TỨC
            document.getElementById('kh-tuan-goal-reminder-popup').classList.remove('active');
            // Focus vào ô mục tiêu để người dùng điền
            const goalTextarea = document.getElementById('kh-tuan-goal');
            goalTextarea.focus();
            // Cuộn đến vị trí textarea nếu cần
            goalTextarea.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        // === HÀM MỚI: KHI BẤM "HỦY" ===
        function khTuanCancelGoalReminder() {
            document.getElementById('kh-tuan-goal-reminder-popup').classList.remove('active');
            khTuanPendingAddDay = null;
        }

        // === GIỮ NGUYÊN TOÀN BỘ CÁC HÀM CŨ TỪ FILE GỐC ===
        function khTuanToggleMainPopup() {
            const popup = document.getElementById('kh-tuan-main-popup');
            popup.classList.toggle('active');
            if (popup.classList.contains('active')) {
                khTuanLoadPlans();
                document.getElementById('kh-tuan-date').value = khTuanCurrentDate;
            }
        }

        function khTuanOpenForm() {
            document.getElementById('kh-tuan-list-popup').classList.remove('active');
            document.getElementById('kh-tuan-plan-popup').classList.add('active');
            document.getElementById('kh-tuan-plan-key').value = '';
            document.getElementById('kh-tuan-name').value = '';
            document.getElementById('kh-tuan-department').value = '';
            document.getElementById('kh-tuan-date').value = khTuanCurrentDate;
            document.getElementById('kh-tuan-goal').value = 'Nên có mục tiêu doanh số tuần- khách hàng cần chốt- công việc chính cần tập trung';
            ['monday', 'tuesday', 'wednesday', 'thursday', 'friday'].forEach(day => {
                document.getElementById(`kh-tuan-${day}-tasks`).innerHTML = '';
            });
        }

        function khTuanLoadPlans() {
            const planList = document.getElementById('kh-tuan-plan-list');
            planList.innerHTML = '';
            khTuanDatabase.ref('kehoachtuan/plans').once('value', snapshot => {
                const plans = snapshot.val();
                if (plans) {
                    Object.keys(plans).forEach(key => {
                        const plan = plans[key];
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${plan.name || ''}</td>
                            <td>${plan.department || ''}</td>
                            <td>${plan.date || ''}</td>
                            <td>${plan.week || ''}</td>
                            <td>
                                <button class="kh-tuan-btn" onclick="khTuanViewPlan('${key}')">Xem</button>
                                <button class="kh-tuan-btn" onclick="khTuanDeletePlan('${key}')">Xóa</button>
                            </td>
                        `;
                        planList.appendChild(row);
                    });
                }
            });
        }

        function khTuanSavePlan() {
            const planKey = document.getElementById('kh-tuan-plan-key').value;
            const name = document.getElementById('kh-tuan-name').value || '';
            const department = document.getElementById('kh-tuan-department').value || '';
            const date = document.getElementById('kh-tuan-date').value || '';
            const goal = document.getElementById('kh-tuan-goal').value || '';
            const week = document.getElementById('kh-tuan-week').value || '';
            const tasks = {
                monday: khTuanGetTasksForDay('monday'),
                tuesday: khTuanGetTasksForDay('tuesday'),
                wednesday: khTuanGetTasksForDay('wednesday'),
                thursday: khTuanGetTasksForDay('thursday'),
                friday: khTuanGetTasksForDay('friday')
            };
            const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday'];
            for (let i = 1; i < days.length; i++) {
                const prevDay = days[i - 1];
                const curDay = days[i];
                const prevTasks = document.getElementById(`kh-tuan-${prevDay}-tasks`).querySelectorAll('tr').length;
                const curTasks = document.getElementById(`kh-tuan-${curDay}-tasks`).querySelectorAll('tr').length;
                if (curTasks > 0 && prevTasks < 5) {
                    alert(`Không thể lưu kế hoạch: Ngày "${curDay}" có công việc nhưng ngày trước đó chưa đủ 5 công việc!`);
                    return;
                }
            }
            khTuanDatabase.ref('kehoachtuan/plans').orderByChild('name').equalTo(name).once('value', snapshot => {
                const plans = snapshot.val();
                let isDuplicate = false;
                if (plans) {
                    Object.keys(plans).forEach(key => {
                        if (key !== planKey) {
                            isDuplicate = true;
                        }
                    });
                }
                if (isDuplicate) {
                    alert("Tên kế hoạch đã tồn tại. Vui lòng chọn tên khác.");
                    return;
                }
                if (planKey) {
                    khTuanDatabase.ref('kehoachtuan/plans/' + planKey).update({ 
                        name, department, date, goal, week, tasks 
                    }).then(() => {
                        alert('Cập nhật thành công!');
                        khTuanGoBack();
                    }).catch(err => alert('Lỗi cập nhật: ' + err.message));
                } else {
                    khTuanDatabase.ref('kehoachtuan/plans').push({ 
                        name, department, date, goal, week, tasks 
                    }).then(() => {
                        alert('Lưu thành công!');
                        khTuanGoBack();
                    }).catch(err => alert('Lỗi lưu: ' + err.message));
                }
            });
        }

        function khTuanGetTasksForDay(day) {
            const tasks = [];
            const tbody = document.getElementById(`kh-tuan-${day}-tasks`);
            Array.from(tbody.querySelectorAll('tr')).forEach(row => {
                tasks.push({
                    name: row.cells[0].querySelector('textarea').value || '',
                    startDate: row.cells[1].querySelector('input').value || '',
                    endDate: row.cells[2].querySelector('input').value || '',
                    schedule: row.cells[3].querySelector('input').value || '',
                    expectedResult: row.cells[4].querySelector('textarea').value || '',
                    report: row.cells[5].querySelector('textarea').value || '',
                    completed: row.classList.contains('kh-tuan-completed') || false
                });
            });
            return tasks;
        }

        function khTuanAddNewTask(day) {
            const tbody = document.getElementById(`kh-tuan-${day}-tasks`);
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><textarea class="kh-tuan-textarea"></textarea></td>
                <td><input type="date" class="kh-tuan-input" value="${khTuanCurrentDate}"></td>
                <td><input type="date" class="kh-tuan-input" value="${khTuanCurrentDate}"></td>
                <td>
                    <input type="time" class="kh-tuan-input">
                    <button class="kh-tuan-btn" onclick="khTuanToggleSchedule(this)">Hẹn</button>
                </td>
                <td><textarea class="kh-tuan-textarea"></textarea></td>
                <td><textarea class="kh-tuan-textarea"></textarea></td>
                <td><button class="kh-tuan-btn" onclick="khTuanMarkComplete(this)">Hoàn Thành</button></td>
                <td><button class="kh-tuan-btn" onclick="khTuanDeleteTask(this)">Xóa</button></td>
            `;
            tbody.appendChild(row);
        }

        function khTuanConfirmAddTask() {
            const day = khTuanCurrentDayId;
            if (!khTuanCanProceedToDay(day)) {
                alert("Theo mình, bạn nên xem lại thêm công việc trong ngày này kỹ lại đi, bạn cần lập trên 4 công việc chi tiết hơn để theo sát việc, xem lại nha! .");
                document.getElementById('kh-tuan-reminder-popup').classList.remove('active');
                khTuanCurrentDayId = '';
                return;
            }
            document.getElementById('kh-tuan-reminder-popup').classList.remove('active');
            khTuanAddNewTask(day);
            khTuanCurrentDayId = '';
        }

        function khTuanCancelAddTask() {
            document.getElementById('kh-tuan-reminder-popup').classList.remove('active');
            khTuanCurrentDayId = '';
        }

        function khTuanMarkComplete(button) {
            khTuanCurrentCompleteRow = button.closest('tr');
            document.getElementById('kh-tuan-complete-popup').classList.add('active');
        }

        function khTuanDeleteTask(button) {
            const row = button.closest('tr');
            row.remove();
        }

        function khTuanGoBack() {
            document.getElementById('kh-tuan-plan-popup').classList.remove('active');
            document.getElementById('kh-tuan-list-popup').classList.add('active');
            khTuanLoadPlans();
        }

        function khTuanViewPlan(key) {
            document.getElementById('kh-tuan-plan-key').value = key;
            khTuanDatabase.ref('kehoachtuan/plans/' + key).once('value', snapshot => {
                const plan = snapshot.val();
                if (!plan) {
                    alert("Không tìm thấy kế hoạch!");
                    return;
                }
                document.getElementById('kh-tuan-name').value = plan.name || '';
                document.getElementById('kh-tuan-department').value = plan.department || '';
                document.getElementById('kh-tuan-date').value = plan.date || '';
                document.getElementById('kh-tuan-goal').value = plan.goal || '';
                document.getElementById('kh-tuan-week').value = plan.week || '';
                khTuanLoadTasksForDay('monday', plan.tasks?.monday || []);
                khTuanLoadTasksForDay('tuesday', plan.tasks?.tuesday || []);
                khTuanLoadTasksForDay('wednesday', plan.tasks?.wednesday || []);
                khTuanLoadTasksForDay('thursday', plan.tasks?.thursday || []);
                khTuanLoadTasksForDay('friday', plan.tasks?.friday || []);
                document.getElementById('kh-tuan-list-popup').classList.remove('active');
                document.getElementById('kh-tuan-plan-popup').classList.add('active');
            }).catch(err => {
                alert('Lỗi khi tải kế hoạch: ' + err.message);
            });
        }

        function khTuanLoadTasksForDay(day, tasks) {
            const tbody = document.getElementById(`kh-tuan-${day}-tasks`);
            tbody.innerHTML = '';
            tasks.forEach(task => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><textarea class="kh-tuan-textarea">${task.name || ''}</textarea></td>
                    <td><input type="date" class="kh-tuan-input" value="${task.startDate || ''}"></td>
                    <td><input type="date" class="kh-tuan-input" value="${task.endDate || ''}"></td>
                    <td>
                        <input type="time" class="kh-tuan-input" value="${task.schedule || ''}">
                        <button class="kh-tuan-btn" onclick="khTuanToggleSchedule(this)">Hẹn</button>
                    </td>
                    <td><textarea class="kh-tuan-textarea">${task.expectedResult || ''}</textarea></td>
                    <td><textarea class="kh-tuan-textarea">${task.report || ''}</textarea></td>
                    <td><button class="kh-tuan-btn" onclick="khTuanMarkComplete(this)">Hoàn Thành</button></td>
                    <td><button class="kh-tuan-btn" onclick="khTuanDeleteTask(this)">Xóa</button></td>
                `;
                if (task.completed) {
                    row.classList.add('kh-tuan-completed');
                }
                tbody.appendChild(row);
            });
        }

        function khTuanDeletePlan(key) {
            if (confirm('Bạn có chắc chắn muốn xóa kế hoạch này không?')) {
                khTuanDatabase.ref('kehoachtuan/plans/' + key).remove().then(() => {
                    alert('Xóa thành công!');
                    khTuanLoadPlans();
                }).catch(err => alert('Lỗi xóa: ' + err.message));
            }
        }

        function khTuanToggleSchedule(button) {
            const row = button.closest('tr');
            const timeInput = row.querySelector('input[type="time"]');
            const time = timeInput.value;
            if (!time) {
                alert("Vui lòng chọn thời gian hẹn.");
                return;
            }
            const now = new Date();
            const [hours, minutes] = time.split(':');
            const scheduledTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), hours, minutes);
            const timeDiff = scheduledTime - now - 240000;
            if (timeDiff < 0) {
                alert("Thời gian hẹn phải lớn hơn 2 phút so với thời gian hiện tại.");
                return;
            }
            if (button.textContent === "Hẹn") {
                button.textContent = "Hủy hẹn";
                setTimeout(() => {
                    const notification = document.getElementById('kh-tuan-notification');
                    notification.classList.add('active');
                    setTimeout(() => {
                        notification.classList.remove('active');
                    }, 15000);
                    let blinkInterval = setInterval(() => {
                        notification.style.visibility = notification.style.visibility === 'hidden' ? 'visible' : 'hidden';
                    }, 500);
                    setTimeout(() => {
                        clearInterval(blinkInterval);
                        notification.style.visibility = 'visible';
                    }, 15000);
                }, timeDiff);
            } else {
                button.textContent = "Hẹn";
                alert("Hẹn đã được hủy.");
            }
        }

        function khTuanCheckIncompleteYesterday() {
            const yesterDate = new Date(Date.now() - 86400000).toISOString().split('T')[0];
            khTuanDatabase.ref('kehoachtuan/plans')
                .orderByChild('date').equalTo(yesterDate).once('value', snap => {
                    let userSet = new Set();
                    snap.forEach(child => {
                        const plan = child.val();
                        const t = plan.tasks || {};
                        let hasIncomplete = false;
                        ['monday','tuesday','wednesday','thursday','friday'].forEach(d=>{
                            (t[d]||[]).forEach(task=>{
                                if (!task.completed) hasIncomplete = true;
                            });
                        });
                        if (hasIncomplete && plan.name) userSet.add(plan.name);
                    });
                    if (userSet.size > 0) {
                        document.getElementById('kh-tuan-userlist').innerHTML =
                            Array.from(userSet).map(u=>`<li>${u}</li>`).join('');
                        khTuanStartYesterdayReminder();
                    }
                });
        }

        function khTuanStartYesterdayReminder(){
            const show = ()=> document.getElementById('kh-tuan-yesterday-popup')
                                   .classList.add('active');
            show();
            khTuanYesterdayTimer = setInterval(show, khTuanTWENTY_MIN);
        }

        function khTuanStopYesterdayReminder(){
            clearInterval(khTuanYesterdayTimer);
            document.getElementById('kh-tuan-yesterday-popup')
                    .classList.remove('active');
        }

        function khTuanYesterdayAction(choice){
            khTuanStopYesterdayReminder();
            if (choice==='today'){
                alert('👌 Đã chuyển công việc sang hôm nay – bạn nhớ cập nhật nhé!');
            }else{
                alert('🕒 Để sau – hệ thống sẽ nhắc lại khi bạn mở ứng dụng lần sau.');
            }
        }

        function khTuanInitResizableColumns() {
            const tables = document.querySelectorAll('.kh-tuan-day-table .kh-tuan-table');
            if (tables.length === 0) return;
            const cols = tables[0].querySelectorAll('.kh-tuan-th');
            cols.forEach((col, index) => {
                const resizeHandle = document.createElement('div');
                resizeHandle.className = 'kh-tuan-resize-handle';
                col.appendChild(resizeHandle);
                let startX, startWidth;
                resizeHandle.addEventListener('mousedown', (e) => {
                    startX = e.clientX;
                    startWidth = col.offsetWidth;
                    document.addEventListener('mousemove', khTuanOnMouseMove);
                    document.addEventListener('mouseup', khTuanOnMouseUp);
                });
                const khTuanOnMouseMove = (e) => {
                    const newWidth = startWidth + (e.clientX - startX);
                    tables.forEach(table => {
                        const cols = table.querySelectorAll('.kh-tuan-th');
                        if (cols[index]) {
                            cols[index].style.width = `${newWidth}px`;
                            const tds = table.querySelectorAll(`.kh-tuan-td:nth-child(${index + 1})`);
                            tds.forEach(td => {
                                td.style.width = `${newWidth}px`;
                            });
                        }
                    });
                };
                const khTuanOnMouseUp = () => {
                    document.removeEventListener('mousemove', khTuanOnMouseMove);
                    document.removeEventListener('mouseup', khTuanOnMouseUp);
                };
            });
        }

        function khTuanConfirmComplete() {
            if (khTuanCurrentCompleteRow) {
                const reportTextarea = khTuanCurrentCompleteRow.cells[5].querySelector('textarea');
                const reportContent = reportTextarea.value.trim();
                if (reportContent === '') {
                    alert('BẠN ƠI!: BẠN PHẢI VIẾT BÁO CÁO CV NHÉ - KHÔNG ĐỂ TRỐNG!');
                    document.getElementById('kh-tuan-complete-popup').classList.remove('active');
                    khTuanCurrentCompleteRow = null;
                    reportTextarea.focus();
                    return;
                }
                if (reportContent.toLowerCase() === 'hoàn thành') {
                    alert('HÃY VIẾT KẾT QUẢ CỤ THỂ -GẮN GỌN- GIẢI TRÌNH-ĐỀ XUẤT ; KHÔNG NÊN VIẾT CHUNG CHUNG HOÀN THÀNH THẾ CHỨ!');
                    document.getElementById('kh-tuan-complete-popup').classList.remove('active');
                    khTuanCurrentCompleteRow = null;
                    reportTextarea.focus();
                    return;
                }
                khTuanCurrentCompleteRow.classList.add('kh-tuan-completed');
                document.getElementById('kh-tuan-complete-popup').classList.remove('active');
                khTuanCurrentCompleteRow = null;
            }
        }

        function khTuanCancelComplete() {
            document.getElementById('kh-tuan-complete-popup').classList.remove('active');
            khTuanCurrentCompleteRow = null;
        }

        // ====== CÁC HÀM MỚI CHO BÁO CÁO TUẦN ======
        function khTuanOpenReport() {
            const planKey = document.getElementById('kh-tuan-plan-key').value;
            if (!planKey) {
                alert("Vui lòng lưu kế hoạch trước khi tạo báo cáo!");
                return;
            }
            document.getElementById('kh-tuan-plan-popup').classList.remove('active');
            document.getElementById('kh-tuan-report-popup').classList.add('active');
            khTuanLoadReportContent(planKey);
        }

        function khTuanLoadReportContent(planKey) {
            khTuanDatabase.ref('kehoachtuan/plans/' + planKey).once('value', snapshot => {
                const plan = snapshot.val();
                if (!plan) {
                    alert("Không tìm thấy kế hoạch!");
                    return;
                }
                document.getElementById('kh-tuan-report-title').value = `Báo cáo tuần - ${plan.name || ''} - ${plan.date || ''}`;
                let reportHTML = `
                    <div class="kh-tuan-report-section">
                        <h2>Thông tin chung</h2>
                        <p><strong>Tên kế hoạch:</strong> ${plan.name || ''}</p>
                        <p><strong>Bộ phận:</strong> ${plan.department || ''}</p>
                        <p><strong>Ngày lập:</strong> ${plan.date || ''}</p>
                        <p><strong>Tuần:</strong> ${plan.week || ''}</p>
                        <p><strong>Mục tiêu công việc:</strong> ${plan.goal || ''}</p>
                    </div>
                `;
                const days = {
                    'monday': 'Thứ 2',
                    'tuesday': 'Thứ 3', 
                    'wednesday': 'Thứ 4',
                    'thursday': 'Thứ 5',
                    'friday': 'Thứ 6'
                };
                for (const [dayKey, dayName] of Object.entries(days)) {
                    if (plan.tasks && plan.tasks[dayKey] && plan.tasks[dayKey].length > 0) {
                        reportHTML += `
                            <div class="kh-tuan-report-section">
                                <h2>${dayName}</h2>
                                <table class="kh-tuan-report-table">
                                    <thead>
                                        <tr>
                                            <th>Công việc</th>
                                            <th>Kết quả mong đợi</th>
                                            <th>Báo cáo hoàn tất</th>
                                            <th>Trạng thái</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                        `;
                        plan.tasks[dayKey].forEach(task => {
                            reportHTML += `
                                <tr class="${task.completed ? 'kh-tuan-completed' : ''}">
                                    <td>${task.name || ''}</td>
                                    <td>${task.expectedResult || ''}</td>
                                    <td>${task.report || ''}</td>
                                    <td>${task.completed ? 'Đã hoàn thành' : 'Chưa hoàn thành'}</td>
                                </tr>
                            `;
                        });
                        reportHTML += `
                                    </tbody>
                                </table>
                            </div>
                        `;
                    }
                }
                document.getElementById('kh-tuan-report-content').innerHTML = reportHTML;
                khTuanLoadAdditionalContent(planKey);
            });
        }

        function khTuanLoadAdditionalContent(planKey) {
            khTuanDatabase.ref('kehoachtuan/reports/' + planKey).once('value', snapshot => {
                const reportData = snapshot.val();
                const additionalBlocks = document.getElementById('kh-tuan-additional-blocks');
                additionalBlocks.innerHTML = '';
                if (reportData && reportData.additionalContent) {
                    reportData.additionalContent.forEach((content, index) => {
                        additionalBlocks.innerHTML += `
                            <div class="kh-tuan-content-block">
                                <button class="kh-tuan-remove-block" onclick="khTuanRemoveContentBlock(this)">X</button>
                                <textarea class="kh-tuan-textarea" placeholder="Nhập nội dung bổ sung">${content}</textarea>
                            </div>
                        `;
                    });
                }
            });
        }

        function khTuanAddContentBlock() {
            const additionalBlocks = document.getElementById('kh-tuan-additional-blocks');
            additionalBlocks.innerHTML += `
                <div class="kh-tuan-content-block">
                    <button class="kh-tuan-remove-block" onclick="khTuanRemoveContentBlock(this)">X</button>
                    <textarea class="kh-tuan-textarea" placeholder="Nhập nội dung bổ sung"></textarea>
                </div>
            `;
        }

        function khTuanRemoveContentBlock(button) {
            if (confirm('Bạn có chắc chắn muốn xóa nội dung này?')) {
                button.parentElement.remove();
            }
        }

        function khTuanSaveReport() {
            const planKey = document.getElementById('kh-tuan-plan-key').value;
            const title = document.getElementById('kh-tuan-report-title').value;
            const additionalContent = [];
            document.querySelectorAll('#kh-tuan-additional-blocks .kh-tuan-content-block textarea').forEach(textarea => {
                if (textarea.value.trim() !== '') {
                    additionalContent.push(textarea.value);
                }
            });
            khTuanDatabase.ref('kehoachtuan/reports/' + planKey).set({
                title: title,
                additionalContent: additionalContent,
                savedAt: new Date().toISOString()
            }).then(() => {
                alert('Báo cáo đã được lưu thành công!');
            }).catch(error => {
                alert('Lỗi khi lưu báo cáo: ' + error.message);
            });
        }

        function khTuanEditReport() {
            document.querySelectorAll('#kh-tuan-additional-blocks textarea').forEach(textarea => {
                textarea.readOnly = false;
                textarea.style.background = '#fff';
            });
            document.getElementById('kh-tuan-report-title').readOnly = false;
            document.getElementById('kh-tuan-report-title').style.background = '#fff';
        }

        function khTuanBackToPlan() {
            document.getElementById('kh-tuan-report-popup').classList.remove('active');
            document.getElementById('kh-tuan-plan-popup').classList.add('active');
        }

        function khTuanShowGuide() {
            document.getElementById('kh-tuan-guide-popup').classList.add('active');
        }

        function khTuanCloseGuide() {
            document.getElementById('kh-tuan-guide-popup').classList.remove('active');
        }

        function khTuanExportReportPDF() {
            const name = document.getElementById('kh-tuan-name').value || 'noname';
            const date = document.getElementById('kh-tuan-date').value || new Date().toISOString().split('T')[0];
            const dateParts = date.split('-');
            const formattedDate = `${dateParts[2]}-${dateParts[1]}-${dateParts[0].substring(2)}`;
            const fileName = `${name.trim().toLowerCase().replace(/\s+/g, '-')}-baocaotuan-${formattedDate}.pdf`;
            const element = document.getElementById('kh-tuan-report-popup');
            const buttons = element.querySelectorAll('button');
            buttons.forEach(btn => btn.style.display = 'none');
            const opt = {
                margin: 0.5,
                filename: fileName,
                image: { type: 'jpeg', quality: 1 },
                html2canvas: { scale: 2, useCORS: true, scrollY: 0 },
                jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
            };
            html2pdf().set(opt).from(element).save().then(() => {
                buttons.forEach(btn => btn.style.display = '');
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            khTuanInitResizableColumns();
            khTuanCheckIncompleteYesterday();
            document.getElementById('kh-tuan-date').value = khTuanCurrentDate;
            document.getElementById('kh-tuan-report-title').readOnly = true;
            document.getElementById('kh-tuan-report-title').style.background = '#f0f0f0';
            document.querySelectorAll('#kh-tuan-additional-blocks textarea').forEach(textarea => {
                textarea.readOnly = true;
                textarea.style.background = '#f0f0f0';
            });
        });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script>
        function khTuanExportPDF() {
            const name = document.getElementById('kh-tuan-name').value || 'noname';
            const department = document.getElementById('kh-tuan-department').value || 'nodept';
            const date = document.getElementById('kh-tuan-date').value || new Date().toISOString().split('T')[0];
            const fileName = `${name.trim().toLowerCase().replace(/\s+/g, '-')}-${department.trim().toLowerCase().replace(/\s+/g, '-')}-${date.split('-').reverse().join('-')}.pdf`;
            const element = document.getElementById('kh-tuan-plan-popup');
            const buttons = element.querySelectorAll('button');
            buttons.forEach(btn => btn.style.display = 'none');
            const textareas = element.querySelectorAll('textarea');
            const replacements = [];
            textareas.forEach((textarea, index) => {
                const div = document.createElement('div');
                div.textContent = textarea.value;
                div.style.padding = '8px';
                div.style.minHeight = '60px';
                div.style.whiteSpace = 'pre-wrap';
                div.style.wordBreak = 'break-word';
                div.style.border = '1px solid #ccc';
                div.style.borderRadius = '4px';
                div.style.background = '#f9f9f9';
                div.style.fontSize = '14px';
                div.style.fontFamily = 'Arial, sans-serif';
                textarea.style.display = 'none';
                textarea.parentNode.insertBefore(div, textarea);
                replacements.push({ textarea, div });
            });
            const opt = {
                margin: 0.2,
                filename: fileName,
                image: { type: 'jpeg', quality: 1 },
                html2canvas: { scale: 3, useCORS: true, scrollY: 0 },
                jsPDF: { unit: 'in', format: 'a4', orientation: 'landscape' }
            };
            html2pdf().set(opt).from(element).save().then(() => {
                replacements.forEach(({ textarea, div }) => {
                    div.remove();
                    textarea.style.display = '';
                });
                buttons.forEach(btn => btn.style.display = '');
            });
        }
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LINK KPI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --lm-primary: #3b82f6;
            --lm-primary-dark: #2563eb;
            --lm-light: #f8fafc;
            --lm-dark: #1e293b;
            --lm-gray: #64748b;
            --lm-light-gray: #e2e8f0;
            --lm-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --lm-radius: 8px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f1f5f9;
            color: var(--lm-dark);
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .lm-icon-container {
            position: fixed;
            top: 65px;
            left: 700px;
            z-index: 1000;
        }
        
        .lm-icon {
            display: inline-block;
            background: linear-gradient(135deg, var(--lm-primary), var(--lm-primary-dark));
            color: white;
            padding: 12px 18px;
            border: 2px solid white;
            border-radius: var(--lm-radius);
            cursor: pointer;
            font-weight: bold;
            box-shadow: var(--lm-shadow);
            transition: all 0.3s ease;
            font-size: 15px;
        }
        
        .lm-icon:hover {
            background: linear-gradient(135deg, var(--lm-primary-dark), #1d4ed8);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .lm-dropdown-content {
            display: none;
            position: absolute;
            left: 0;
            top: 100%;
            background-color: white;
            min-width: 320px;
            max-height: 400px;
            overflow-y: auto;
            box-shadow: var(--lm-shadow);
            z-index: 1;
            border-radius: var(--lm-radius);
            margin-top: 10px;
        }
        
        .lm-dropdown-content a {
            display: flex;
            align-items: center;
            color: #333;
            padding: 14px 18px;
            text-decoration: none;
            border-bottom: 1px solid var(--lm-light-gray);
            transition: all 0.3s;
        }
        
        .lm-dropdown-content a:hover {
            background-color: #f0f7ff;
            padding-left: 22px;
        }
        
        .lm-dropdown-content a i {
            margin-right: 12px;
            color: var(--lm-primary);
            font-size: 16px;
            width: 20px;
            text-align: center;
        }
        
        .lm-dropdown-content a:last-child {
            border-bottom: none;
        }
        
        .lm-show {
            display: block;
            animation: lm-fadeIn 0.3s;
        }
        
        @keyframes lm-fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Ẩn thông báo */
        .lm-notification {
            display: none;
        }
        
        @media (max-width: 1200px) {
            .lm-icon-container {
                left: 50%;
                transform: translateX(-50%);
            }
        }
        
        @media (max-width: 600px) {
            .lm-icon-container {
                top: 50px;
                left: 50%;
                transform: translateX(-50%);
            }
            
            .lm-dropdown-content {
                min-width: 280px;
                left: 50%;
                transform: translateX(-50%);
            }
            
            .lm-icon {
                padding: 10px 15px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="lm-icon-container">
        <div class="lm-icon" onclick="lmToggleDropdown()">
            <i class="fas fa-link"></i> HỆ THỐNG KPI  
        </div>
        <div id="lm-dropdown" class="lm-dropdown-content">
            <a href="https://idecopharma.github.io/kpikd01" target="_blank">
                <i class="fas fa-newspaper"></i>
                <span>KPI PHỤ TRÁCH KINH DOANH-</span>
            </a>
			
			<a href="https://idecopharma.github.io/kpitroly01" target="_blank">
                <i class="fas fa-newspaper"></i>
                <span>KPI ĐIỀU PHỐI KHO - TRỢ LÝ KD -NHI </span>
            </a>
            <a href="https://idecopharma.github.io/ketoanth/" target="_blank">
                <i class="fas fa-comments"></i>
                <span>KPI KẾ TOÁN TỔNG HỢP</span>
            </a>
            <a href="https://idecopharma.github.io/kpiketoan02" target="_blank">
                <i class="fas fa-truck-loading"></i>
                <span>KPI KẾ TOÁN BÁN HÀNG- KẾ TOÁN MUA- KẾ TÓA KHO</span>
            </a>
            <a href="https://idecopharma.github.io/kpiKhovan" target="_blank">
                <i class="fas fa-desktop"></i>
                <span>KPI QUẢN LÝ KHO VẬN- MR TUẤN</span>
            </a>
           <a href="https://idecopharma.github.io/kpihuong" target="_blank">
                <i class="fas fa-desktop"></i>
                <span>KPI KINH DOANH - MS HƯƠNG</span>
            </a>
		   
		   
        </div>
    </div>

    <script>
        function lmToggleDropdown() {
            document.getElementById("lm-dropdown").classList.toggle("lm-show");
        }
        
        // Đóng dropdown khi click bên ngoài
        window.onclick = function(event) {
            if (!event.target.matches('.lm-icon') && !event.target.matches('.lm-icon *')) {
                var dropdown = document.getElementById("lm-dropdown");
                if (dropdown.classList.contains('lm-show')) {
                    dropdown.classList.remove('lm-show');
                }
            }
        }
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>XEM GIÁ THU GỌN </title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        /* CSS CHO BỘ KHUNG WIDGET */
        #xgt-widget-trigger {
            position: fixed; bottom: 20px; right: 20px; width: 120px; height: 50px;
            background-color: #4285f4; color: white; border-radius: 8px; border: none;
            font-size: 16px; font-weight: bold; cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.25);
            z-index: 99998; transition: all 0.3s ease; display: flex; justify-content: center; align-items: center;
        }
        #xgt-widget-trigger:hover { background-color: #3367d6; transform: scale(1.05); }

        #xgt-popup-container {
            display: none; 
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 1250px; height: 800px; max-width: 95vw; max-height: 90vh; min-width: 450px; min-height: 400px;
            background-color: #fff; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            z-index: 99999; overflow: hidden; font-family: Arial, sans-serif;
            flex-direction: column;
        }

        /* --- BẮT ĐẦU CSS SCOPED CHO ỨNG DỤNG --- */
        #xgt-popup-container .xgt-app-wrapper { width: 100%; height: 100%; display: flex; flex-direction: column; }
        #xgt-popup-container .xgt-popup-header { 
            display:flex; justify-content:space-between; align-items:center; 
            padding: 15px 20px; border-bottom:1px solid #eee; cursor: move;
            background-color: #f7f9fc; flex-shrink: 0;
        }
        #xgt-popup-container .xgt-popup-title { font-size:20px; color:#4285f4; margin:0; user-select: none; }
        #xgt-popup-container .xgt-close-btn { background:none; border:none; font-size:28px; cursor:pointer; color:#666 }

        #xgt-popup-container .xgt-popup-content { 
            padding: 15px 20px 20px 20px; display:flex; flex-direction:column; 
            flex-grow: 1; overflow: hidden;
        }

        #xgt-popup-container .xgt-search-section { display:flex; gap:8px; flex-shrink: 0; margin-bottom: 10px; }
        #xgt-popup-container .xgt-search-input { flex:1; min-width:220px; padding:10px; border:1px solid #ddd; border-radius:4px; font-size:16px }
        #xgt-popup-container .xgt-btn { padding:10px 12px; border:none; border-radius:6px; font-weight:700; cursor:pointer }
        #xgt-popup-container .xgt-btn-filter { background:#8e24aa; color:#fff }
        #xgt-popup-container .xgt-btn-clear { background:#9e9e9e; color:#fff }

        #xgt-popup-container .xgt-controls-panel {
            transition: all 0.3s ease-in-out; overflow: hidden; flex-shrink: 0;
            max-height: 500px; opacity: 1; border: 1px solid #e0e0e0; border-radius: 5px; padding: 10px;
        }
        #xgt-popup-container .xgt-controls-panel.collapsed { max-height: 0; opacity: 0; padding: 0 10px; border: none; }

        #xgt-popup-container .xgt-toggle-bar { text-align: center; border-top: 1px dashed #ddd; padding: 8px 0 0 0; margin-top: 10px; flex-shrink: 0; }
        #xgt-popup-container #xgt-toggle-controls-btn { background: none; border: none; color: #4285f4; cursor: pointer; font-size: 14px; font-weight: bold; }

        #xgt-popup-container .xgt-upload-section { margin-bottom: 10px; }
        #xgt-popup-container .xgt-file-input-container { display:flex; align-items:center; gap:10px }
        #xgt-popup-container .xgt-file-input-label { padding:8px 15px; background:#4285f4; color:#fff; border-radius:4px; cursor:pointer; }
        #xgt-popup-container .xgt-file-input { display:none }
        #xgt-popup-container .xgt-file-name { flex-grow:1; color:#666; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        #xgt-popup-container .xgt-toolbar { display:flex; flex-direction: column; gap:8px; align-items:flex-start; margin: 10px 0; }
        #xgt-popup-container .xgt-column-list { display:flex; flex-wrap:wrap; gap:8px; max-height:80px; overflow:auto; padding:8px; border:1px dashed #cfe1ff; border-radius:6px; background:#fff; width: 100%; }
        #xgt-popup-container .xgt-column-chip { display:inline-flex; align-items:center; gap:6px; background:#eef4ff; border:1px solid #cfe1ff; border-radius:999px; padding:6px 10px; font-size:13px; user-select: none; }
        #xgt-popup-container .xgt-toolbar-actions { display: flex; gap: 8px; }
        #xgt-popup-container .xgt-toolbar button { padding:8px 12px; border:none; border-radius:6px; cursor:pointer; font-weight:600 }
        #xgt-popup-container .xgt-btn-hide { background:#ff7043; color:#fff } 
        #xgt-popup-container .xgt-btn-unhide { background:#43a047; color:#fff } 
        #xgt-popup-container .xgt-btn-showall { background:#546e7a; color:#fff }

        #xgt-popup-container .xgt-table-container { flex-grow: 1; overflow: auto; margin-top: 10px; border: 1px solid #ddd; border-radius: 4px; }
        /* CẬP NHẬT: Thêm 'table-layout: fixed' để co giãn cột hoạt động tốt hơn */
        #xgt-popup-container .xgt-price-table { width:100%; border-collapse:collapse; table-layout: fixed; }
        #xgt-popup-container .xgt-price-table th, #xgt-popup-container .xgt-price-table td { border:1px solid #ddd; padding:8px; text-align:left; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        #xgt-popup-container .xgt-price-table th { background:#4285f4; color:#fff; position:sticky; top:0; z-index:2 }
        
        /* CSS CHO TÍNH NĂNG CO GIÃN CỘT */
        #xgt-popup-container .xgt-price-table .xgt-th-resizable { position: relative; }
        #xgt-popup-container .xgt-price-table .xgt-col-resizer { position:absolute; right:0; top:0; height:100%; width:5px; cursor:col-resize; z-index: 3;}
        #xgt-popup-container .xgt-price-table .xgt-col-resizer:hover { background: rgba(255,255,255,0.3); }

        /* CSS MỚI: Dành cho co giãn Popup */
        #xgt-popup-container .xgt-popup-resizer {
            position: absolute;
            width: 15px; height: 15px;
            z-index: 100000;
            bottom: 0; right: 0;
            cursor: se-resize;
        }

        #xgt-popup-container .xgt-footer-actions { display:flex; justify-content:flex-end; gap:10px; margin-top:15px; flex-shrink: 0; padding-top: 15px; border-top: 1px solid #eee; }
        #xgt-popup-container .xgt-export-btn:disabled { background-color: #ccc; cursor: not-allowed; }
        
        #xgt-popup-container .xgt-dialog-overlay { display:none; position:absolute; inset:0; background:rgba(0,0,0,.5); z-index:1001; justify-content: center; align-items: center; }
        #xgt-popup-container .xgt-dialog-content { background:#fff; padding:20px; border-radius:8px; box-shadow:0 5px 15px rgba(0,0,0,.3); }
    </style>
</head>
<body>
    <button id="xgt-widget-trigger">Xem Giá</button>
    <div id="xgt-popup-container">
        <div class="xgt-app-wrapper">
            <div class="xgt-popup-header" id="xgt-popup-header">
                <h2 class="xgt-popup-title">Bảng Giá Thuốc</h2>
                <button class="xgt-close-btn" id="xgt-closePopupBtn">&times;</button>
            </div>
            <div class="xgt-popup-content">
                <div class="xgt-search-section">
                    <input type="text" id="xgt-searchInput" class="xgt-search-input" placeholder="Tìm kiếm trong bảng giá..." />
                    <button class="xgt-btn xgt-btn-filter" id="xgt-filterSelectedBtn">Lọc đã chọn</button>
                    <button class="xgt-btn xgt-btn-clear" id="xgt-clearSelectionBtn">Làm mới</button>
                </div>
                <div class="xgt-toggle-bar">
                    <button id="xgt-toggle-controls-btn">Hiện bảng điều khiển</button>
                </div>
                <div id="xgt-controls-panel" class="xgt-controls-panel collapsed">
                    <div class="xgt-upload-section">
                        <div class="xgt-file-input-container">
                            <label for="xgt-excelFileInput" class="xgt-file-input-label">Chọn file Excel</label>
                            <input type="file" id="xgt-excelFileInput" class="xgt-file-input" accept=".xlsx, .xls" multiple />
                            <span class="xgt-file-name" id="xgt-fileNameDisplay">Chưa chọn file</span>
                        </div>
                    </div>
                    <div class="xgt-toolbar" id="xgt-columnToolbar" style="display:none">
                        <div id="xgt-columnList" class="xgt-column-list"></div>
                        <div class="xgt-toolbar-actions">
                             <button class="xgt-btn-hide" id="xgt-btnHide">Ẩn cột đã chọn</button>
                             <button class="xgt-btn-unhide" id="xgt-btnUnhide">Hiện cột đã chọn</button>
                             <button class="xgt-btn-showall" id="xgt-btnShowAll">Hiện tất cả</button>
                        </div>
                    </div>
                    <div id="xgt-filesList" class="xgt-files-list"></div>
                </div>
                <div class="xgt-table-container" id="xgt-tableContainer">
                    </div>
                <div class="xgt-footer-actions">
                    <button class="xgt-btn" id="xgt-addNewRowBtn" style="background: #4caf50;">Thêm hàng</button>
                    <button class="xgt-btn" id="xgt-editRowBtn" style="background: #ffc107;" disabled>Sửa hàng</button>
                    <button class="xgt-btn" id="xgt-deleteRowBtn" style="background: #f44336;" disabled>Xóa hàng</button>
                    <button class="xgt-btn" id="xgt-exportBtn" style="background:#1976d2; color:#fff;">Xuất Excel</button>
                </div>
            </div>
            <div class="xgt-dialog-overlay" id="xgt-passwordDialog">
                 <div class="xgt-dialog-content" style="width: 300px;">
                    <div style="font-size:18px; margin-bottom:15px">Nhập password để xóa file</div>
                    <input type="password" id="xgt-passwordInput" placeholder="Nhập password..." style="width:100%; padding:10px; border:1px solid #ddd; border-radius:4px; font-size:16px" />
                    <div style="display:flex; justify-content:flex-end; gap:10px; margin-top: 15px;">
                        <button class="xgt-btn" id="xgt-passwordDialogCancel" style="background:#f5f5f5">Hủy</button>
                        <button class="xgt-btn" id="xgt-passwordDialogConfirm" style="background:#4285f4; color:#fff">Xác nhận</button>
                    </div>
                 </div>
            </div>
        </div>
        <div class="xgt-popup-resizer" id="xgt-popup-resizer-se"></div>
    </div>

<script>
(function() {
    const widgetTrigger = document.getElementById("xgt-widget-trigger");
    const popupContainer = document.getElementById("xgt-popup-container");
    const popupHeader = document.getElementById("xgt-popup-header");
    const closePopupBtn = document.getElementById("xgt-closePopupBtn");
    const controlsPanel = document.getElementById("xgt-controls-panel");
    const toggleControlsBtn = document.getElementById("xgt-toggle-controls-btn");

    let isDataLoaded = false;
    
    widgetTrigger.addEventListener('click', () => {
        const isVisible = popupContainer.style.display === "flex";
        popupContainer.style.display = isVisible ? "none" : "flex";
        if (!isVisible && !isDataLoaded) {
            loadInitialData();
            isDataLoaded = true;
        }
    });

    closePopupBtn.addEventListener("click", () => { popupContainer.style.display = "none"; });

    toggleControlsBtn.addEventListener('click', () => {
        controlsPanel.classList.toggle('collapsed');
        toggleControlsBtn.textContent = controlsPanel.classList.contains('collapsed') ? 'Hiện bảng điều khiển' : 'Ẩn bảng điều khiển';
    });

    // Kéo-thả để di chuyển popup
    let isDragging = false, offsetX, offsetY;
    popupHeader.addEventListener('mousedown', (e) => {
        isDragging = true; 
        if (popupContainer.style.transform !== 'none') {
            const rect = popupContainer.getBoundingClientRect();
            popupContainer.style.transform = 'none';
            popupContainer.style.left = `${rect.left}px`;
            popupContainer.style.top = `${rect.top}px`;
        }
        offsetX = e.clientX - popupContainer.offsetLeft;
        offsetY = e.clientY - popupContainer.offsetTop;
        document.addEventListener('mousemove', onMouseMove);
        document.addEventListener('mouseup', onMouseUp);
    });
    function onMouseMove(e) { if (!isDragging) return; popupContainer.style.left = `${e.clientX - offsetX}px`; popupContainer.style.top = `${e.clientY - offsetY}px`; }
    function onMouseUp() { isDragging = false; document.removeEventListener('mousemove', onMouseMove); document.removeEventListener('mouseup', onMouseUp); }

    const firebaseConfig = { 
  apiKey : "AIzaSyDKNLLhisemYQJeCW8QCOwfbvVsvUur-60" , 
  authDomain : "quetbarcode-2361a.firebaseapp.com" , 
  databaseURL : "https://quetbarcode-2361a-default-rtdb.firebaseio.com" , 
  projectId : "quetbarcode-2361a" , 
  storageBucket : "quetbarcode-2361a.firebasestorage.app" , 
  messagingSenderId : "209619008657" , 
  appId : "1:209619008657:web:ee4af6f6ec567a1d745330" , 
  measurementId : "G-2TRYH9DYK5" 
};
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    
    let uploadedFiles = [], currentData = [], fileIndexToRemove = null, headersCache = [], columnWidths = {},
        hiddenColumns = new Set(), selectedRowIdx = new Set(), showingOnlySelected = false, 
        rowIndexMap = [], editingRowState = { index: null, originalData: [] };
    const CORRECT_PASSWORD = "minhtriet1973";

    // ... (DOM element selections - không thay đổi) ...
    const excelFileInput = document.getElementById("xgt-excelFileInput"),
          fileNameDisplay = document.getElementById("xgt-fileNameDisplay"),
          filesList = document.getElementById("xgt-filesList"),
          searchInput = document.getElementById("xgt-searchInput"),
          tableContainer = document.getElementById("xgt-tableContainer"),
          passwordDialog = document.getElementById("xgt-passwordDialog"),
          passwordInput = document.getElementById("xgt-passwordInput"),
          passwordDialogCancel = document.getElementById("xgt-passwordDialogCancel"),
          passwordDialogConfirm = document.getElementById("xgt-passwordDialogConfirm"),
          columnToolbar = document.getElementById("xgt-columnToolbar"),
          columnList = document.getElementById("xgt-columnList"),
          btnHide = document.getElementById("xgt-btnHide"),
          btnUnhide = document.getElementById("xgt-btnUnhide"),
          btnShowAll = document.getElementById("xgt-btnShowAll"),
          exportBtn = document.getElementById("xgt-exportBtn"),
          filterSelectedBtn = document.getElementById("xgt-filterSelectedBtn"),
          clearSelectionBtn = document.getElementById("xgt-clearSelectionBtn"),
          addNewRowBtn = document.getElementById("xgt-addNewRowBtn"),
          editRowBtn = document.getElementById("xgt-editRowBtn"),
          deleteRowBtn = document.getElementById("xgt-deleteRowBtn");
          
    // ... (Event listener setup - không thay đổi) ...
    excelFileInput.addEventListener("change", handleFileSelect);
    searchInput.addEventListener("input", () => { showingOnlySelected = false; performSearch(); });
    passwordDialogCancel.addEventListener("click", () => { passwordDialog.style.display = "none"; passwordInput.value = ""; });
    passwordDialogConfirm.addEventListener("click", () => {
        if (passwordInput.value === CORRECT_PASSWORD) {
            if (fileIndexToRemove !== null) removeFile(fileIndexToRemove);
            passwordDialog.style.display = "none"; passwordInput.value = "";
        } else { alert("Password không đúng."); }
    });
    btnHide.addEventListener("click", () => applyColumnSelection("hide"));
    btnUnhide.addEventListener("click", () => applyColumnSelection("unhide"));
    btnShowAll.addEventListener("click", () => { hiddenColumns.clear(); redrawWithFilters(); });
    exportBtn.addEventListener("click", exportCurrentViewToExcel);
    filterSelectedBtn.addEventListener('click', () => { if(selectedRowIdx.size === 0){ alert('Chưa có hàng nào được chọn.'); return; } showingOnlySelected = true; renderSelectedOnly(); });
    clearSelectionBtn.addEventListener('click', () => { selectedRowIdx.clear(); showingOnlySelected = false; searchInput.value = ''; createTable(currentData); updateActionButtonsState(); });
    addNewRowBtn.addEventListener("click", handleAddNewRow);
    editRowBtn.addEventListener("click", handleEditRow);
    deleteRowBtn.addEventListener("click", handleDeleteRows);

    // ... (Các hàm xử lý dữ liệu chính - không thay đổi) ...
    function loadInitialData() { loadDataFromFirebase(); }
    function updateActionButtonsState() {
        const hasSelection = selectedRowIdx.size > 0;
        const isSingleSelection = selectedRowIdx.size === 1;
        const isEditing = editingRowState.index !== null;
        addNewRowBtn.disabled = isEditing;
        editRowBtn.disabled = !isSingleSelection || isEditing;
        deleteRowBtn.disabled = !hasSelection || isEditing;
        editRowBtn.textContent = isEditing ? 'Lưu' : 'Sửa hàng';
        editRowBtn.style.background = isEditing ? '#4caf50' : '#ffc107';
    }
    async function handleAddNewRow() {
        if (headersCache.length === 0) { alert("Vui lòng tải file Excel để có cấu trúc cột."); return; }
        const userFile = uploadedFiles.find(f => f.name === "User Added Data") || { name: "User Added Data", data: [headersCache] };
        if (!uploadedFiles.includes(userFile)) { uploadedFiles.push(userFile); addFileToList(userFile.name, uploadedFiles.length - 1); }
        userFile.data.push(Array(headersCache.length).fill(''));
        await saveDataToFirebase();
        await displayAllData();
        tableContainer.scrollTop = tableContainer.scrollHeight;
        const newRowIndex = currentData.length - 1;
        selectedRowIdx.clear(); selectedRowIdx.add(newRowIndex); handleEditRow();
    }
    function handleEditRow() {
        const cancelEdit = () => {
            const tr = tableContainer.querySelector(`tr[data-row-index='${editingRowState.index}']`);
            if (tr) {
                const cells = tr.querySelectorAll('td');
                const visibleIdx = visibleColumnIndexes();
                visibleIdx.forEach((colIdx, i) => { cells[i].textContent = editingRowState.originalData[colIdx] || ''; });
                cells.forEach(td => { td.contentEditable = 'false'; td.classList.remove('editing-cell'); });
            }
            editingRowState = { index: null, originalData: [] };
            document.getElementById('xgt-cancelEditBtn')?.remove();
            updateActionButtonsState();
        };

        if (editingRowState.index !== null) { // Save changes
            const rowIndex = editingRowState.index;
            const tr = tableContainer.querySelector(`tr[data-row-index='${rowIndex}']`);
            if (!tr) return;
            const cells = tr.querySelectorAll('td');
            const visibleIdx = visibleColumnIndexes();
            let fullNewRow = [...currentData[rowIndex]];
            visibleIdx.forEach((colIdx, i) => { fullNewRow[colIdx] = cells[i].textContent.trim(); });
            const mapping = rowIndexMap[rowIndex];
            if (mapping) {
                uploadedFiles[mapping.fileIndex].data[mapping.rowIndexInFile] = fullNewRow;
                saveDataToFirebase().then(() => {
                    currentData[rowIndex] = fullNewRow;
                    cells.forEach(td => { td.contentEditable = 'false'; td.classList.remove('editing-cell'); });
                    editingRowState = { index: null, originalData: [] };
                    updateActionButtonsState();
                    document.getElementById('xgt-cancelEditBtn')?.remove();
                });
            }
        } else { // Start editing
            if (selectedRowIdx.size !== 1) { alert('Vui lòng chọn một hàng để sửa.'); return; }
            const rowIndex = selectedRowIdx.values().next().value;
            const tr = tableContainer.querySelector(`tr[data-row-index='${rowIndex}']`);
            if (!tr) return;
            editingRowState = { index: rowIndex, originalData: [...currentData[rowIndex]] };
            const cells = tr.querySelectorAll('td');
            cells.forEach((td, i) => { if (i < cells.length - 1) { td.contentEditable = 'true'; td.classList.add('editing-cell'); } });
            cells[0].focus();
            const cancelBtn = document.createElement('button');
            cancelBtn.id = 'xgt-cancelEditBtn';
            cancelBtn.textContent = 'Hủy';
            cancelBtn.className = 'xgt-btn';
            cancelBtn.style.background = '#9e9e9e'; cancelBtn.style.color = 'white';
            cancelBtn.onclick = cancelEdit;
            editRowBtn.parentNode.insertBefore(cancelBtn, editRowBtn.nextSibling);
            updateActionButtonsState();
        }
    }
    async function handleDeleteRows() {
        if (selectedRowIdx.size === 0 || !confirm(`Bạn có chắc muốn xóa ${selectedRowIdx.size} hàng đã chọn?`)) return;
        const toDeleteByFile = {};
        selectedRowIdx.forEach(rowIndex => {
            const mapping = rowIndexMap[rowIndex];
            if (mapping) {
                if (!toDeleteByFile[mapping.fileIndex]) toDeleteByFile[mapping.fileIndex] = [];
                toDeleteByFile[mapping.fileIndex].push(mapping.rowIndexInFile);
            }
        });
        for (const fileIndex in toDeleteByFile) {
            toDeleteByFile[fileIndex].sort((a, b) => b - a).forEach(rowIndexInFile => uploadedFiles[fileIndex].data.splice(rowIndexInFile, 1));
        }
        selectedRowIdx.clear();
        await saveDataToFirebase(); await displayAllData(); updateActionButtonsState();
    }
    async function handleFileSelect(event){
        const files = event.target.files; if(!files.length) return;
        tableContainer.innerHTML = `<div class="xgt-loading" style="display: block;"><div class="xgt-spinner"></div></div>`;
        for(let file of files){
            try {
                const data = await readExcelFile(file);
                uploadedFiles.push({ name: file.name, data });
                addFileToList(file.name, uploadedFiles.length - 1);
            } catch(error){ alert(`Lỗi đọc file ${file.name}: ${error.message}`); }
        }
        updateFileNameDisplay(); displayAllData(); saveDataToFirebase();
    }
    function readExcelFile(file){
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = e => {
                try {
                    const workbook = XLSX.read(new Uint8Array(e.target.result), { type: "array" });
                    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                    let jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, defval: "", raw: false });
                    resolve(jsonData.filter(row => row.some(cell => String(cell).trim() !== '')));
                } catch(error) { reject(error); }
            };
            reader.onerror = error => reject(error);
            reader.readAsArrayBuffer(file);
        });
    }
    function addFileToList(fileName, index){
        const fileItem = document.createElement("div");
        fileItem.className = "xgt-file-item";
        fileItem.innerHTML = `<span>${fileName}</span><button class="xgt-delete-file-btn" data-index="${index}">Xóa</button>`;
        filesList.appendChild(fileItem);
        fileItem.querySelector(".xgt-delete-file-btn").addEventListener("click", (e)=>{
            fileIndexToRemove = parseInt(e.target.getAttribute("data-index"));
            passwordDialog.style.display = "flex"; passwordInput.focus();
        });
    }
    function removeFile(index){
        uploadedFiles.splice(index, 1);
        filesList.innerHTML = "";
        uploadedFiles.forEach((file, i) => addFileToList(file.name, i));
        updateFileNameDisplay(); displayAllData(); saveDataToFirebase();
    }
    function updateFileNameDisplay(){
        fileNameDisplay.textContent = uploadedFiles.length === 0 ? "Chưa chọn file" : `${uploadedFiles.length} file đã chọn`;
    }
    function displayAllData(){
        if (editingRowState.index !== null) handleEditRow();
        currentData = []; rowIndexMap = [];
        let isFirstFile = true;
        uploadedFiles.forEach((file, fileIndex) => {
            if (!file.data || file.data.length === 0) return;
            let dataSlice = file.data;
            if (isFirstFile) { headersCache = dataSlice[0] || []; isFirstFile = false; }
            for (let i = 0; i < dataSlice.length; i++) {
                if (i === 0 && fileIndex > 0) continue;
                currentData.push(dataSlice[i]);
                rowIndexMap.push({ fileIndex, rowIndexInFile: i });
            }
        });
        selectedRowIdx.clear(); showingOnlySelected = false; searchInput.value = '';
        createTable(currentData); updateActionButtonsState(); renderColumnSelector();
    }
    function visibleColumnIndexes(){ return (headersCache || []).map((_, idx) => idx).filter(idx => !hiddenColumns.has(idx)); }
    
    function createTable(data){
        tableContainer.innerHTML = "";
        if(!data || data.length <= 1){ tableContainer.innerHTML = `<p style="text-align: center; padding: 40px; color: #888;">Không có dữ liệu.</p>`; return; }
        headersCache = data[0] || [];
        const visibleIdx = visibleColumnIndexes();
        const table = document.createElement("table");
        table.className = "xgt-price-table";
        const thead = document.createElement("thead");
        const headerRow = document.createElement("tr");

        visibleIdx.forEach(colIdx => { 
            const th = document.createElement("th");
            th.className = 'xgt-th-resizable';
            th.textContent = headersCache[colIdx] || "";
            th.style.width = columnWidths[colIdx] ? `${columnWidths[colIdx]}px` : 'auto';
            th.dataset.colIndex = colIdx;
            const resizer = document.createElement('div'); 
            resizer.className = 'xgt-col-resizer';
            th.appendChild(resizer);
            headerRow.appendChild(th); 
        });
        const thChoose = document.createElement('th'); thChoose.textContent = 'Chọn'; headerRow.appendChild(thChoose);
        thead.appendChild(headerRow); table.appendChild(thead);

        const tbody = document.createElement("tbody");
        for(let i=1; i < data.length; i++){
            const tr = document.createElement("tr");
            tr.dataset.rowIndex = i;
            visibleIdx.forEach(colIdx => {
                const td = document.createElement("td"); td.textContent = data[i][colIdx] || ''; tr.appendChild(td);
            });
            const tdChoose = document.createElement('td');
            const cb = document.createElement('input'); cb.type = 'checkbox';
            cb.addEventListener('change', () => { if(cb.checked) selectedRowIdx.add(i); else selectedRowIdx.delete(i); updateActionButtonsState(); });
            tdChoose.style.textAlign = 'center'; tdChoose.appendChild(cb); tr.appendChild(tdChoose);
            tbody.appendChild(tr);
        }
        table.appendChild(tbody);
        tableContainer.appendChild(table);
        enableColumnResizing();
    }
    
    // HÀM MỚI (VIẾT LẠI): Xử lý logic co giãn cột một cách ổn định
    function enableColumnResizing() {
        const headers = document.querySelectorAll('#xgt-tableContainer .xgt-th-resizable');
        headers.forEach(header => {
            const resizer = header.querySelector('.xgt-col-resizer');
            if (!resizer) return;

            const onMouseDown = (e) => {
                e.preventDefault();
                const startX = e.clientX;
                const startWidth = header.offsetWidth;

                const onMouseMove = (moveEvent) => {
                    const newWidth = startWidth + (moveEvent.clientX - startX);
                    if (newWidth > 50) { // Đặt giới hạn tối thiểu
                        header.style.width = `${newWidth}px`;
                    }
                };

                const onMouseUp = () => {
                    document.removeEventListener('mousemove', onMouseMove);
                    document.removeEventListener('mouseup', onMouseUp);
                    // Lưu lại độ rộng mới của cột
                    columnWidths[header.dataset.colIndex] = header.offsetWidth;
                };

                document.addEventListener('mousemove', onMouseMove);
                document.addEventListener('mouseup', onMouseUp);
            };

            resizer.addEventListener('mousedown', onMouseDown);
        });
    }

    // HÀM MỚI: Xử lý logic co giãn popup
    function enablePopupResizing() {
        const resizer = document.getElementById('xgt-popup-resizer-se');
        
        const onMouseDown = (e) => {
            e.preventDefault();
            const startX = e.clientX;
            const startY = e.clientY;
            const startWidth = popupContainer.offsetWidth;
            const startHeight = popupContainer.offsetHeight;

            // Khi bắt đầu resize, chuyển từ transform sang top/left để tính toán ổn định
            if (popupContainer.style.transform !== 'none') {
                const rect = popupContainer.getBoundingClientRect();
                popupContainer.style.transform = 'none';
                popupContainer.style.left = `${rect.left}px`;
                popupContainer.style.top = `${rect.top}px`;
            }

            const onMouseMove = (moveEvent) => {
                const newWidth = startWidth + (moveEvent.clientX - startX);
                const newHeight = startHeight + (moveEvent.clientY - startY);
                popupContainer.style.width = `${newWidth}px`;
                popupContainer.style.height = `${newHeight}px`;
            };

            const onMouseUp = () => {
                document.removeEventListener('mousemove', onMouseMove);
                document.removeEventListener('mouseup', onMouseUp);
            };

            document.addEventListener('mousemove', onMouseMove);
            document.addEventListener('mouseup', onMouseUp);
        };

        resizer.addEventListener('mousedown', onMouseDown);
    }
    
    // ... (Các hàm tiện ích khác - không thay đổi) ...
    function renderColumnSelector(){
        columnList.innerHTML = ""; if(!headersCache.length){ columnToolbar.style.display = 'none'; return; }
        columnToolbar.style.display = 'flex';
        headersCache.forEach((name, idx) => {
            const chip = document.createElement('label'); chip.className = 'xgt-column-chip';
            const cb = document.createElement('input'); cb.type = 'checkbox'; cb.dataset.index = idx; cb.checked = !hiddenColumns.has(idx);
            const span = document.createElement('span'); span.textContent = name || `Cột ${idx+1}`;
            chip.appendChild(cb); chip.appendChild(span); columnList.appendChild(chip);
        });
    }
    function applyColumnSelection(mode) {
        columnList.querySelectorAll('input:checked').forEach(cb => {
            const idx = parseInt(cb.dataset.index);
            if (mode === 'hide') hiddenColumns.add(idx);
            else if (mode === 'unhide') hiddenColumns.delete(idx);
        });
        redrawWithFilters();
    }
    function redrawWithFilters(){
        if (showingOnlySelected) renderSelectedOnly();
        else if (searchInput.value.trim()) performSearch();
        else createTable(currentData);
        renderColumnSelector();
    }
    function renderSelectedOnly(){
        const indices = Array.from(selectedRowIdx).sort((a,b)=>a-b);
        const aoa = [currentData[0], ...indices.map(idx => currentData[idx])];
        createTable(aoa);
    }
    function performSearch(){
        const term = searchInput.value.trim().toLowerCase();
        if (!term) { createTable(currentData); return; }
        const filtered = [currentData[0], ...currentData.slice(1).filter(row => row.some(cell => String(cell).toLowerCase().includes(term)))];
        createTable(filtered);
    }
    async function saveDataToFirebase(){
        const userFile = uploadedFiles.find(f => f.name === "User Added Data");
        if(userFile) userFile.data = userFile.data.filter((row, i) => i === 0 || row.some(cell => String(cell).trim() !== ''));
        try { await database.ref("priceData").set({ files: uploadedFiles }); }
        catch (err) { alert("Lỗi khi lưu dữ liệu lên server."); }
    }
    function loadDataFromFirebase(){
        tableContainer.innerHTML = `<div class="xgt-loading" style="display: block;"><div class="xgt-spinner"></div><p>Đang tải dữ liệu...</p></div>`;
        database.ref('priceData').once('value').then(snapshot => {
            const data = snapshot.val();
            if(data && data.files && data.files.length > 0){ 
                uploadedFiles = data.files;
                filesList.innerHTML = '';
                uploadedFiles.forEach((file,index) => addFileToList(file.name, index));
                updateFileNameDisplay(); displayAllData();
            } else { tableContainer.innerHTML = `<p style="text-align:center; padding: 40px; color: #888;">Chưa có dữ liệu.</p>`; }
        }).catch(error => {
            tableContainer.innerHTML = `<p style="text-align:center; padding: 40px; color: #888;">Lỗi tải dữ liệu.</p>`;
        });
    }
    function exportCurrentViewToExcel(){
        const table = tableContainer.querySelector('.xgt-price-table');
        if(!table){ alert('Không có dữ liệu để xuất.'); return; }
        const aoa = [];
        table.querySelectorAll('tr').forEach(tr => {
            const row = [];
            tr.querySelectorAll('th, td').forEach((cell, index) => { if (index < tr.cells.length - 1) row.push(cell.textContent.trim()); });
            if(row.length > 0) aoa.push(row);
        });
        if (aoa.length <= 1) { alert('Không có dữ liệu để xuất.'); return; }
        const ws = XLSX.utils.aoa_to_sheet(aoa);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, 'BangGia');
        XLSX.writeFile(wb, `BangGia_Xuat_${new Date().toISOString().slice(0,10)}.xlsx`);
    }

    // Kích hoạt chức năng co giãn popup ngay khi script chạy
    enablePopupResizing();

})();
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>ĐỊNH HƯỚNG TUẦN</title>
  <meta name="viewport" content="width=1200">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"/>
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<style>
  .custom-shadow-copy { box-shadow: 0 4px 24px 0 rgba(59, 130, 246, 0.25); }
  .scrollbar-copy { scrollbar-width: thin; scrollbar-color: #cbd5e1 #fff; }
  .scrollbar-copy::-webkit-scrollbar { width: 8px; }
  .scrollbar-copy::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px;}
  #mainIcon_copy { position: fixed; top: 61px; right:720px; z-index: 1000; cursor: pointer; transition: all 0.3s ease; }
  #mainIcon_copy:hover { transform: scale(1.05); box-shadow: 0 6px 28px 0 rgba(59, 130, 246, 0.3); }
  .icon-rectangle-copy { width: 220px; height: 55px; border-radius: 16px; background-color: green; border: 4px solid white; box-shadow: 0 4px 24px 0 rgba(59, 130, 246, 0.25); display: flex; align-items: center; justify-content: center; padding: 0 15px; }
  .icon-text-copy { color: white; font-size: 1.325rem; font-weight: bold; text-align: center; width: 100%; }
  #wowup_copy { z-index: 9999; }
  .pdf-viewer-container-copy { width: 100%; padding: 0; margin: 0; position: relative; background: none; }
  .pdf-page-container-copy { margin: 0; box-shadow: none; display: block; width: 100%; padding: 0; }
  .pdf-page-copy { max-width: 100% !important; width: 100% !important; height: auto !important; display: block; margin: 0; padding: 0; }
  .file-title-copy { margin-bottom: 6px; font-size: 1.1rem; color: #333; align-self: flex-start; padding-left: 12px; }
  .delete-modal_copy { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 100; justify-content: center; align-items: center; }
  .delete-modal-content_copy { background-color: white; padding: 20px; border-radius: 8px; width: 400px; max-width: 90%; }
  .delete-checkbox_copy { margin-right: 10px; }
  .delete-file-item_copy { display: flex; align-items: center; padding: 8px 0; border-bottom: 1px solid #eee; }
  #popup_copy_resizable { min-width: 500px; min-height: 400px; max-width: 98vw; max-height: 95vh; resize: none; box-sizing: border-box; }
  .resize-handle-copy { position: absolute; width: 20px; height: 20px; right: 0; bottom: 0; cursor: nwse-resize; z-index: 1000; background: transparent; }
  .resize-handle-copy::after { content: ""; display: block; width: 20px; height: 20px; background: url('data:image/svg+xml;utf8,<svg width="20" height="20" xmlns="http://www.w3.org/2000/svg"><path d="M0,20 L20,0 M8,20 L20,8" stroke="rgb(59,130,246)" stroke-width="2"/></svg>'); opacity: 0.6; }
  .loading-overlay-copy { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 200; justify-content: center; align-items: center; color: white; font-size: 1.5rem; flex-direction: column; }
  .spinner-copy { border: 5px solid #f3f3f3; border-top: 5px solid #3b82f6; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin-bottom: 15px; }
  @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  .footer-buttons-copy { padding: 8px 4px; height: 60px; }
  .footer-buttons-copy .flex-wrap { gap: 6px; }
  .footer-buttons-copy button, .footer-buttons-copy input { padding: 4px 8px; font-size: 0.875rem; }
  /* Style for editor */
  #editorArea_copy { box-shadow: 0 8px 30px 0 rgba(0,0,0,0.15); border-radius: 10px; }
  #editorArea_copy .ql-toolbar { border-radius: 10px 10px 0 0; }
  #editorArea_copy .ql-container { border-radius: 0 0 10px 10px; }
  /* --- HỖ TRỢ ĐẦU DÒNG DANH SÁCH --- */
  .quill-content-copy ol { list-style-type: decimal; margin-left: 2rem; padding-left: 1rem;}
  .quill-content-copy ul { list-style-type: disc; margin-left: 2rem; padding-left: 1rem;}
  /* --- CẢI TIẾN FONT VÀ KÍCH THƯỚC CHỮ CHO NỘI DUNG ĐÃ LƯU --- */
  .quill-content-copy .ql-size-small { font-size: 0.75em; }
  .quill-content-copy .ql-size-large { font-size: 1.5em; }
  .quill-content-copy .ql-size-huge { font-size: 2.5em; }
  .quill-content-copy .ql-font-arial { font-family: Arial, Helvetica, sans-serif; }
  .quill-content-copy .ql-font-times-new-roman { font-family: "Times New Roman", Times, serif; }
  .quill-content-copy .ql-font-sans-serif { font-family: sans-serif; }
  .quill-content-copy .ql-font-serif { font-family: serif; }
  .quill-content-copy .ql-font-monospace { font-family: monospace; }
  .ql-font-arial { font-family: Arial, Helvetica, sans-serif; }
  .ql-font-times-new-roman { font-family: "Times New Roman", Times, serif; }
  .ql-font-sans-serif { font-family: sans-serif; }
  .ql-font-serif { font-family: serif; }
  .ql-font-monospace { font-family: monospace; }
  #quillEditorCopy {
    background-color: white;
    min-height: 300px;
    font-size: 16px;
    line-height: 1.5;
  }
  #quillEditorCopy .ql-editor {
    min-height: 300px;
  }
</style>
</head>
<body class="bg-gray-50">
  <div id="mainIcon_copy">
    <div class="icon-rectangle-copy">
      <span class="icon-text-copy"> ĐỊNH HƯỚNG TUẦN</span>
    </div>
  </div>
  <div id="wowup_copy" class="hidden fixed z-50 top-0 left-0 w-full h-full flex items-center justify-center bg-black bg-opacity-40">
    <div id="popup_copy_resizable" class="relative bg-white custom-shadow-copy border-4 border-blue-500 flex flex-col" style="width: 85vw; height: 80vh;">
      <div id="contentArea_copy" class="flex-1 overflow-y-scroll p-0 scrollbar-copy border-b border-blue-200" style="max-height: calc(80vh - 100px);"></div>
      <div class="footer-buttons-copy flex gap-3 items-center justify-center flex-wrap">
        <input type="file" id="pdfInput_copy" accept="application/pdf" multiple class="rounded-full border-0 bg-blue-600 text-white py-1 px-3" />
        <input type="password" id="passwordInput_copy" placeholder="Password upload" class="border px-2 py-1 rounded" />
        <button onclick="handleUpload_copy()" id="uploadBtn_copy" class="bg-blue-500 text-white px-3 py-1 rounded shadow hover:bg-blue-700">
          Upload
        </button>
        <button onclick="showEditor_copy()" id="editorBtn_copy" class="bg-purple-600 text-white px-3 py-1 rounded shadow hover:bg-purple-800">
          Nhập nội dung
        </button>
        <button onclick="handleSave_copy()" id="saveBtn_copy" class="bg-green-600 text-white px-3 py-1 rounded shadow hover:bg-green-800">
          Lưu
        </button>
        <button onclick="showDeleteModal_copy()" id="deleteBtn_copy" class="bg-red-600 text-white px-3 py-1 rounded shadow hover:bg-red-800" disabled>
          Xóa file
        </button>
        <button onclick="closeWowup_copy()" title="Đóng popup"
          class="bg-gray-200 text-blue-500 px-3 py-1 rounded-full text-xl font-bold shadow hover:bg-gray-400 flex items-center justify-center"
        >×</button>
        <!-- NÚT "ĐÃ ĐỌC" MỚI -->
        <button id="markAsReadBtn_copy" class="bg-gray-600 text-white px-3 py-1 rounded shadow hover:bg-gray-800 text-sm">
          Đã đọc
        </button>
      </div>
      <div class="resize-handle-copy"></div>
      <div id="editorArea_copy" class="hidden absolute top-0 left-0 w-full h-full bg-white z-20 flex flex-col rounded-lg border border-blue-400 shadow-lg">
        <input type="text" id="editorFileName_copy" class="border rounded px-3 py-2 m-2 text-lg font-semibold" placeholder="Nhập tên nội dung (ví dụ: ĐỊNH HƯỚNG TUẦN)"/>
        <div id="quillToolbarCopy"></div>
        <div id="quillEditorCopy" style="flex:1; min-height:320px;"></div>
        <div class="flex gap-2 justify-end p-2">
          <button onclick="saveEditorContent_copy()" class="bg-green-600 text-white px-3 py-1 rounded shadow hover:bg-green-800">Lưu nội dung</button>
          <button onclick="closeEditor_copy()" class="bg-gray-400 text-white px-3 py-1 rounded shadow hover:bg-gray-600">Đóng</button>
        </div>
      </div>
    </div>
  </div>
  <div id="deleteModal_copy" class="delete-modal_copy">
    <div class="delete-modal-content_copy">
      <h2 class="text-xl font-bold mb-4">Chọn file để xóa</h2>
      <input type="password" id="deletePasswordInput_copy" placeholder="Nhập mật khẩu để xóa" class="border px-3 py-2 rounded w-full mb-4" />
      <div id="fileListToDelete_copy" class="mb-4 max-h-60 overflow-y-auto"></div>
      <div class="flex justify-end gap-2">
        <button onclick="hideDeleteModal_copy()" class="bg-gray-500 text-white px-4 py-2 rounded shadow hover:bg-gray-700">Hủy</button>
        <button onclick="handleDeleteFiles_copy()" class="bg-red-600 text-white px-4 py-2 rounded shadow hover:bg-red-800">Xóa</button>
      </div>
    </div>
  </div>
  <div id="loadingOverlayCopy" class="loading-overlay-copy">
    <div class="spinner-copy"></div>
    <span id="loadingTextCopy">Đang xử lý...</span>
  </div>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
  <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
  <script>
    (function() {
      const firebaseConfig_copy = {
        apiKey: "AIzaSyD4BbsXN-vLQM4JNtMWfNsNOXPnt-a9KpM",
        authDomain: "chuoint-2df9d.firebaseapp.com",
        databaseURL: "https://chuoint-2df9d-default-rtdb.firebaseio.com",
        projectId: "chuoint-2df9d",
        storageBucket: "chuoint-2df9d.firebasestorage.app",
        messagingSenderId: "989211370756",
        appId: "1:989211370756:web:475391dd8d96a0b7375c51",
        measurementId: "G-FKEXNN9VDV"
      };
      if (!firebase.apps.some(app => app.name === "app_copy")) {
        firebase.initializeApp(firebaseConfig_copy, "app_copy");
      }
      const db_copy = firebase.app("app_copy").database();
      const mainIcon_copy = document.getElementById('mainIcon_copy');
      const wowup_copy = document.getElementById('wowup_copy');
      const pdfInput_copy = document.getElementById('pdfInput_copy');
      const passwordInput_copy = document.getElementById('passwordInput_copy');
      const uploadBtn_copy = document.getElementById('uploadBtn_copy');
      const editorBtn_copy = document.getElementById('editorBtn_copy');
      const saveBtn_copy = document.getElementById('saveBtn_copy');
      const deleteBtn_copy = document.getElementById('deleteBtn_copy');
      const contentArea_copy = document.getElementById('contentArea_copy');
      const editorArea_copy = document.getElementById('editorArea_copy');
      const editorFileName_copy = document.getElementById('editorFileName_copy');
      const quillEditorCopy = document.getElementById('quillEditorCopy');
      const loadingOverlayCopy = document.getElementById('loadingOverlayCopy');
      const loadingTextCopy = document.getElementById('loadingTextCopy');
      const deleteModal_copy = document.getElementById('deleteModal_copy');
      const fileListToDelete_copy = document.getElementById('fileListToDelete_copy');
      const deletePasswordInput_copy = document.getElementById('deletePasswordInput_copy');
      const markAsReadBtn_copy = document.getElementById('markAsReadBtn_copy');

      let allPdfs_copy = [];
      let quillInstance_copy = null;
      let editingIndex_copy = null;

      mainIcon_copy.onclick = function() {
        wowup_copy.classList.remove('hidden');
        loadFromFirebase_copy();
      };

      function closeWowup_copy() {
        wowup_copy.classList.add('hidden');
      }

      // === CẤU HÌNH POPUP TỰ ĐỘNG - ĐƠN GIẢN HÓA ===
      const autoPopupConfig_copy = {
        targetWeekdays: [1, 2, 3, 4, 5, 6], // Thứ 2 đến thứ 7
        openTimes: [
          {hour: 10, minute: 30}, 
          {hour: 16, minute: 30}
        ],
        // Lưu trữ ngày đã đọc gần nhất
        lastReadDate: localStorage.getItem('popupLastReadDate_copy') || ''
      };

      // === HÀM ĐÁNH DẤU ĐÃ ĐỌC - ĐƠN GIẢN ===
      function markAsReadAndClose_copy() {
        const now = new Date();
        const todayKey = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;
        
        // Lưu ngày hôm nay là đã đọc
        autoPopupConfig_copy.lastReadDate = todayKey;
        localStorage.setItem('popupLastReadDate_copy', todayKey);
        
        console.log('Đã đánh dấu đã đọc cho ngày:', todayKey);
        closeWowup_copy();
      }

      // Hàm kiểm tra xem có nên hiển thị popup không - ĐƠN GIẢN HÓA
      function shouldShowPopup() {
        const now = new Date();
        const todayKey = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;
        
        console.log('Kiểm tra popup - Ngày hôm nay:', todayKey, '- Đã đọc:', autoPopupConfig_copy.lastReadDate);
        
        // Nếu hôm nay đã đọc rồi thì không hiển thị
        if (autoPopupConfig_copy.lastReadDate === todayKey) {
          console.log('Hôm nay đã đọc rồi, không hiển thị popup');
          return false;
        }
        
        // Kiểm tra ngày trong tuần
        if (!autoPopupConfig_copy.targetWeekdays.includes(now.getDay())) {
          console.log('Không phải ngày trong tuần cần hiển thị popup');
          return false;
        }
        
        // Kiểm tra xem có đang trong khung giờ thiết lập không
        const currentHour = now.getHours();
        const currentMinute = now.getMinutes();
        
        for (const time of autoPopupConfig_copy.openTimes) {
          // Hiển thị trong 5 phút đầu tiên của mỗi khung giờ
          if (currentHour === time.hour && currentMinute >= time.minute && currentMinute < time.minute + 5) {
            console.log('Đang trong khung giờ thiết lập:', time.hour + ':' + time.minute);
            return true;
          }
        }
        
        // Kiểm tra xem có khung giờ nào trong ngày đã qua nhưng chưa được đọc không
        for (const time of autoPopupConfig_copy.openTimes) {
          if (currentHour > time.hour || (currentHour === time.hour && currentMinute >= time.minute)) {
            console.log('Đã qua khung giờ', time.hour + ':' + time.minute, 'nhưng chưa đọc');
            return true;
          }
        }
        
        console.log('Không có khung giờ nào cần hiển thị popup');
        return false;
      }

      if (markAsReadBtn_copy) {
        markAsReadBtn_copy.onclick = markAsReadAndClose_copy;
      }

      function showLoading_copy(message) {
        loadingTextCopy.textContent = message || 'Đang xử lý...';
        loadingOverlayCopy.style.display = 'flex';
      }
      
      function hideLoading_copy() { 
        loadingOverlayCopy.style.display = 'none'; 
      }
      
      function loadFromFirebase_copy() {
        showLoading_copy('Đang tải dữ liệu từ Firebase...');
        db_copy.ref('pdfData').once('value').then((snapshot) => {
          const data = snapshot.val();
          if (!data) allPdfs_copy = [];
          else if (Array.isArray(data)) allPdfs_copy = data;
          else allPdfs_copy = Object.values(data);
          showPdfContent_copy(allPdfs_copy);
          deleteBtn_copy.disabled = allPdfs_copy.length === 0;
          saveBtn_copy.disabled = allPdfs_copy.length === 0;
          hideLoading_copy();
        }).catch((error) => {
          alert('Lỗi khi tải dữ liệu từ Firebase! ' + error.message);
          hideLoading_copy();
        });
      }
      
      async function showPdfContent_copy(pdfDataArr) {
        contentArea_copy.innerHTML = '';
        if (!pdfDataArr || pdfDataArr.length === 0) {
          contentArea_copy.innerHTML = '<div class="p-4 text-gray-500 text-center">Không có dữ liệu nào được tải lên.</div>';
          return;
        }
        for (let i = 0; i < pdfDataArr.length; i++) {
          const info = pdfDataArr[i];
          const container = document.createElement('div');
          container.className = "pdf-viewer-container-copy";
          const title = document.createElement('div');
          title.className = "file-title-copy";
          title.textContent = `#${i + 1}: ${info.name || 'Không có tên'}`;
          container.appendChild(title);
          if (info.type === 'text') {
            const contentDiv = document.createElement('div');
            contentDiv.innerHTML = info.html;
            contentDiv.className = "p-3 border rounded bg-yellow-50 mb-3 quill-content-copy";
            const editBtn = document.createElement('button');
            editBtn.textContent = "Sửa";
            editBtn.className = "ml-2 bg-blue-500 text-white px-2 py-1 rounded shadow hover:bg-blue-700";
            editBtn.onclick = function() { editEditorContent_copy(i); };
            title.appendChild(editBtn);
            container.appendChild(contentDiv);
          } else {
            const pdfContainer = document.createElement('div');
            pdfContainer.className = "pdf-container";
            container.appendChild(pdfContainer);
            await renderPdf_copy(info.data, pdfContainer);
          }
          contentArea_copy.appendChild(container);
        }
      }
      
      async function renderPdf_copy(pdfData, container) {
        try {
          const binaryString = atob(pdfData);
          const bytes = new Uint8Array(binaryString.length);
          for (let i = 0; i < binaryString.length; i++) bytes[i] = binaryString.charCodeAt(i);
          const pdf = await pdfjsLib.getDocument({data: bytes}).promise;
          for (let j = 1; j <= pdf.numPages; j++) {
            const page = await pdf.getPage(j);
            const parentWidth = container.clientWidth || container.offsetWidth || 0;
            const pdfOriginalWidth = page.getViewport({ scale: 1.0 }).width;
            let scale = 1;
            if (parentWidth > 0 && pdfOriginalWidth > 0) scale = parentWidth / pdfOriginalWidth;
            const viewport = page.getViewport({ scale: scale });
            const pageContainer = document.createElement('div');
            pageContainer.className = "pdf-page-container-copy";
            pageContainer.style.width = "100%";
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = viewport.width;
            canvas.height = viewport.height;
            canvas.className = "pdf-page-copy";
            canvas.style.width = "100%";
            canvas.style.height = "auto";
            pageContainer.appendChild(canvas);
            container.appendChild(pageContainer);
            await page.render({
              canvasContext: context,
              viewport: viewport
            }).promise;
          }
        } catch (error) {
          container.innerHTML = `<div class="text-red-500 p-4">Lỗi khi hiển thị PDF: ${error.message}</div>`;
        }
      }
      
      async function handleUpload_copy() {
        const password = passwordInput_copy.value;
        if (password !== "MinhTriet@1973") {
          alert("Sai mật khẩu!");
          return;
        }
        const files = pdfInput_copy.files;
        if (!files.length) {
          alert("Vui lòng chọn ít nhất một file PDF!");
          return;
        }
        uploadBtn_copy.innerText = "Đang xử lý...";
        uploadBtn_copy.disabled = true;
        showLoading_copy('Đang xử lý file PDF...');
        try {
          for (let i = 0; i < files.length; i++) {
            const file = files[i];
            const pdfData = await readFileAsBase64_copy(file);
            allPdfs_copy.push({ name: file.name, data: pdfData });
          }
          showPdfContent_copy(allPdfs_copy);
          deleteBtn_copy.disabled = false;
          saveBtn_copy.disabled = false;
          passwordInput_copy.value = "";
          pdfInput_copy.value = "";
        } catch (error) {
          alert('Lỗi khi tải lên PDF: ' + error.message);
        } finally {
          uploadBtn_copy.innerText = "Upload";
          uploadBtn_copy.disabled = false;
          hideLoading_copy();
        }
      }
      
      window.handleUpload_copy = handleUpload_copy;
      
      function readFileAsBase64_copy(file) {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = function() {
            const base64String = reader.result.split(',')[1];
            resolve(base64String);
          };
          reader.onerror = reject;
          reader.readAsDataURL(file);
        });
      }
      
      async function handleSave_copy() {
        try {
          if (!allPdfs_copy || allPdfs_copy.length === 0) {
            alert('Không có dữ liệu nào để lưu!');
            return;
          }
          saveBtn_copy.innerText = "Đang lưu...";
          saveBtn_copy.disabled = true;
          showLoading_copy('Đang lưu dữ liệu vào Firebase...');
          await db_copy.ref('pdfData').set(allPdfs_copy);
          alert('Dữ liệu đã được lưu thành công vào Firebase!');
          deleteBtn_copy.disabled = allPdfs_copy.length === 0;
        } catch (error) {
          alert(`Lỗi khi lưu dữ liệu: ${error.message}`);
        } finally {
          saveBtn_copy.innerText = "Lưu";
          saveBtn_copy.disabled = false;
          hideLoading_copy();
        }
      }
      
      window.handleSave_copy = handleSave_copy;
      
      function showDeleteModal_copy() {
        fileListToDelete_copy.innerHTML = '';
        allPdfs_copy.forEach((item, index) => {
          const itemDiv = document.createElement('div');
          itemDiv.className = 'delete-file-item_copy';
          itemDiv.innerHTML = `
            <input type="checkbox" id="delete_${index}_copy" class="delete-checkbox_copy" checked>
            <label for="delete_${index}_copy">${item.name || `File ${index + 1}`}</label>
          `;
          fileListToDelete_copy.appendChild(itemDiv);
        });
        deleteModal_copy.style.display = 'flex';
        deletePasswordInput_copy.focus();
      }
      
      window.showDeleteModal_copy = showDeleteModal_copy;
      
      function hideDeleteModal_copy() {
        deleteModal_copy.style.display = 'none';
        deletePasswordInput_copy.value = '';
      }
      
      window.hideDeleteModal_copy = hideDeleteModal_copy;
      
      function handleDeleteFiles_copy() {
        const password = deletePasswordInput_copy.value;
        if (password !== "minhtriet@1973") {
          alert("Sai mật khẩu!");
          return;
        }
        const checkboxes = document.querySelectorAll('.delete-checkbox_copy');
        const filesToKeep = [];
        checkboxes.forEach((checkbox, index) => {
          if (!checkbox.checked) {
            filesToKeep.push(allPdfs_copy[index]);
          }
        });
        if (filesToKeep.length === allPdfs_copy.length) {
          alert("Bạn chưa chọn file nào để xóa!");
          return;
        }
        if (!confirm(`Bạn chắc chắn muốn xóa ${allPdfs_copy.length - filesToKeep.length} mục đã chọn không?`)) return;
        showLoading_copy('Đang xóa...');
        db_copy.ref('pdfData').set(filesToKeep)
          .then(() => {
            loadFromFirebase_copy();
            hideDeleteModal_copy();
          })
          .catch((error) => {
            alert('Lỗi khi xóa: ' + error.message);
            hideLoading_copy();
          });
      }
      
      window.handleDeleteFiles_copy = handleDeleteFiles_copy;
      
      function showEditor_copy() {
        editorArea_copy.classList.remove('hidden');
        if (!quillInstance_copy) {
          var Font = Quill.import('formats/font');
          Font.whitelist = ['arial', 'times-new-roman', 'sans-serif', 'serif', 'monospace'];
          Quill.register(Font, true);
          quillInstance_copy = new Quill(quillEditorCopy, {
            modules: {
              toolbar: [
                [{ 'font': ['arial', 'times-new-roman', 'sans-serif', 'serif', 'monospace'] }, { 'size': [] }],
                ['bold', 'italic', 'underline', 'strike'],
                [{ 'color': [] }, { 'background': [] }],
                [{ 'header': [1, 2, 3, false] }],
                [{ 'align': [] }],
                [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                [{ 'indent': '-1'}, { 'indent': '+1' }],
                ['clean']
              ]
            },
            placeholder: 'Nhập nội dung tại đây...',
            theme: 'snow'
          });
          setTimeout(() => { quillInstance_copy.focus(); }, 100);
        }
        if (editingIndex_copy === null) {
          quillInstance_copy.setContents([]);
          editorFileName_copy.value = '';
        }
      }
      
      window.showEditor_copy = showEditor_copy;
      
      function closeEditor_copy() {
        editorArea_copy.classList.add('hidden');
        editingIndex_copy = null;
      }
      
      window.closeEditor_copy = closeEditor_copy;
      
      function saveEditorContent_copy() {
        if (!quillInstance_copy) { alert("Trình soạn thảo chưa sẵn sàng. Vui lòng thử lại!"); return; }
        const htmlContent = quillInstance_copy.root.innerHTML;
        const customName = editorFileName_copy.value.trim() || 'Không tiêu đề';
        const textContent = quillInstance_copy.getText().trim();
        if (!textContent) { alert("Vui lòng nhập nội dung trước khi lưu!"); return; }
        showLoading_copy('Đang lưu nội dung...');
        try {
          if (editingIndex_copy !== null) {
            allPdfs_copy[editingIndex_copy].html = htmlContent;
            allPdfs_copy[editingIndex_copy].name = customName;
            editingIndex_copy = null;
          } else {
            allPdfs_copy.push({ type: 'text', name: customName, html: htmlContent });
          }
          showPdfContent_copy(allPdfs_copy);
          closeEditor_copy();
          saveBtn_copy.disabled = false;
          deleteBtn_copy.disabled = false;
          alert('Nội dung đã được lưu thành công!');
        } catch (error) {
          alert('Lỗi khi lưu nội dung: ' + error.message);
        } finally {
          hideLoading_copy();
        }
      }
      
      window.saveEditorContent_copy = saveEditorContent_copy;
      
      function editEditorContent_copy(index) {
        editingIndex_copy = index;
        editorArea_copy.classList.remove('hidden');
        if (!quillInstance_copy) { showEditor_copy(); }
        quillInstance_copy.root.innerHTML = allPdfs_copy[index].html || "";
        editorFileName_copy.value = allPdfs_copy[index].name || '';
        setTimeout(() => { quillInstance_copy.focus(); }, 100);
      }
      
      window.editEditorContent_copy = editEditorContent_copy;
      
      (function () {
        const popup = document.getElementById('popup_copy_resizable');
        const handle = popup.querySelector('.resize-handle-copy');
        let isResizing = false;
        let startX, startY, startW, startH;
        handle.addEventListener('mousedown', function (e) {
          e.preventDefault(); isResizing = true; startX = e.clientX; startY = e.clientY; startW = popup.offsetWidth; startH = popup.offsetHeight;
          document.body.style.userSelect = 'none';
        });
        document.addEventListener('mousemove', function (e) {
          if (!isResizing) return;
          let newW = startW + (e.clientX - startX); let newH = startH + (e.clientY - startY);
          newW = Math.max(500, Math.min(window.innerWidth * 0.98, newW)); newH = Math.max(400, Math.min(window.innerHeight * 0.95, newH));
          popup.style.width = newW + "px"; popup.style.height = newH + "px";
          document.getElementById('contentArea_copy').style.maxHeight = (newH - 170) + "px";
        });
        document.addEventListener('mouseup', function () {
          if (isResizing) { isResizing = false; document.body.style.userSelect = ''; if(window.allPdfs_copy) showPdfContent_copy(allPdfs_copy); }
        });
      })();

      function checkAutoPopup_copy() {
        if (shouldShowPopup()) {
          openPopupAutomatically_copy();
        }
      }

      function openPopupAutomatically_copy() {
        if (wowup_copy.classList.contains('hidden')) {
          console.log('Tự động mở popup');
          wowup_copy.classList.remove('hidden');
          loadFromFirebase_copy();
        }
      }

      // Kiểm tra mỗi phút
      setInterval(checkAutoPopup_copy, 60000);

      document.addEventListener('DOMContentLoaded', function() {
        // Kiểm tra và reset nếu là ngày mới
        const now = new Date();
        const todayKey = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;
        
        // Nếu lastReadDate không phải là hôm nay, reset nó
        if (autoPopupConfig_copy.lastReadDate !== todayKey) {
          console.log('Ngày mới, reset trạng thái đã đọc');
          autoPopupConfig_copy.lastReadDate = '';
          localStorage.removeItem('popupLastReadDate_copy');
        }
        
        console.log('Khởi động - Ngày hôm nay:', todayKey, '- Đã đọc:', autoPopupConfig_copy.lastReadDate);
        
        // Kiểm tra ngay khi tải trang
        checkAutoPopup_copy();

        // Gán lại sự kiện cho nút "Đã đọc"
        const markBtn = document.getElementById('markAsReadBtn_copy');
        if (markBtn) {
          markBtn.onclick = markAsReadAndClose_copy;
        }

        window.closeWowup_copy = closeWowup_copy;
        window.loadFromFirebase_copy = loadFromFirebase_copy;
      });
    })();
  </script>
</body>
</html>
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Chữ chạy chân trang - độc lập</title>
  <style>
    #marquee-ideco-footer {
      position: fixed;
      left: 0;
      bottom: 1.5cm;
      width: 100vw;
      background: transparent;
      z-index: 2147483000; /* rất cao, nhưng không block app vì pointer-events: none */
      overflow: hidden;
      pointer-events: none;
    }
    #marquee-ideco-text {
      display: inline-block;
      white-space: nowrap;
      font-size: 2em;
      color: #d61a1a;
      font-weight: bold;
      text-shadow: 1px 1px 0 #fff, 2px 2px 4px #fa8686;
      user-select: none;
      cursor: pointer;
      transition: filter 0.2s;
      pointer-events: auto;
      padding: 0 18px;
      background: transparent;
    }
    #marquee-ideco-text:hover {
      filter: brightness(1.2) drop-shadow(0 0 8px #fbc2c2);
    }
  </style>
</head>
<body>
  <!-- Chữ chạy độc lập, không dính app -->
  <div id="marquee-ideco-footer">
    <div id="marquee-ideco-text">
   - LUÔN ĐẶT MỤC TIÊU PHÁT TRIỂN KHÁCH HÀNG NHÓM UVS MỖI NGÀY - KHAI BÁO ÍT NHẤT 3 KHÁCH HÀNG/ NHÂN VIÊN
   - LUÔN CHỦ ĐỘNG TƯƠNG TÁC KHÁCH HÀNG QUA GỌI - TIẾP XÚC ĐỂ GIỚI THIỆU THUỐC MỚI - SẢN PHẨM MỚI ĐỂ TĂNG GIÁ TRỊ ĐƠN.
   - KIỂM TRA XUẤT NHẬP KHO KỸ - LÔ HẠN DÙNG CHO THUỐC - KIỂM TRA HÓA ĐƠN KỸ TRƯỚC KHI GIAO KHÁCH HÀNG.
   - KHÔNG NẮM PHẦN NÀO: XEM LẠI ĐÀO TẠO - HƯỚNG DẪN NGAY HAY TRA CỨU IDECO BOT - TRÁNH TRÔI VIỆC TRONG TUẦN.
   - CÙNG TẬP TRUNG XỬ LÝ NHANH - HÃY KIỂM TRA LẠI CHECKLIST MỖI NGÀY - KIỂM TRA LẠI KẾ HOẠCH KHAI BÁO CÁO RỎ.
   - CUỐI NGÀY : KIỂM TRA ĐƠN HÀNG - BẤM CHỌN - KIỂM TRA CHECKLIST - KIỂM TRA KHAI BÁO CÁO GIAO DỊCH- KHAI HẠCH TOÁN CHỨNG TỪ
   
	</div>
  </div>
  <script>
    // Chỉnh tốc độ ở đây (px/giây)
    const speed = 120;
    const textEl = document.getElementById('marquee-ideco-text');
    const wrapEl = document.getElementById('marquee-ideco-footer');
    let timeoutMarquee;

    function startMarquee() {
      // Reset vị trí ban đầu
      textEl.style.transition = 'none';
      textEl.style.transform = `translateX(${wrapEl.offsetWidth}px)`;

      // Tính toán thời gian chạy dựa trên tốc độ
      const textWidth = textEl.offsetWidth;
      const containerWidth = wrapEl.offsetWidth;
      const totalDistance = textWidth + containerWidth;
      const duration = totalDistance / speed;

      // Bắt đầu animation
      setTimeout(() => {
        textEl.style.transition = `transform ${duration}s linear`;
        textEl.style.transform = `translateX(-${textWidth}px)`;

        // Lặp lại animation sau khi kết thúc
        timeoutMarquee = setTimeout(startMarquee, duration * 1000);
      }, 40);
    }

    // Bắt đầu chạy chữ khi tải trang
    window.addEventListener('load', startMarquee);

    // Điều chỉnh lại khi resize cửa sổ
    window.addEventListener('resize', () => {
      clearTimeout(timeoutMarquee);
      startMarquee();
    });
  </script>
</body>
</html>
<!-- ========== CẢNH BÁO TỒN KHO THEO NHIỀU KHUNG GIỜ ========== -->
<div id="khocheck-alert-wrapper" style="all: initial; font-family: system-ui, Arial, sans-serif;">
  <div id="khocheck-alert-modal" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border-radius: 10px; box-shadow: 0 5px 20px rgba(0,0,0,0.3); z-index: 9999; max-width: 500px; width: 90%;">
    <h3 style="color: #f72585; margin-bottom: 15px;">⚠️ Thuốc đang tồn trong kho từ 10 hộp</h3>
    <div id="khocheck-alert-list" style="max-height: 300px; overflow-y: auto;"></div>
    <button id="khocheck-close-alert" style="margin-top: 15px; padding: 8px 16px; background: #4361ee; color: white; border: none; border-radius: 5px; cursor: pointer;">Đóng</button>
  </div>
</div>

<script>
(function() {
  if (window.khocheckAlertMultiSlotInitialized) return;
  window.khocheckAlertMultiSlotInitialized = true;

  const CONFIG = {
    firebase: {
      apiKey: "AIzaSyCipZKy7XQkrbMamuxEDd27wGxArWNl6S4",
      authDomain: "caro-5a283.firebaseapp.com",
      databaseURL: "https://caro-5a283-default-rtdb.firebaseio.com",
      projectId: "caro-5a283",
      storageBucket: "caro-5a283.firebasestorage.app",
      messagingSenderId: "143382348276",
      appId: "1:143382348276:web:901f4135b61fa0f774b9a1"
    },
    // 👇 Thiết lập 3-4 khung giờ bạn muốn
    alertTimes: [
      { hour: 9, minute: 45 },
      { hour: 11, minute: 30 },
	  { hour: 14, minute: 00 },
	  { hour: 15, minute:0 },
      { hour: 16, minute: 45 }
    ],
    threshold: 10,
    checkIntervalMs: 60 * 1000 // Kiểm tra mỗi 1 phút
  };

  const app = firebase.initializeApp(CONFIG.firebase, "khocheck_alert_multislot");
  const db = app.database();
  const documentsRef = db.ref('pharmaceuticals');

  // Tạo key cho từng khung giờ: "2025-04-05-10-30"
  function getTimeSlotKey(hour, minute) {
    const now = new Date();
    return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}-${hour}-${minute}`;
  }

  function hasAlertedInTimeSlot(hour, minute) {
    return localStorage.getItem(`khocheck_alerted_${getTimeSlotKey(hour, minute)}`) === '1';
  }

  function markAlertedInTimeSlot(hour, minute) {
    localStorage.setItem(`khocheck_alerted_${getTimeSlotKey(hour, minute)}`, '1');
  }

  function checkHighStockForSlot(hour, minute) {
    if (hasAlertedInTimeSlot(hour, minute)) return;

    const now = new Date();
    const targetTime = new Date();
    targetTime.setHours(hour, minute, 0, 0);

    // Chỉ kiểm tra nếu đã **qua** khung giờ này trong ngày
    if (now >= targetTime) {
      documentsRef.once('value')
        .then(snapshot => {
          const data = snapshot.val();
          const docs = data ? Object.keys(data).map(key => ({ id: key, ...data[key] })) : [];
          const stockByName = {};
          docs.forEach(doc => {
            if (doc.productName && doc.quantity != null) {
              const qty = parseInt(doc.quantity) || 0;
              if (qty > CONFIG.threshold) {
                if (!stockByName[doc.productName]) stockByName[doc.productName] = 0;
                stockByName[doc.productName] += qty;
              }
            }
          });
          const highStockItems = Object.entries(stockByName).filter(([name, total]) => total > CONFIG.threshold);
          if (highStockItems.length > 0) {
            const listEl = document.getElementById('khocheck-alert-list');
            listEl.innerHTML = '';
            highStockItems.forEach(([name, total]) => {
              const div = document.createElement('div');
              div.style.padding = '8px';
              div.style.borderBottom = '1px solid #eee';
              div.textContent = `${name} (SL: ${total})`;
              listEl.appendChild(div);
            });
            document.getElementById('khocheck-alert-modal').style.display = 'block';
            markAlertedInTimeSlot(hour, minute);
          }
        })
        .catch(err => console.warn("Lỗi kiểm tra tồn kho:", err));
    }
  }

  function checkAllSlots() {
    CONFIG.alertTimes.forEach(slot => {
      checkHighStockForSlot(slot.hour, slot.minute);
    });
  }

  document.getElementById('khocheck-close-alert').addEventListener('click', () => {
    document.getElementById('khocheck-alert-modal').style.display = 'none';
  });

  // Chạy ngay khi tải trang + lặp lại mỗi phút
  checkAllSlots();
  setInterval(checkAllSlots, CONFIG.checkIntervalMs);
})();
</script>






<!-- Script THÔNG BÁO KHÁCH HÀNG ĐẠT HÀNG -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

<script>
(function() {
    // === PHẦN CẤU HÌNH ===

    // 1. Cấu hình Firebase của bạn
    const firebaseConfig = {
        apiKey: "AIzaSyDKNLLhisemYQJeCW8QCOwfbvVsvUur-60",
        authDomain: "quetbarcode-2361a.firebaseapp.com",
        databaseURL: "https://quetbarcode-2361a-default-rtdb.firebaseio.com",
        projectId: "quetbarcode-2361a",
        storageBucket: "quetbarcode-2361a.firebasestorage.app",
        messagingSenderId: "209619008657",
        appId: "1:209619008657:web:ee4af6f6ec567a1d745330",
        measurementId: "G-2TRYH9DYK5"
    };

    // 2. Cấu hình lịch trình popup (Dễ dàng chỉnh sửa)
    const popupSchedule = {
        // 0:CN, 1:T2, 2:T3, 3:T4, 4:T5, 5:T6, 6:T7
        days: [0, 1, 2, 3, 4, 5, 6], // Chạy tất cả các ngày
        
        times: [
            { hour: 9, minute: 30 },
            { hour: 10, minute: 30 }, 
            { hour: 11, minute: 30 },
			{ hour: 13, minute: 30 },
			{ hour: 14, minute: 30 },
			{ hour: 15, minute: 30 },
            { hour: 17, minute: 00 }
        ]
    };
    
    // === KẾT THÚC CẤU HÌNH ===

    let customers = [];
    let shadowRoot;
    let database;

    const popupTemplate = `
        <style>
            :host {
                font-family: Arial, sans-serif;
                color: #333;
                line-height: 1.5;
            }
            * {
                box-sizing: border-box;
                margin: 0;
                padding: 0;
            }
            #reminderOverlay {
                display: none; /* Mặc định ẩn */
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.6);
                z-index: 2147483645;
            }
            #reminderPopup {
                display: none; /* Mặc định ẩn */
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: 600px;
                max-width: 90%;
                height: auto;
                max-height: 80vh;
                background-color: #ffffe0;
                border: 2px solid #f44336;
                padding: 0;
                border-radius: 8px;
                z-index: 2147483646;
                box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                flex-direction: column; /* Vẫn giữ flex-direction cho lúc hiển thị */
            }
            .popup-header {
                background-color: #f44336;
                color: white;
                padding: 10px 15px;
                border-radius: 6px 6px 0 0;
                display: flex;
                justify-content: space-between;
                align-items: center;
                flex-shrink: 0;
            }
            .popup-header h3 {
                color: white;
                font-size: 18px;
                font-weight: bold;
            }
            .popup-content {
                padding: 20px;
                overflow-y: auto;
                flex-grow: 1;
            }
            .popup-content h4 {
                color: #d9534f;
                border-bottom: 1px solid #ccc;
                padding-bottom: 5px;
                margin-top: 15px;
                margin-bottom: 10px;
                font-size: 17px;
                font-weight: bold;
            }
            .popup-content p {
                 margin-top: 0;
                 margin-bottom: 10px;
                 font-size: 15px;
            }
            .popup-content ul {
                list-style-type: decimal;
                padding-left: 25px;
                margin: 0;
                max-height: 200px;
                overflow-y: auto;
                border: 1px solid #eee;
                padding-top: 10px;
                padding-bottom: 10px;
                background: #fff;
            }
            .popup-content li {
                margin-bottom: 8px;
                font-size: 14px;
            }
            .popup-content li strong {
                font-weight: bold;
            }
            .popup-footer {
                text-align: center;
                padding: 15px;
                border-top: 1px solid #ddd;
                background-color: #f9f9f9;
                border-radius: 0 0 6px 6px;
                flex-shrink: 0;
            }
            .popup-footer button {
                background-color: #4CAF50;
                color: white;
                padding: 10px 20px;
                font-size: 16px;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                font-weight: bold;
            }
            .popup-footer button:hover {
                background-color: #45a049;
            }
        </style>
        
        <div id="reminderOverlay"></div>
        <div id="reminderPopup">
            <div class="popup-header">
                <h3>🔔 EM ƠI! CÓN NHIỀU KHÁCH CHƯA LÊN ĐƠN - HAY CHƯA BẤM CHỌN KÌA!</h3>
            </div>
            <div class="popup-content" id="reminderContent">
                </div>
            <div class="popup-footer">
                <button id="closeReminderButton">Đã đọc</button>
            </div>
        </div>
    `;

    /**
     * Khởi tạo và nhúng HTML/CSS
     */
    function createPopupDOM() {
        const shadowHost = document.createElement('div');
        shadowHost.id = 'gemini-popup-host';
        document.body.appendChild(shadowHost);
        shadowRoot = shadowHost.attachShadow({ mode: 'open' });
        shadowRoot.innerHTML = popupTemplate;
        shadowRoot.getElementById('closeReminderButton').addEventListener('click', closeReminderPopup);
    }

    /**
     * Tải dữ liệu Firebase (trả về Promise)
     */
    function loadFromFirebase() {
        return new Promise((resolve, reject) => {
            try {
                if (!database) {
                   console.error('Gemini Popup: Kết nối Firebase chưa sẵn sàng.');
                   return reject('Firebase not ready');
                }
                database.ref('customerManagement/customers').once('value')
                    .then((snapshot) => {
                        const data = snapshot.val();
                        if (data && Array.isArray(data)) {
                            customers = data;
                            console.log('Gemini Popup: Đã tải ' + data.length + ' khách hàng.');
                        } else {
                            customers = [];
                            console.log('Gemini Popup: Không có dữ liệu hoặc dữ liệu không hợp lệ.');
                        }
                        resolve(); // Báo hiệu đã tải xong
                    })
                    .catch((error) => {
                        console.error('Gemini Popup: Lỗi tải Firebase:', error);
                        reject(error);
                    });
            } catch (error) {
                console.error('Gemini Popup: Lỗi thực thi tải Firebase:', error);
                reject(error);
            }
        });
    }

    /**
     * Hiển thị popup (chỉ chạy khi có dữ liệu)
     */
    function showReminderPopup() {
        // === BỔ SUNG: Đảm bảo shadowRoot đã sẵn sàng ===
        if (!shadowRoot) {
             console.error("Gemini Popup: Shadow DOM chưa sẵn sàng, không thể hiển thị.");
             return;
        }
        // === KẾT THÚC BỔ SUNG ===

        const reminderContent = shadowRoot.getElementById('reminderContent');
        if (!reminderContent) return;

        let htmlContent = '';
        let staffWithReminders = 0;

        const staffNames = [...new Set(customers.map(c => c.staff ? c.staff.trim() : '').filter(name => name))];
        
        if (staffNames.length === 0) {
            console.log("Gemini Popup: Không có nhân viên, không hiển thị.");
            return;
        }

        staffNames.forEach(staffName => {
            const staffNameLower = staffName.toLowerCase();
            const customersToRemind = customers.filter(c => 
                (c.staff ? c.staff.trim().toLowerCase() : '') === staffNameLower &&
                !c.ordered &&
                !c.medicineOrdered
            );

            if (customersToRemind.length > 0) {
                staffWithReminders++;
                htmlContent += `<div style="margin-top: ${staffWithReminders > 1 ? '20px' : '0'};">`;
                htmlContent += `<h4>Nhân viên: ${staffName}</h4>`;
                htmlContent += `<p>Bạn còn <strong>${customersToRemind.length}</strong> khách hàng chưa đặt hàng:</p>`;
                htmlContent += '<ul>';
                customersToRemind.forEach(c => {
                    htmlContent += `<li><strong>${c.name || 'N/A'}</strong> (Mã: ${c.code || 'N/A'})</li>`;
                });
                htmlContent += '</ul></div>';
            }
        });

        if (staffWithReminders > 0) {
            reminderContent.innerHTML = htmlContent;
            shadowRoot.getElementById('reminderOverlay').style.display = 'block';
            shadowRoot.getElementById('reminderPopup').style.display = 'flex'; // Đổi từ none -> flex
        } else {
            console.log("Gemini Popup: Tất cả nhân viên đã hoàn thành. Không hiển thị.");
        }
    }

    /**
     * Đóng popup
     */
    function closeReminderPopup() {
        shadowRoot.getElementById('reminderOverlay').style.display = 'none';
        shadowRoot.getElementById('reminderPopup').style.display = 'none';
    }

    /**
     * Kiểm tra lịch trình
     */
    function checkAndTriggerReminder() {
        const now = new Date();
        const dayOfWeek = now.getDay();
        const hour = now.getHours();
        const minute = now.getMinutes();
        
        if (!shadowRoot) return;
        
        const popupIsOpen = shadowRoot.getElementById('reminderPopup').style.display === 'flex';
        const isScheduledDay = popupSchedule.days.includes(dayOfWeek);

        if (isScheduledDay && !popupIsOpen) {
            const isScheduledTime = popupSchedule.times.some(time => 
                time.hour === hour && time.minute === minute
            );
            
            if (isScheduledTime) {
                console.log("Gemini Popup: Đang kích hoạt popup theo LỊCH...");
                
                loadFromFirebase()
                    .then(() => {
                        showReminderPopup();
                    })
                    .catch((err) => {
                        console.error("Gemini Popup: Không thể hiển thị popup do lỗi tải data.", err);
                    });
            }
        }
    }

    /**
     * Hàm khởi chạy chính
     */
    function initialize() {
        try {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
        } catch (e) {
            console.warn("Gemini Popup: Lỗi khởi tạo Firebase (Có thể đã được khởi tạo):", e.message);
            if (!database) {
                 database = firebase.database();
            }
        }

        createPopupDOM();
        
        // Tải dữ liệu lần đầu để sẵn sàng
        loadFromFirebase(); 

        // Bắt đầu bộ đếm thời gian (chạy sau mỗi 60s)
        setInterval(checkAndTriggerReminder, 60000);
        
        // Kiểm tra ngay khi tải trang (Phòng trường hợp user tải trang ĐÚNG vào phút thông báo)
        checkAndTriggerReminder();
        
        // === BỔ SUNG THEO YÊU CẦU ===
        // Luôn hiển thị popup sau 10 giây kể từ khi tải trang
        setTimeout(() => {
            console.log("Gemini Popup: Kích hoạt popup 10s sau khi TẢI TRANG...");
            
            // Chỉ hiển thị nếu popup chưa được mở bởi lần kiểm tra ngay lập tức ở trên
            if (shadowRoot.getElementById('reminderPopup').style.display !== 'flex') {
                loadFromFirebase()
                    .then(() => {
                        showReminderPopup();
                    })
                    .catch((err) => {
                        console.error("Gemini Popup: Không thể hiển thị popup (10s) do lỗi tải data.", err);
                    });
            } else {
                 console.log("Gemini Popup: Bỏ qua popup 10s vì popup đã được hiển thị theo lịch.");
            }
        }, 10000); // 10 giây
        // === KẾT THÚC BỔ SUNG ===
        
        console.log("Gemini Popup Script đã khởi chạy.");
    }

    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initialize);
    } else {
        initialize();
    }
})();
</script>



<!-- Script PHÂN TÍCH DOANH SỐ KHÁCH HÀNG LỲ NÀY VÀ KỲ TRƯỚC  -->
<script>
(function() {
    // --- PHẦN 1: TẢI THƯ VIỆN FIREBASE ---
    function loadScript(src, callback) {
        var script = document.createElement('script');
        script.type = 'text/javascript';
        script.async = true;
        script.src = src;
        if (callback) {
            script.onload = callback;
        }
        document.head.appendChild(script);
    }

    loadScript('https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js', function() {
        loadScript('https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js', function() {
            initializeAppLogic();
        });
    });

    // --- PHẦN 2: LOGIC ỨNG DỤNG CHÍNH ---
    
    function initializeAppLogic() {
        // --- Cấu hình Firebase ---
        const firebaseConfig = {
            apiKey: "AIzaSyCAytujYZAr8jNDeeuXj66iz-1b4dwzZWE",
            authDomain: "quanlykh-8fe2b.firebaseapp.com",
            projectId: "quanlykh-8fe2b",
            storageBucket: "quanlykh-8fe2b.firebasestorage.app",
            messagingSenderId: "285582822541",
            appId: "1:285582822541:web:1465fe68cce97bd830a6c4"
        };
        
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();

        // --- Lịch trình popup ---
        const popupSchedule = {
            days: [0, 1, 2, 3, 4, 5, 6],
            times: [
                { hour: 9, minute: 45 },
                { hour: 11, minute: 30 },
                { hour: 14, minute: 36 },
                { hour: 15, minute: 38 },
				{ hour: 16, minute: 38 }
                // --- VÍ DỤ TEST: Thêm { hour: 16, minute: 30 } để test lúc 16:30
            ]
        };

        // --- Các hàm trợ giúp ---
        function getCurrentTimeSlot(now = new Date()) {
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();
            const currentDay = now.getDay();
            if (!popupSchedule.days.includes(currentDay)) return null;
            for (const time of popupSchedule.times) {
                if (currentHour === time.hour && currentMinute === time.minute) {
                    return time;
                }
            }
            return null;
        }

        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
        }

        function formatCurrency(amount) {
            if (typeof amount !== 'number') amount = Number(amount) || 0;
            return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(amount);
        }

        function closeAndSetCookie() {
            document.getElementById('ideco-analysis-overlay').style.display = 'none';
            const now = new Date();
            const timeSlot = getCurrentTimeSlot(now);
            if (timeSlot) {
                const cookieName = `idecoAnalysisRead_${now.toDateString()}_${timeSlot.hour}_${timeSlot.minute}`;
                document.cookie = `${cookieName}=true; max-age=86400; path=/`; 
            }
        }

        // --- Logic kiểm tra popup ---
        function checkAutoAnalysisPopup() {
            const now = new Date();
            const timeSlot = getCurrentTimeSlot(now);
            
            if (timeSlot) {
                const cookieName = `idecoAnalysisRead_${now.toDateString()}_${timeSlot.hour}_${timeSlot.minute}`;
                const readCookie = getCookie(cookieName);
                
                if (!readCookie) {
                    console.log(`IDECO Analysis: Auto-popup triggered at ${timeSlot.hour}:${timeSlot.minute.toString().padStart(2, '0')}`);
                    showAutoAnalysisPopup(db, now);
                }
            }
        }

        // --- Logic hiển thị popup ---
        function showAutoAnalysisPopup(db, now) {
            const analysisRef = db.collection('analysis').doc('latest');
            
            analysisRef.get().then((doc) => {
                if (doc.exists) {
                    const data = doc.data();
                    populatePopupContent(data.analysis, data.summary, new Date(data.lastUpdated), now);
                    document.getElementById('ideco-analysis-overlay').style.display = 'flex';
                } else {
                    console.log('IDECO Analysis: No analysis data found.');
                }
            }).catch((error) => {
                console.error('IDECO Analysis: Error fetching data:', error);
            });
        }

        // --- Logic đổ dữ liệu vào HTML ---
        function populatePopupContent(analysisResult, summary, lastUpdated, now) {
            const statsElement = document.getElementById('ideco-analysis-stats');
            const tableBody = document.getElementById('ideco-analysis-table-body');
            const timeString = `${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}`;
            if (!statsElement || !tableBody) return; // Kiểm tra xem HTML đã được tiêm vào chưa

            statsElement.innerHTML = `
                <h3>📊 TIẾP CẬN NHANH LẠI KHÁCH HÀNG - ${now.toLocaleDateString('vi-VN')} ${timeString}</h3>
                <div class="ideco-stats-grid">
                    <div class="ideco-stat-item ideco-stat-total"><div class="ideco-stat-number">${analysisResult.length}</div><div class="ideco-stat-label">TỔNG KHÁCH HÀNG</div></div>
                    <div class="ideco-stat-item ideco-stat-bad"><div class="ideco-stat-number">${summary.bad || 0}</div><div class="ideco-stat-label">CẦN QUAN TÂM</div></div>
                    <div class="ideco-stat-item ideco-stat-warning"><div class="ideco-stat-number">${summary.warning || 0}</div><div class="ideco-stat-label">CẦN HỖ TRỢ</div></div>
                    <div class="ideco-stat-item ideco-stat-good"><div class="ideco-stat-number">${summary.good || 0}</div><div class="ideco-stat-label">PHÁT TRIỂN TỐT</div></div>
                </div>
                <p><em>Dữ liệu cập nhật lúc: ${lastUpdated.toLocaleString('vi-VN')}</em></p>
            `;
            
            tableBody.innerHTML = '';
            analysisResult.forEach(customer => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${customer.id}</td>
                    <td>${customer.customerCode}</td>
                    <td>${customer.customerName}</td>
                    <td>${formatCurrency(customer.currentRevenue)}</td>
                    <td>${formatCurrency(customer.previousRevenue)}</td>
                    <td>${customer.growthRate}%</td>
                    <td class="ideco-${customer.statusClass}">${customer.recommendation}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // --- PHẦN 3: TIÊM HTML VÀ CSS VÀO WEBSITE (ĐÃ SỬA LỖI) ---
        
        // Hàm này sẽ tiêm HTML/CSS và khởi động bộ đếm giờ
        function setupPopupAndTimers() {
            // --- Định nghĩa CSS ---
            const styles = `
                #ideco-analysis-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); z-index: 2147483646; justify-content: center; align-items: center; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: #333; }
                #ideco-analysis-popup { width: 1000px; max-width: 90%; height: 800px; max-height: 90vh; background-color: white; border-radius: 10px; overflow: hidden; display: flex; flex-direction: column; box-shadow: 0 0 20px rgba(0,0,0,0.4); }
                #ideco-analysis-header { background-color: #e74c3c; color: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
                #ideco-analysis-title { font-size: 20px; font-weight: bold; }
                #ideco-analysis-close-btn { background-color: #3498db; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 14px; }
                #ideco-analysis-content { flex: 1; overflow-y: auto; padding: 20px; }
                .ideco-summary-stats { background-color: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #3498db; }
                .ideco-stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 15px; }
                .ideco-stat-item { text-align: center; padding: 10px; border-radius: 5px; }
                .ideco-stat-number { font-size: 24px; font-weight: bold; margin-bottom: 5px; }
                .ideco-stat-label { font-size: 12px; color: #7f8c8d; }
                .ideco-stat-total { background-color: #e8f4fd; color: #3498db; }
                .ideco-stat-bad { background-color: #fde8e8; color: #e74c3c; }
                .ideco-stat-warning { background-color: #fef5e8; color: #f39c12; }
                .ideco-stat-good { background-color: #e8f8ef; color: #27ae60; }
                .ideco-customer-list { width: 100%; border-collapse: collapse; }
                .ideco-customer-list th { background-color: #3498db; color: white; padding: 12px 15px; text-align: left; position: sticky; top: 0; z-index: 10; }
                .ideco-customer-list td { padding: 12px 15px; border-bottom: 1px solid #e0e0e0; }
                .ideco-customer-list tr:hover { background-color: #f5f7fa; }
                .ideco-status-good { color: #27ae60; font-weight: bold; }
                .ideco-status-warning { color: #f39c12; font-weight: bold; }
                .ideco-status-bad { color: #e74c3c; font-weight: bold; }
            `;
            const styleSheet = document.createElement("style");
            styleSheet.type = "text/css";
            styleSheet.innerText = styles;
            document.head.appendChild(styleSheet);

            // --- Định nghĩa HTML ---
            const popupHtml = `
                <div id="ideco-analysis-overlay">
                    <div id="ideco-analysis-popup">
                        <div id="ideco-analysis-header">
                            <div id="ideco-analysis-title">📊 KHÁCH HÀNG KHÔNG CÓ ĐƠN THÁNG TRƯỚC HÃY HỎI LẠI NHANH</div>
                            <button id="ideco-analysis-close-btn">Đã đọc</button>
                        </div>
                        <div id="ideco-analysis-content">
                            <div id="ideco-analysis-stats" class="ideco-summary-stats"><p>Đang tải dữ liệu phân tích...</p></div>
                            <table class="ideco-customer-list">
                                <thead><tr><th>STT</th><th>Mã KH</th><th>Khách hàng</th><th>Doanh thu kỳ này</th><th>Doanh thu kỳ trước</th><th>Tăng trưởng</th><th>Khuyến nghị</th></tr></thead>
                                <tbody id="ideco-analysis-table-body"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', popupHtml);
            
            // Gắn sự kiện click
            document.getElementById('ideco-analysis-close-btn').addEventListener('click', closeAndSetCookie);

            // --- Bắt đầu chạy bộ hẹn giờ ---
            checkAutoAnalysisPopup(); // Kiểm tra ngay lập tức
            setInterval(checkAutoAnalysisPopup, 60000); // Kiểm tra mỗi phút
            
            console.log('IDECO Analysis Popup script (v2) initialized.');
        }

        // *** ĐÂY LÀ PHẦN SỬA LỖI QUAN TRỌNG ***
        // Kiểm tra xem trang đã tải xong chưa
        if (document.readyState === 'loading') {
            // Nếu chưa, đợi
            document.addEventListener('DOMContentLoaded', setupPopupAndTimers);
        } else {
            // Nếu rồi, chạy ngay
            setupPopupAndTimers();
        }
    }
})();
</script>
